## zpool raidz vdev how many under block dev choose for optimal performance (Best Practices and Caveats)   
                                                                                                                    
### 作者                                                                                                                        
digoal                                                                                                                        
                                                                                                                    
### 日期                                                                                                                        
2014-06-17                                                                                                                   
                                                                                                                    
### 标签                                                                                                                        
ZFS , RAID磁盘个数选择                                          
                                                                                                                    
----                                                                                                                        
                             
## 背景    
在创建raidz的vdev时, 到底多少个设备合适呢?下面是zfs best practices给出的答案.  
  
推荐使用2^n+z的个数.  
  
z指校验数据的份数, 即允许坏多少块盘.  
  
例如  
  
```  
raidz1, 那么使用的底层块设备个数3, 5, 9, 17等. 建议基数不超过16(除非你的CPU特别强悍).  
raidz2, 那么使用的底层块设备个数4, 6, 10, 18等. 建议基数不超过16(除非你的CPU特别强悍).  
raidz3, 那么使用的底层块设备个数5, 7, 11, 19等. 建议基数不超过16(除非你的CPU特别强悍).  
```  
  
```  
For the number of disks in the storage pool, use the "power of two plus parity" recommendation.   
  
This is for storage space efficiency and hitting the "sweet spot" in performance.   
  
So, for a RAIDZ-1 VDEV, use three (2+1), five (4+1), or nine (8+1) disks.   
  
For a RAIDZ-2 VDEV, use four (2+2), six (4+2), ten (8+2), or eighteen (16+2) disks.   
  
For a RAIDZ-3 VDEV, use five (2+3), seven (4+3), eleven (8+3), or nineteen (16+3) disks.   
  
For pools larger than this, consider striping across mirrored VDEVs.  
```  
  
## 参考  
1\. https://pthree.org/2012/12/13/zfs-administration-part-viii-zpool-best-practices-and-caveats/  
                                                                                            
                                                                      
                                                                  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
#### [PostgreSQL 许愿链接](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
您的愿望将传达给PG kernel hacker、数据库厂商等, 帮助提高数据库产品质量和功能, 说不定下一个PG版本就有您提出的功能点. 针对非常好的提议，奖励限量版PG文化衫、纪念品、贴纸、PG热门书籍等，奖品丰富，快来许愿。[开不开森](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216").  
  
  
#### [9.9元购买3个月阿里云RDS PostgreSQL实例](https://www.aliyun.com/database/postgresqlactivity "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PostgreSQL 解决方案集合](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
