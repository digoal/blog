## PostgreSQL 12 preview - 64bit xid, 规避freeze - FullTransactionId GetTopFullTransactionId GetCurrentFullTransactionId  
                                        
### 作者                                        
digoal                                        
                                        
### 日期                                        
2019-03-30                                        
                                        
### 标签                                        
PostgreSQL , freeze , xid , 64 bit xid , FullTransactionId , GetTopFullTransactionId , GetCurrentFullTransactionId     
                                        
----                                        
                                        
## 背景         
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=2fc7af5e966043a412e8e69c135fae55a2db6d4f    
    
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=ad308058cc8666c50b43179e64d6bb7aeb3ba169    
    
PostgreSQL 12即将支持64 bit xid。当前使用的是32bit xid，需要通过freeze技术，循环使用xid，确保32 bit xid可应用于事务可见性判定。    
    
对于频繁更新的数据，freeze可能会带来较多额外的开销，为了解决这个问题，使用64bit xid是一个非常好的选择。完全规避freeze。    
    
```    
Use FullTransactionId for the transaction stack.    
    
Provide GetTopFullTransactionId() and GetCurrentFullTransactionId().    
The intended users of these interfaces are access methods that use    
xids for visibility checks but don't want to have to go back and    
"freeze" existing references some time later before the 32 bit xid    
counter wraps around.    
    
Use a new struct to serialize the transaction state for parallel    
query, because FullTransactionId doesn't fit into the previous    
serialization scheme very well.    
    
Author: Thomas Munro    
Reviewed-by: Heikki Linnakangas    
Discussion: https://postgr.es/m/CAA4eK1%2BMv%2Bmb0HFfWM9Srtc6MVe160WFurXV68iAFMcagRZ0dQ%40mail.gmail.com    
```    
    
```    
Add basic infrastructure for 64 bit transaction IDs.    
    
Instead of inferring epoch progress from xids and checkpoints,    
introduce a 64 bit FullTransactionId type and use it to track xid    
generation.  This fixes an unlikely bug where the epoch is reported    
incorrectly if the range of active xids wraps around more than once    
between checkpoints.    
    
The only user-visible effect of this commit is to correct the epoch    
used by txid_current() and txid_status(), also visible with    
pg_controldata, in those rare circumstances.  It also creates some    
basic infrastructure so that later patches can use 64 bit    
transaction IDs in more places.    
    
The new type is a struct that we pass by value, as a form of strong    
typedef.  This prevents the sort of accidental confusion between    
TransactionId and FullTransactionId that would be possible if we    
were to use a plain old uint64.    
    
Author: Thomas Munro    
Reported-by: Amit Kapila    
Reviewed-by: Andres Freund, Tom Lane, Heikki Linnakangas    
Discussion: https://postgr.es/m/CAA4eK1%2BMv%2Bmb0HFfWM9Srtc6MVe160WFurXV68iAFMcagRZ0dQ%40mail.gmail.com    
```    
       
## 参考      
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=2fc7af5e966043a412e8e69c135fae55a2db6d4f    
    
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=ad308058cc8666c50b43179e64d6bb7aeb3ba169    
    
      
  
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"  ><img src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"  alt="Flag Counter"  border="0"  ></a>  
  
  
## [digoal's 大量PostgreSQL文章入口](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
## [免费领取阿里云RDS PostgreSQL实例、ECS虚拟机](https://free.aliyun.com/ "57258f76c37864c6e6d23383d05714ea")
  
