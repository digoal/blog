## PostgreSQL 12 preview - Add wal_recycle and wal_init_zero GUCs 适配COW文件系统如ZFS   
                                                                                                        
### 作者                                                                                                        
digoal                                                                                                        
                                                                                                        
### 日期                                                                                                        
2019-04-05                                                                                                        
                                                                                                        
### 标签                                                                                                        
PostgreSQL , wal_recycle , wal_init_zero , cow , copy on write   
                       
----                                                                                                  
                                                                                                    
## 背景             
WAL文件是PG的REDO文件，一个文件默认16MB，写满后写下一个文件。下一个文件可能是以前写过的，通过重命名以及初始化（内容置为0）的方式重复使用。  
  
对于一些COW(copy on write)文件系统（例如ZFS，写时拷贝），实际上置0的方式复用，反而不如直接创建一个新文件。所以PG 12支持了用户选择是否使用老的WAL复用方法，或者使用新的复用方法（创建新文件）。  
    
```    
Add wal_recycle and wal_init_zero GUCs.  
author	Thomas Munro <tmunro@postgresql.org>	  
Tue, 2 Apr 2019 09:37:14 +0800 (14:37 +1300)  
committer	Thomas Munro <tmunro@postgresql.org>	  
Tue, 2 Apr 2019 09:37:14 +0800 (14:37 +1300)  
commit	475861b2615dd63ae8431d811749a6f9a15bbfd6  
tree	df88475a55eaa2bf359000628325d7b798f90521	tree | snapshot  
parent	4b82664156c230b59607704506f5b0a32ef490a2	commit | diff  
Add wal_recycle and wal_init_zero GUCs.  
  
On at least ZFS, it can be beneficial to create new WAL files every  
time and not to bother zero-filling them.  Since it's not clear which  
other filesystems might benefit from one or both of those things,  
add individual GUCs to control those two behaviors independently and  
make only very general statements in the docs.  
  
Author: Jerry Jelinek, with some adjustments by Thomas Munro  
Reviewed-by: Alvaro Herrera, Andres Freund, Tomas Vondra, Robert Haas and others  
Discussion: https://postgr.es/m/CACPQ5Fo00QR7LNAcd1ZjgoBi4y97%2BK760YABs0vQHH5dLdkkMA%40mail.gmail.com  
```     
  
```  
+     <varlistentry id="guc-wal-init-zero" xreflabel="wal_init_zero">  
+      <term><varname>wal_init_zero</varname> (<type>boolean</type>)  
+      <indexterm>  
+       <primary><varname>wal_init_zero</varname> configuration parameter</primary>  
+      </indexterm>  
+      </term>  
+      <listitem>  
+       <para>  
+        If set to <literal>on</literal> (the default), this option causes new  
+        WAL files to be filled with zeroes.  On some filesystems, this ensures  
+        that space is allocated before we need to write WAL records.  However,  
+        <firstterm>Copy-On-Write</firstterm> (COW) filesystems may not benefit  
+        from this technique, so the option is given to skip the unnecessary  
+        work.  If set to <literal>off</literal>, only the final byte is written  
+        when the file is created so that it has the expected size.  
+       </para>  
+      </listitem>  
+     </varlistentry>  
+  
+     <varlistentry id="guc-wal-recycle" xreflabel="wal_recycle">  
+      <term><varname>wal_recycle</varname> (<type>boolean</type>)  
+      <indexterm>  
+       <primary><varname>wal_recycle</varname> configuration parameter</primary>  
+      </indexterm>  
+      </term>  
+      <listitem>  
+       <para>  
+        If set to <literal>on</literal> (the default), this option causes WAL  
+        files to be recycled by renaming them, avoiding the need to create new  
+        ones.  On COW filesystems, it may be faster to create new ones, so the  
+        option is given to disable this behavior.  
+       </para>  
+      </listitem>  
+     </varlistentry>  
+  
```  
          
## 参考        
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=475861b2615dd63ae8431d811749a6f9a15bbfd6      
        
  
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"  ><img src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"  alt="Flag Counter"  border="0"  ></a>  
  
  
## [digoal's 大量PostgreSQL文章入口](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
## [免费领取阿里云RDS PostgreSQL实例、ECS虚拟机](https://free.aliyun.com/ "57258f76c37864c6e6d23383d05714ea")
  
