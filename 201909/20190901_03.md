## PostgreSQL pg_stat_statements支持 plan 统计 - plans,plan_time,优化器开销  
                                                
### 作者                                                
digoal                                                
                                                
### 日期                                                
2019-09-01                                              
                                                
### 标签                                                
PostgreSQL , plan , prepare statements , pg_stat_statements       
                                                
----                                                
                                                
## 背景     
https://www.postgresql.org/message-id/flat/CAEepm=0e59Y_6Q_YXYCTHZkqOc6H2pJ54C_Xe=VFu50Aqqp_sA@mail.gmail.com   
    
这个功能允许pg_stat_statements插件支持执行计划的统计，例如一条sql被调用了多少次，产生了多少次执行计划以及耗时。  
  
帮助用户了解是否使用了ps，通过ps能减少多少cpu开销。  
  
Hi hackers,  
  
I have often wanted $SUBJECT and was happy to find that Fujii-san had  
posted a patch five years ago[1].  The reception then seemed positive.  
So here is a refurbished and (hopefully) improved version of his patch  
with a new column for the replan count.  Thoughts?  
  
Example output:  
  
```  
             query              | plans | plan_time | calls | total_time  
--------------------------------+-------+-----------+-------+------------  
 prepare x as select $1         |     1 |     0.026 |    12 |       0.06  
 select substr(query, $1, $2),  |    11 |     1.427 |    11 |      3.565  
 prepare y as select * from foo |     2 |     7.336 |     5 |      0.331  
```  
  
I agree with the sentiment on the old thread that  
{total,min,max,mean,stddev}_time now seem badly named, but adding  
"execution" makes them so long...  Thoughts?  
  
[1](https://www.postgresql.org/message-id/CAHGQGwFx_%3DDO-Gu-MfPW3VQ4qC7TfVdH2zHmvZfrGv6fQ3D-Tw%40mail.gmail.com)  
  
--   
Thomas Munro  
http://www.enterprisedb.com  
    
## 参考    
https://www.postgresql.org/message-id/flat/CAEepm=0e59Y_6Q_YXYCTHZkqOc6H2pJ54C_Xe=VFu50Aqqp_sA@mail.gmail.com   
      
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
#### [PostgreSQL 许愿链接](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
您的愿望将传达给PG kernel hacker、数据库厂商等, 帮助提高数据库产品质量和功能, 说不定下一个PG版本就有您提出的功能点. 针对非常好的提议，奖励限量版PG文化衫、纪念品、贴纸、PG热门书籍等，奖品丰富，快来许愿。[开不开森](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216").  
  
  
#### [9.9元购买3个月阿里云RDS PostgreSQL实例](https://www.aliyun.com/database/postgresqlactivity "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PostgreSQL 解决方案集合](https://yq.aliyun.com/topic/118 "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
