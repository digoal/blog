## PG + SQLite = PGSQLite      
              
### ä½œè€…              
digoal              
              
### æ—¥æœŸ              
2025-07-23             
              
### æ ‡ç­¾              
æ•°æ®åº“ , åµŒå…¥å¼ , SQLite , PostgreSQL , åè®®å…¼å®¹ , è¯­æ³•è½¬æ¢ , ç±»å‹è½¬æ¢              
              
----              
              
## èƒŒæ™¯    
SQLiteæ˜¯åµŒå…¥å¼æ•°æ®åº“, æ”¯æŒå†…å­˜æ¨¡å¼, ä¹Ÿæ”¯æŒç£ç›˜æ¨¡å¼.   
  
å¦‚æœæŠŠSQLiteå˜æˆ(éåµŒå…¥å¼)æ•°æ®åº“æœåŠ¡ä¼šæ€ä¹ˆæ ·?  
  
å¹¶ä¸”ç»™å®ƒåŠ ä¸ŠPostgreSQLçš„SQLè§£æå™¨.  
  
PGSQLiteè¿™ä¸ªå¼€æºé¡¹ç›®å°±èƒ½æ»¡è¶³ä»¥ä¸Šéœ€æ±‚, å®ƒå®é™…ä¸Šåšäº†ä¸€å±‚è½¬å‘å’Œè¯­æ³•è½¬æ¢å±‚.   
  
PGSQLiteå¯åŠ¨åæ˜¯ä¸€ä¸ªæ•°æ®åº“æœåŠ¡, åç«¯å®é™…ä¸Šæ˜¯SQLite, ç”¨æˆ·ä¸PGSQLiteé€šè¿‡PGçš„åè®®å’Œè¯­æ³•è¿›è¡Œäº¤äº’.   
  
## è¯•ä¸€è¯•PGSQLite  
1ã€å®‰è£…éƒ¨ç½²PGSQLite  
  
ä¾èµ–rust  
```  
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh  
  
. "$HOME/.cargo/env"  
```  
  
```  
# Clone and build from source  
git clone --depth 1 https://github.com/erans/pgsqlite  
cd pgsqlite  
cargo build --release  
```  
  
2ã€ä½¿ç”¨PGSQLite  
  
```  
cd pgsqlite  
  
# Use an existing SQLite database  
./target/release/pgsqlite --database ./my-database.db  
  
# Or start with an in-memory database for testing  
./target/release/pgsqlite --in-memory  
```  
  
3ã€è¿æ¥PGSQLite  
  
```  
# Using psql  
psql -h localhost -p 5432 -d my-database  
  
# Using connection string  
psql "postgresql://localhost:5432/my-database"  
```  
  
4ã€ä½¿ç”¨PGè¯­æ³•  
  
```  
-- Create tables with PostgreSQL syntax  
CREATE TABLE users (  
    id SERIAL PRIMARY KEY,  
    email VARCHAR(255) UNIQUE NOT NULL,  
    created_at TIMESTAMP DEFAULT NOW()  
);  
  
-- Insert data  
INSERT INTO users (email) VALUES ('user@example.com');  
  
-- Query with PostgreSQL functions  
SELECT * FROM users WHERE created_at > NOW() - INTERVAL '7 days';  
```  
  
éœ€è¦æ³¨æ„çš„æ˜¯, PGçš„å‡½æ•°ã€è¯­æ³•ã€ç±»å‹æ¯”SQLiteæ›´ä¸°å¯Œ, å¦‚æœç”¨åˆ°äº†SQLiteä¸æ”¯æŒçš„å‡½æ•°ã€ç±»å‹, ä¼šæŠ¥é”™.  
```  
postgres=> insert into tbl select generate_series(1,100000), md5(random()::text), clock_timestamp();  
ERROR:  Query execution failed: SQLite error: near "AS": syntax error in insert into tbl select generate_series(1,100000), md5(random(CAST( AS TEXT))), clock_timestamp(); at offset 67  
```  
  
å…¶ä»–ç”¨æ³•  
```  
# Copy your template database for each test run  
cp template.db test-1.db  
pgsqlite --database test-1.db --port 5433 &  
  
# Run your tests against it  
npm test -- --database-url postgresql://localhost:5433/test-1  
  
# Cleanup is just removing the file  
rm test-1.db  
  
  
  
# Each branch gets its own database copy  
cp main.db feature-branch-123.db  
pgsqlite --database feature-branch-123.db --port 5433  
```  
  
PGSQLiteç¡®å®éå¸¸è½»é‡, æ¯”å®‰è£…éƒ¨ç½²PGä½¿ç”¨ç®€å•å¤šäº†. ä½†æ˜¯ä¼¼ä¹ä¸å¤ªå¯èƒ½ç”¨åœ¨ç”Ÿäº§? è‡³å°‘æˆ‘è¿˜æ²¡æœ‰æƒ³åˆ°å§.   
  
ä½ æœ‰ä»€ä¹ˆæƒ³æ³•?  
  
ä»€ä¹ˆåœºæ™¯ä¸­ä¼šç”¨åˆ°PGSQLiteå‘¢?  
    
ä½œè€…æåˆ°çš„æ„¿æ™¯å€’æ˜¯æŒºå¥½çš„: Why pgsqlite?
  
**pgsqlite** lets you use PostgreSQL tools and libraries with SQLite databases. This is perfect for:
  
- **ğŸš€ Rapid Testing & CI/CD**: Run integration tests without spinning up PostgreSQL. Just copy your SQLite file and go.
- **ğŸŒ¿ Feature Branch Deployments**: Each branch gets its own database. Just copy the SQLite file - no complex database provisioning.
- **ğŸ¤– AI Agent Development**: Multiple agents can work on isolated sandbox environments with zero setup. Clone the database instantly.
- **ğŸ’» Local Development**: Use your favorite PostgreSQL tools (psql, pgAdmin, DataGrip) with lightweight SQLite storage.
- **ğŸ”§ Migration Path**: Prototype with SQLite, seamlessly move to PostgreSQL later without changing application code.
  
ä½†æ˜¯, å‰ææ˜¯ç»å¤§éƒ¨åˆ†PGçš„å¸¸ç”¨åŠŸèƒ½ã€ç±»å‹ã€è¯­æ³•éƒ½è¦è¦†ç›–, é‚£æ‰ä¼šæœ‰æ„ä¹‰.    
  
#### [æœŸæœ› PostgreSQL|å¼€æºPolarDB å¢åŠ ä»€ä¹ˆåŠŸèƒ½?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB å¼€æºæ•°æ®åº“](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB å­¦ä¹ å›¾è°±](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL è§£å†³æ–¹æ¡ˆé›†åˆ](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [å¾·å“¥ / digoal's Github - å…¬ç›Šæ˜¯ä¸€è¾ˆå­çš„äº‹.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About å¾·å“¥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
