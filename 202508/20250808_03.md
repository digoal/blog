## PostgreSQL 19 preview - pg_stat_progress_basebackup 新增区分 backup_type 字段    
                                        
### 作者                                        
digoal                                        
                                        
### 日期                                        
2025-08-08                                        
                                        
### 标签                                        
PostgreSQL , PolarDB , DuckDB , 备份监控 , pg_stat_progress_basebackup , backup_type  
                                        
----                                        
                                        
## 背景     
https://github.com/postgres/postgres/commit/deb674454c5cb7ecabecee2e04ca929eee570df4  
  
本次提交（commit deb674454c5cb7ecabecee2e04ca929eee570df4）为 PostgreSQL 增加了一个新特性：在系统视图 pg_stat_progress_basebackup 中新增了 backup_type 字段，用于显示当前正在执行的备份类型，是 "full"（全量备份）还是 "incremental"（增量备份）。  
  
### 主要变更点  
- **pg_stat_progress_basebackup** 视图新增 backup_type 字段，类型为 text，值为 'full' 或 'incremental'。  
- 底层实现新增了相关的参数和常量，配合进度汇报机制，将备份类型的信息传递并展示出来。  
- 文档和测试用例也做了相应的补充。  
  
### 提交信息摘要  
- 作者：Masahiko Sawada  
- 合作者：Shinya Kato（作者）、Yugo Nagata（评审）  
- 提交说明：引入 backup_type 字段，指示当前备份是全量还是增量。并同步 bump 了 catalog version。  
  
---  
  
## 使用示例  
  
### 1. 查看备份进度及类型  
  
假设你正在执行 basebackup，可以在数据库中执行：  
  
```sql  
SELECT * FROM pg_stat_progress_basebackup;  
```  
  
你将看到如下类似的输出（示例）：  
  
| pid  | ... | backup_type  |  
|------|-----|--------------|  
| 1234 | ... | full         |  
| 4321 | ... | incremental  |  
  
这样可以直观地看到每个备份任务的类型。  
  
### 2. 查询正在进行的增量备份  
  
如果你只关心增量备份的进度，可以这样查询：  
  
```sql  
SELECT * FROM pg_stat_progress_basebackup WHERE backup_type = 'incremental';  
```  
  
---  
  
## 小结  
  
这个改动让 DBA 能更方便地通过系统视图实时了解 basebackup 的类型，便于备份运维和自动化脚本的细致管理。    
更多详细信息可参考[该提交详情页面](https://github.com/postgres/postgres/commit/deb674454c5cb7ecabecee2e04ca929eee570df4)。  
  
  
#### [期望 PostgreSQL|开源PolarDB 增加什么功能?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB 开源数据库](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
