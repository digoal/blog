## 自驱动数据库功能之一 | PostgreSQL索引自动维护  
                    
### 作者                    
digoal                    
                    
### 日期                    
2025-08-26                    
                    
### 标签                    
PostgreSQL , PolarDB , DuckDB , self-driving Database , AI , 自驱动数据库 , 索引维护 , 膨胀 , reindex , 无用索引 , 推荐索引             
                    
----                    
                    
## 背景    
随着AI Agent的兴起, AI4DB领域之一的self-driving数据库概念也被重新提及.  
  
虽然这么多年过去了, 似乎自驱动数据库只有Oracle做得比较好, 不需要消耗用户太多的管理精力. 还有就是云数据库, 少量人员管理大规模的数据库实例, 也算self-driving数据库范畴吧.  
  
但是self-driving肯定远不止于此. 关于self-driving的讨论可参考:  
- https://postgres.fm/episodes/self-driving-postgres  
- https://postgres.ai/blog/20250725-self-driving-postgres  
  
本文仅介绍一个有趣的项目 : pg_index_pilot  
  
项目目标概括起来分3类:    
- AR , 自动reindex膨胀的索引  
- AIR , 自动发现无用的索引并删除  
- AIC&O , 自动创建索引以优化数据库SQL性能  
  
通过pg_cron或外部的定时任务, 定期扫描数据库系统表, 发现膨胀超过阈值的索引( https://github.com/ioguix/pgsql-bloat-estimation ), 通过dblink插件异步执行reindex concurrently任务.  
  
项目处于初期阶段, 目前仅实现了部分AR能力, AIR和AIC&O都还没有开始.  
  
详见roadmap:  
  
The Roadmap covers three big areas:  
  
1. [ ] **"AR":** Automated Reindexing  
    1. [x] Maxim Boguk's bloat estimation formula – works with *any* type of index, not only btree  
        1. [x] original implementation (`pg_index_pilot`) – requires initial full reindex  
        2. [x] non-superuser mode for cloud databases (AWS RDS, Google Cloud SQL, Azure)  
        3. [x] flexible connection management for dblink  
        4. [ ] API for stats obtained on a clone (to avoid full reindex on prod primary)  
    2. [ ] Traditional bloat estimatation (ioguix; btree only)  
    3. [ ] Exact bloat analysis (pgstattuple; analysis on clones)  
    4. [x] Tested on managed services  
        - [x] RDS and Aurora (see [RDS Setup](#rds-setup) below)  
        - [ ] CloudSQL  
        - [ ] Supabase  
        - [ ] Crunchy Bridge  
        - [ ] Azure  
    5. [ ] Integration with postgres_ai monitoring  
    6. [ ] Resource-aware scheduling, predictive maintenance windows (when will load be lowest?)  
    7. [ ] Coordination with other ops (backups, vacuums, upgrades)  
    8. [ ] Parallelization and throttling (adaptive)  
    9. [ ] Predictive bloat modeling   
    10. [ ] Learning & Feedback Loops: learning from past actions, A/B testing and "what-if" simulation (DBLab)  
    11. [ ] Impact estimation before scheduling  
    12. [ ] RCA of fast degraded index health (why it gets bloated fast?) and mitigation (tune autovacuum, avoid xmin horizon getting stuck)  
    13. [ ] Self-adjusting thresholds  
2. [ ] **"AIR":** Automated Index Removal  
    1. [ ] Unused indexes  
    2. [ ] Redundant indexes  
    3. [ ] Invalid indexes (or, per configuration, rebuilding them)  
    4. [ ] Advanced scoring; suboptimal / rarely used indexes cleanup; self-adjusting thresholds  
    5. [ ] Forecasting of index usage; seasonal pattern recognition  
    6. [ ] Impact estimation before removal; "what-if" simulation (DBLab)  
3. [ ] **"AIC&O":** Automated Index Creation & Optimization  
    1. [ ] Index recommendations (including multi-column, expression, partial, hybrid, and covering indexes)  
    2. [ ] Index optimization according to configured goals (latency, size, WAL, write/HOT overhead, read overhead)  
    3. [ ] Experimentation (hypothetical with HypoPG, real with DBLab)  
    4. [ ] Query pattern classification  
    5. [ ] Advanced scoring; cost/benefit analysis  
    6. [ ] Impact estimation before operations; "what-if" simulation (DBLab)  
   
  
  
## 参考  
https://gitlab.com/postgres-ai/pg_index_pilot/-/blob/main/README.md   
  
https://gitlab.com/postgres-ai/pg_index_pilot/-/blob/main/TODO.md   
  
https://gitlab.com/postgres-ai/pg_index_pilot  
  
https://github.com/xataio/agent  
  
https://postgres.fm/episodes/self-driving-postgres  
  
https://postgres.ai/blog/20250725-self-driving-postgres  
  
[《这才靠谱数据库MCP Server的样子》](../202504/20250411_02.md)    
  
[《PostgreSQL 索引推荐 - HypoPG , pg_qualstats》](../201908/20190804_02.md)    
  
[《解读用户最常问的PostgreSQL垃圾回收、膨胀、多版本管理、存储引擎等疑惑 - 经典》](../201906/20190621_01.md)    
  
[《PostgreSQL 收缩膨胀表或索引 - pg_squeeze or pg_repack》](../201610/20161030_02.md)    
  
[《PostgreSQL 如何精确计算表膨胀(fsm,数据块layout讲解) - PostgreSQL table exactly bloat monitor use freespace map data》](../201306/20130628_01.md)    
  
[《PostgreSQL pgstattuple - 检查表的膨胀情况、dead tuples、live tuples、freespace》](../201909/20190915_02.md)    
  
    
#### [期望 PostgreSQL|开源PolarDB 增加什么功能?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB 开源数据库](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
