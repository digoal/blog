## DuckDB 读 iceberg 实时数据湖表 by duckdb_mooncake + moonlink    
              
### 作者              
digoal              
              
### 日期              
2025-09-15             
              
### 标签              
PostgreSQL , PolarDB , DuckDB , HTAP , 流 , cdc , 数据湖 , 实时数据湖 , 实时分析 , moonlink , duckdb_mooncake              
              
----              
              
## 背景        
上一篇文章介绍了 Mooncake-Labs 架构核心模块 moonlink, 上游实时数据流以读优化方式入湖(iceberg), 说是实时入湖, 实际上有一部分是在moonlink的缓存里.  
- [《Mooncake-Labs 架构进化, 核心是 moonlink》](../202509/20250915_01.md)         
    
所以要读到实时数据必须要配合moonlink使用.     
    
这不, 如果你使用duckdb作为计算引擎, 那么可使用 duckdb_mooncake 插件连接moonlink, 实时读取moonlink缓冲区+iceberg内的数据.     
    
怎么用呢? 来看看项目文档    
    
https://github.com/Mooncake-Labs/duckdb_mooncake    
    
---   
  
duckdb_mooncake 是 DuckDB 的一个扩展，用于实时读取由 [moonlink](https://github.com/Mooncake-Labs/moonlink) 写入的 Iceberg 表。    
    
## 安装    
duckdb_mooncake 可以使用以下命令安装INSTALL：    
```    
INSTALL duckdb_mooncake FROM community;    
```    
    
## 用法    
可以使用`ATTACH`命令绑定 `Mooncake 数据库`，然后可以使用标准 SQL 查询表。    
    
下面的示例绑定 监听地址为 '/var/lib/postgresql/data/pg_mooncake/moonlink.sock' 的moonlink 实例, 指定连接到名为 `postgres` 的 moonlink 数据库 。此 moonlink 实例已预先填充了一个名为 `public.c` 的表：    
```    
D ATTACH DATABASE 'mooncake' (TYPE mooncake, URI '/var/lib/postgresql/data/pg_mooncake/moonlink.sock', DATABASE 'postgres');    
D SELECT * FROM mooncake.public.c;    
┌───────┬─────────┐    
│  id   │   val   │    
│ int32 │ varchar │    
├───────┼─────────┤    
│     1 │ Hello   │    
│     2 │ World   │    
└───────┴─────────┘    
```    
    
## build 项目    
    
要构建 duckdb_mooncake ，请输入：    
```    
git submodule update --init --recursive    
GEN=ninja make    
```    
    
要运行 duckdb_mooncake ，请运行捆绑了 duckdb_mooncake 的 duckdb shell 如下：    
```    
./build/release/duckdb    
```    
    
## 参考    
    
https://github.com/Mooncake-Labs/duckdb_mooncake    
    
[《Mooncake-Labs 架构进化, 核心是 moonlink》](../202509/20250915_01.md)       
    
        
#### [期望 PostgreSQL|开源PolarDB 增加什么功能?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB 开源数据库](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
