## 德说-第353期, 职场中“油腻”一点, 用规则保护自己  
                                                        
### 作者                                                        
digoal                                                        
                                                        
### 日期                                                        
2025-09-23                                                      
                                                        
### 标签                                                        
规范 , 风险 , 坑 , 非个人 , 组织 , 多人 , 法不责众          
                                                        
----                                                        
                                                        
## 背景   
今天群里一位盆友问, PG里面是不是无脑的使用`text`/`varchar`更好, 而不是使用`varchar(n)`.  
  
如果你一头扎到问题里去, 肯定马上会被弄到两难的境地, 为什么呢? 因为仔细分析两者都有利弊.  
  
例如  
- `text`/`varchar` 不限制长度,   
    - 好处举例:   
        - 如果当前业务只需要32个字符, 但是将来不足时, 不需要在数据库中执行DDL, 只要应用端发布更新就可以了.    
        - 数据库中修改字段长度属于DDL操作, 如果涉及逻辑复制, 风险点是不是增加了?   
        - 即使抛开逻辑复制的风险点, DDL本身也有风险, 例如会不会rewrite table? rewrite index? 大表rewrite风险极大.   
        - 即使不需要rewrite table, DDL 也是一把大锁, 玩意有其他long query/long xact持有了这个对象的共享锁, DDL也会进入等待队列, 阻塞该对象的其他任意锁请求, 可能导致业务雪崩.  
    - 弊端举例:   
        - 如果业务未做限制, 则可能被外部攻击/程序bug导致写入超大字段, 带来性能或其他风险.   
- `varchar(n)` 限制长度, 利弊正好相反  
    - 好处举例: 限制长度后, 避免了这个问题: 外部攻击/程序bug导致写入超大字段  
    - 弊端举例: 刚好相反, 如果要修改字段长度, 就要考虑到上面的问题.    
  
以上仅是简单举例.     
  
本文想要拓展的是: 遇到类似的问题怎么办?   
- 1、数据库团队和研发团队一起制定开发规范.   
- 2、通过更大老板/技术委员会决议, 让规则生效, 遵循规则行事.   
   
(当然了, 让更多人参与来制定规则, 也不完全是为了逃避责任, 因为一个人的眼界毕竟是有限的, 三个臭皮匠还顶个诸葛亮呢!)  
  
这个规范一方面是对双方的约束, 另外也可以保护自己. 虽然规则你可能参与了制定, 但是通过了更大的老板/技术委员会的决议, 责任已经均摊到了更多人头上. 依规则行事的话, 即使出了问题不用你一个人背责任.   
  
你会发现职场很多“老油条”都是这么干的, 甚至有“小人”可能还会利用规则来“挖坑”.    
     
职场险恶, 没事别让自己成为背责任的那方. 除非, 你的权力、责任和利益匹配!     
     
  
#### [期望 PostgreSQL|开源PolarDB 增加什么功能?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB 开源数据库](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
