## LangChain æºç å­¦ä¹ : 6 å¼€å‘è€…ä½“éªŒï¼ˆDeveloper Experienceï¼‰                                   
                                                          
### ä½œè€…                                                  
digoal                                                  
                                                          
### æ—¥æœŸ                                                    
2025-10-17                                                        
                                                   
### æ ‡ç­¾                                                        
AI Agent , Powered by LLM , LangChain , æºç å­¦ä¹                                                    
                                                         
----                                                     
                                                     
## èƒŒæ™¯                
LangChain ä»“åº“ä¸ºå…¶å•ä½“ä»“åº“ï¼ˆmonorepoï¼‰ç»“æ„æä¾›äº†å…¨é¢çš„åŸºç¡€è®¾æ–½å’Œå·¥å…·æ”¯æŒï¼ŒåŒ…æ‹¬è‡ªåŠ¨åŒ–æ„å»ºç³»ç»Ÿã€ä½¿ç”¨ `uv` è¿›è¡Œä¾èµ–ç®¡ç†ã€æŒç»­é›†æˆï¼ˆCIï¼‰å·¥ä½œæµä»¥åŠæ–‡æ¡£ç”Ÿæˆã€‚è¿™å¥—å¼€å‘è€…ä½“éªŒåŸºç¡€è®¾æ–½ç¡®ä¿äº†ä»£ç è´¨é‡ï¼ŒåŠ é€Ÿå¼€å‘æµç¨‹ï¼Œå¹¶åœ¨æ•´ä¸ªåŒ…å« 50 å¤šä¸ªåŒ…çš„ç”Ÿæ€ç³»ç»Ÿä¸­ä¿æŒä¸€è‡´æ€§ã€‚  
  
## æ„å»ºç³»ç»Ÿæ¶æ„  
  
LangChain åœ¨æ•´ä¸ªå•ä½“ä»“åº“ï¼ˆmonorepoï¼‰ä¸­ä½¿ç”¨ `uv` ä½œä¸ºä¸»è¦çš„ä¾èµ–ç®¡ç†å™¨å’Œæ„å»ºå·¥å…·ã€‚è¯¥ç³»ç»ŸåŒæ—¶æ”¯æŒä¼ ç»Ÿçš„åŸºäº Poetry çš„åŒ…å’Œç°ä»£çš„åŸºäº `uv` çš„åŒ…ï¼Œå¹¶èƒ½è‡ªåŠ¨æ£€æµ‹å’Œå¤„ç†è¿™ä¸¤ç§æ ¼å¼ã€‚  
  
### æ„å»ºç³»ç»Ÿæ¦‚è§ˆ  
  
![pic](20251017_09_pic_001.jpg)  
  
æ„å»ºç³»ç»Ÿå¯¹æ‰€æœ‰åŒ…å‡ä½¿ç”¨ `pdm-backend` ä½œä¸ºæ„å»ºåç«¯ï¼Œåœ¨æ¯ä¸ª `pyproject.toml` æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œä¾‹å¦‚ï¼š  
- `libs/langchain/pyproject.toml`   
- `libs/core/pyproject.toml`   
  
`uv` å·¥å…·è´Ÿè´£ç®¡ç†æ•´ä¸ªå•ä½“ä»“åº“ï¼ˆmonorepoï¼‰ä¸­çš„è™šæ‹Ÿç¯å¢ƒã€ä¾èµ–è§£æå’ŒåŒ…å®‰è£…ã€‚  
  
**æºæ–‡ä»¶ï¼š**   
- `pyproject.toml`   
- `libs/langchain/pyproject.toml`   
- `libs/core/pyproject.toml`   
- `Makefile`   
  
### ä¾èµ–ç®¡ç†é…ç½®  
  
å•ä½“ä»“åº“ï¼ˆmonorepoï¼‰é‡‡ç”¨äº†ä¸€å¥—å¤æ‚çš„ä¾èµ–ç®¡ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬ä¾èµ–åˆ†ç»„å’Œæœ¬åœ°åŒ…å¼•ç”¨ï¼š  
  
| åŒ…å | æ ¸å¿ƒä¾èµ– | æµ‹è¯•ä¾èµ– | ç‰¹æ®ŠåŠŸèƒ½ |  
|------|----------|----------|----------|  
| `langchain-core` | `langsmith`, `tenacity`, `pydantic` | `pytest`, `syrupy`, `blockbuster` | æ”¯æŒåŸºå‡†æµ‹è¯• |  
| `langchain` | `langchain-core`, `langchain-text-splitters` | æ‰©å±•æµ‹è¯•å¥—ä»¶ | å¯é€‰çš„åˆä½œä¼™ä¼´æ‰©å±• |  
| åˆä½œä¼™ä¼´(æä¾›å•†)åŒ… | `langchain-core` | é›†æˆæµ‹è¯•åˆ†ç»„ | æä¾›å•†ç‰¹å®šä¾èµ– |  
  
æ¯ä¸ªåŒ…åœ¨ `pyproject.toml` ä¸­å®šä¹‰äº†ä»¥ä¸‹ä¾èµ–åˆ†ç»„ï¼š  
- `test`ï¼šæ ¸å¿ƒæµ‹è¯•ä¾èµ–  
- `test_integration`ï¼šé›†æˆæµ‹è¯•ä¾èµ–  
- `lint`ï¼šä»£ç è´¨é‡å·¥å…·ï¼ˆå¦‚ `ruff`ã€`mypy`ï¼‰  
- `typing`ï¼šç±»å‹ä¾èµ–æ£€æŸ¥  
- `dev`ï¼šå¼€å‘å·¥å…·  
  
**æºæ–‡ä»¶ï¼š**   
- `libs/core/pyproject.toml`   
- `libs/langchain/pyproject.toml`   
- `pyproject.toml`   
  
### æœ¬åœ°åŒ…å¼•ç”¨  
  
åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå•ä½“ä»“åº“é€šè¿‡ `[tool.uv.sources]` éƒ¨åˆ†å®ç°åŒ…ä¹‹é—´çš„æœ¬åœ°é“¾æ¥ï¼š  
```  
[tool.uv.sources]  
langchain-core = { path = "./libs/core", editable = true }  
langchain-text-splitters = { path = "./libs/text-splitters", editable = true }  
langchain-openai = { path = "./libs/partners/openai", editable = true }  
```  
  
è¿™ä½¿å¾—å¼€å‘è€…å¯ä»¥åœ¨åŒ…è¾¹ç•Œä¹‹é—´å¿«é€Ÿå¼€å‘å’Œæµ‹è¯•ï¼ŒåŒæ—¶åœ¨å‘å¸ƒæ—¶ä»èƒ½ä¿æŒæ­£ç¡®çš„æ‰“åŒ…ç»“æ„ã€‚  
  
**æºæ–‡ä»¶ï¼š**   
- `pyproject.toml`   
- `libs/langchain/pyproject.toml`   
- `libs/core/pyproject.toml`   
  
## CI/CD åŸºç¡€è®¾æ–½  
  
CI/CD ç³»ç»ŸåŸºäº GitHub Actionsï¼Œä½¿ç”¨åŠ¨æ€æµ‹è¯•çŸ©é˜µï¼Œä»…å¯¹å‘ç”Ÿå˜æ›´çš„åŒ…è¿›è¡Œé«˜æ•ˆæµ‹è¯•ã€‚è¯¥åŸºç¡€è®¾æ–½æ”¯æŒå¤šç§æµ‹è¯•ç­–ç•¥ã€ä¾èµ–å…¼å®¹æ€§æ£€æŸ¥ä»¥åŠè‡ªåŠ¨åŒ–å‘å¸ƒã€‚  
  
### CI/CD å·¥ä½œæµæ¶æ„  
  
![pic](20251017_09_pic_002.jpg)  
  
CI ç³»ç»Ÿåœ¨ `.github/scripts/check_diff.py` ä¸­å®ç°æ™ºèƒ½å˜æ›´æ£€æµ‹ï¼ŒåŠ¨æ€ç”Ÿæˆæµ‹è¯•çŸ©é˜µï¼Œä»…æµ‹è¯•å‘ç”Ÿæ–‡ä»¶å˜æ›´çš„åŒ…åŠå…¶ä¾èµ–é¡¹ã€‚  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/workflows/check_diffs.yml`  
- `.github/workflows/scheduled_test.yml`  
- `.github/workflows/_release.yml`  
  
### æµ‹è¯•ç­–ç•¥  
  
æµ‹è¯•åŸºç¡€è®¾æ–½é‡‡ç”¨å¤šå±‚éªŒè¯æœºåˆ¶.   
  
#### æœ€å°ä¾èµ–ä¸‹çš„å•å…ƒæµ‹è¯•  
  
`_test.yml` å·¥ä½œæµå¯¹æ¯ä¸ªåŒ…è¿è¡Œä¸¤æ¬¡æµ‹è¯•ï¼š  
  
1ã€æ¥è‡ª lockfiles çš„å½“å‰ä¾èµ–é¡¹  
  
2ã€æ”¯æŒçš„æœ€å°ä¾èµ–ç‰ˆæœ¬  
  
è¿™ç¡®ä¿äº†åœ¨æ”¯æŒçš„ä¾èµ–ç‰ˆæœ¬èŒƒå›´å†…ï¼ˆç”± `.github/scripts/get_min_versions.py` è®¡ç®—å¾—å‡ºï¼‰çš„å…¼å®¹æ€§ã€‚  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/workflows/_test.yml`   
  
#### é›†æˆæµ‹è¯•ç¼–è¯‘éªŒè¯  
  
åœ¨è¿è¡Œæ˜‚è´µçš„é›†æˆæµ‹è¯•ä¹‹å‰ï¼Œç³»ç»Ÿä¼šä½¿ç”¨ `pytest` æ ‡è®°æ¥éªŒè¯æ‰€æœ‰é›†æˆæµ‹è¯•æ˜¯å¦èƒ½æ­£ç¡®ç¼–è¯‘å’Œå¯¼å…¥ï¼š  
```  
# Integration tests marked with @pytest.mark.compile  
uv run pytest -m compile tests/integration_tests  
```  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/workflows/_compile_integration_test.yml`   
  
#### å®šæœŸçš„çº¿ä¸Š API æµ‹è¯•  
  
æ¯å¤©å®šæ—¶è¿è¡Œé’ˆå¯¹æ ¸å¿ƒåˆä½œä¼™ä¼´åŒ…çš„é›†æˆæµ‹è¯•ï¼Œè¿æ¥çœŸå®çš„ APIã€‚æµ‹è¯•çŸ©é˜µå¯é…ç½®ï¼Œæ¶µç›–ä¸»è¦æœåŠ¡æä¾›å•†ï¼š  
```  
DEFAULT_LIBS: '["libs/partners/openai", "libs/partners/anthropic", "libs/partners/fireworks", ...]'  
  
```  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/workflows/scheduled_test.yml`  
  
## æ–‡æ¡£ç³»ç»Ÿ  
  
LangChain ä½¿ç”¨è‡ªåŠ¨åŒ–æ–‡æ¡£ç”Ÿæˆç³»ç»Ÿï¼Œä»æºä»£ç è‡ªåŠ¨ç”Ÿæˆ API å‚è€ƒæ–‡æ¡£ï¼Œå¹¶ç»´æŠ¤ç¤ºä¾‹ä¸ API æ–‡æ¡£ä¹‹é—´çš„é“¾æ¥ã€‚  
  
### æ–‡æ¡£ç”Ÿæˆæµæ°´çº¿  
![pic](20251017_09_pic_003.jpg)  
  
æ–‡æ¡£ç³»ç»Ÿä¼šè‡ªåŠ¨å‘ç°åŒ…ï¼Œä½¿ç”¨ `importlib` å’Œ `inspect` åˆ†æ Python æ¨¡å—ï¼Œå¹¶æ ¹æ®å¯¹è±¡ç±»å‹å¥—ç”¨å¯¹åº”çš„ Sphinx æ¨¡æ¿, ç”Ÿæˆç»“æ„åŒ–çš„ RST æ–‡ä»¶ã€‚  
  
**æºæ–‡ä»¶ï¼š**   
- `docs/api_reference/create_api_rst.py`   
- `.github/workflows/api_doc_build.yml`   
  
### API å‚è€ƒæ–‡æ¡£ç”Ÿæˆæµç¨‹  
  
`create_api_rst.py` è„šæœ¬è´Ÿè´£æ‰§è¡Œå…¨é¢çš„æºç åˆ†æï¼š  
- 1ã€å‘ç°åŒ…ï¼šé€’å½’æ‰«æ `libs/` å’Œ `libs/partners/` ç›®å½•  
- 2ã€æ¨¡å—åŠ è½½ï¼šç”¨ `importlib.import_module()` åŠ è½½ Python æ¨¡å—  
- 3ã€å¯¹è±¡åˆ†ç±»ï¼šæŒ‰ç±»å‹å¯¹ç±»è¿›è¡Œåˆ†ç±»ï¼ˆPydanticã€Runnableã€TypedDict ç­‰ï¼‰  
- 4ã€é€‰æ‹©æ¨¡æ¿ï¼šæ ¹æ®å¯¹è±¡ç±»å‹åˆ†é…é€‚å½“çš„ Sphinx æ¨¡æ¿  
- 5ã€ç”Ÿæˆ RSTï¼šä½¿ç”¨è‡ªåŠ¨æ‘˜è¦è¡¨åˆ›å»ºç»“æ„åŒ–æ–‡æ¡£  
  
åœ¨ `docs/api_reference/create_api_rst.py` ä¸­å®ç°å¯¹è±¡åˆ†ç±»é€»è¾‘  
```  
if type(type_) is typing_extensions._TypedDictMeta:  
    kind: ClassKind = "TypedDict"  
elif issubclass(type_, Runnable) and issubclass(type_, BaseModel):  
    kind = "RunnablePydantic"  
elif issubclass(type_, BaseModel):  
    kind = "Pydantic"  
```  
  
**æºæ–‡ä»¶ï¼š**   
- `docs/api_reference/create_api_rst.py`  
- `docs/api_reference/conf.py`  
  
### æ–‡æ¡£æ„å»ºåŸºç¡€è®¾æ–½  
  
é€šè¿‡ GitHub Actions æ¯å¤©è‡ªåŠ¨æ„å»º API æ–‡æ¡£ï¼Œç”± `api_doc_build.yml` ç¼–æ’æ•´ä¸ªæµç¨‹ï¼š  
  
1ã€Repository Checkoutï¼šåŸºäº `packages.yml` é…ç½®å…‹éš†åˆä½œä¼™ä¼´ä»“åº“(Repository)  
2ã€å®‰è£…ä¾èµ–é¡¹ï¼šä»¥å¯ç¼–è¾‘æ¨¡å¼è¦†ç›–å¼å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…  
3ã€ç”Ÿæˆæ–‡æ¡£ï¼šè¿è¡Œ `create_api_rst.py` å’Œ Sphinx æ„å»ºæ–‡æ¡£  
4ã€éƒ¨ç½²ï¼šå°†ç»“æœæ¨é€åˆ° `langchain-api-docs-html` å­˜å‚¨åº“  
  
æ„å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨ `docs/vercel_overrides.txt` ä¸­çš„ç‰¹æ®Šä¾èµ–é¡¹è¿›è¡Œè¦†ç›–ï¼Œä»¥è§£å†³æ–‡æ¡£æ„å»ºæ—¶çš„åŒ…ç‰ˆæœ¬å†²çªé—®é¢˜  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/workflows/api_doc_build.yml`  
- `.github/scripts/prep_api_docs_build.py`  
  
## å¼€å‘å·¥å…·  
  
ä»“åº“åŒ…å«å¤§é‡å¼€å‘å·¥å…·å’Œè„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨åŒ–å¸¸è§ä»»åŠ¡å¹¶ç»´æŠ¤ä»£ç è´¨é‡ã€‚  
  
### å¼€å‘å·¥å…·æ¦‚è§ˆ  
![pic](20251017_09_pic_004.jpg)  
  
**æºæ–‡ä»¶ï¼š**   
- `Makefile`  
- `.github/actions/uv_setup/action.yml`  
- `.github/actions/poetry_setup/action.yml`  
  
### Makefile ç›®æ ‡  
  
æ ¹ç›®å½•çš„ `Makefile` æä¾›äº†æ ‡å‡†åŒ–å‘½ä»¤ï¼Œç”¨äºå¸¸è§å¼€å‘ä»»åŠ¡ï¼š  
  
| ç›®æ ‡(makefile target) | ç”¨é€” | ç¤ºä¾‹ |  
|------|------|----------|  
| `docs_build` | æ„å»ºæ–‡æ¡£ | `cd docs && make build` |  
| `api_docs_build` | æ„å»º API å‚è€ƒæ–‡æ¡£ | `python docs/api_reference/create_api_rst.py` |  
| `lint` | è¿è¡Œä»£ç è´¨é‡æ£€æŸ¥ | `uv run --group lint ruff check docs cookbook` |  
| `format` | æ ¼å¼åŒ–ä»£ç  | `uv run --group lint ruff format docs cookbook` |  
  
æ¯ä¸ªåŒ…é‡Œé¢ä¹ŸåŒ…å«ä¸€ä¸ªæ ‡å‡†åŒ–çš„ `Makefile`ï¼Œæä¾›å¦‚ `test`ã€`integration_tests`ã€`lint_package` å’Œ `lint_tests` ç­‰ç›®æ ‡(makefile target)ã€‚  
  
**æºæ–‡ä»¶ï¼š**   
- `Makefile`  
- `libs/partners/deepseek/Makefile`   
  
### GitHub Actions  
  
ä»“åº“ä½¿ç”¨è‡ªå®šä¹‰ GitHub Actions æ¥å¤„ç†å¸¸è§çš„ CI ä»»åŠ¡ï¼š  
  
#### UV è®¾ç½® Action  
  
æä¾›æ ‡å‡†åŒ–çš„ Python å’Œ `uv` ç¯å¢ƒè®¾ç½®ï¼Œå¹¶æ”¯æŒç¼“å­˜ï¼š  
```  
- name: 'Set up Python + UV'  
  uses: "./.github/actions/uv_setup"  
  with:  
    python-version: "3.11"  
    cache-suffix: "test-libs/core"  
```  
  
è¯¥ Action è´Ÿè´£ `uv` å®‰è£…ã€Python ç¯å¢ƒé…ç½®ä»¥åŠè·¨æ“ä½œç³»ç»Ÿçš„ç¼“å­˜ç®¡ç†ã€‚  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/actions/uv_setup/action.yml`  
  
#### Poetry è®¾ç½® Actionï¼ˆé—ç•™ï¼‰  
  
ä¸ºå°šæœªè¿ç§»åˆ° `uv` çš„ Poetry åŒ…ä¿æŒå…¼å®¹æ€§ï¼š  
```  
- name: 'Set up Python + Poetry'  
  uses: "./.github/actions/poetry_setup"  
  with:  
    python-version: "3.11"  
    poetry-version: "1.8.4"  
```  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/actions/poetry_setup/action.yml`   
  
### å¼€å‘è„šæœ¬  
  
å¤šä¸ª Python è„šæœ¬ç”¨äºè‡ªåŠ¨åŒ–å¼€å‘å·¥ä½œæµ.   
  
#### å˜æ›´æ£€æµ‹ï¼ˆ`check_diff.py`ï¼‰  
  
åˆ†æ Git å˜æ›´ï¼Œç¡®å®šå“ªäº›åŒ…éœ€è¦æµ‹è¯•ï¼Œä»…æµ‹è¯•å—å½±å“çš„åŒ…åŠå…¶ä¾èµ–é¡¹æ¥ç¼©çŸ­ CI è¿è¡Œæ—¶é—´ã€‚  
  
#### API æ–‡æ¡£æ„å»ºå‡†å¤‡ï¼ˆ`prep_api_docs_build.py`ï¼‰  
  
åè°ƒå¤æ‚çš„å¤šä»“åº“ checkout å’Œç»„ç»‡æµç¨‹ï¼Œä¸ºæ–‡æ¡£æ„å»ºåšå‡†å¤‡ï¼š  
```  
def move_libraries(packages: list) -> None:  
    """Move libraries from their source locations to the target directories."""  
    for package in packages:  
        repo_name = package["repo"].split("/")[1]  
        source_path = package["path"]  
        target_dir = get_target_dir(package["name"])  
```  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/scripts/prep_api_docs_build.py`   
  
#### ç‰ˆæœ¬åŒæ­¥  
  
è‡ªåŠ¨åŒ–æ£€æŸ¥ç¡®ä¿ `pyproject.toml` ä¸ç‰ˆæœ¬æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·ä¿æŒä¸€è‡´ï¼Œé˜²æ­¢å‘å¸ƒæ—¶å‡ºç°ç‰ˆæœ¬ä¸åŒ¹é…ã€‚  
  
**æºæ–‡ä»¶ï¼š**   
- `.github/workflows/check_core_versions.yml`   
  
è¿™å¥—å¼€å‘è€…ä½“éªŒåŸºç¡€è®¾æ–½ä½¿ LangChain å›¢é˜Ÿèƒ½å¤Ÿåœ¨æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿä¸­ä¿æŒé«˜è´¨é‡ä»£ç ã€å¿«é€Ÿå¼€å‘å‘¨æœŸå’Œå…¨é¢æµ‹è¯•ï¼ŒåŒæ—¶æœ€å¤§é™åº¦åœ°å‡å°‘äººå·¥å¹²é¢„ã€‚  
  
# é™„å½•: UV å·¥å…·ä»‹ç»  
  
åœ¨ LangChain çš„å¼€å‘è€…ä½“éªŒï¼ˆDeveloper Experienceï¼‰æ–‡æ¡£ä¸­ï¼Œ**`uv`** è¢«æ˜ç¡®æŒ‡å®šä¸ºå…¶å•ä½“ä»“åº“ï¼ˆmonorepoï¼‰ä¸­çš„**ä¸»è¦ä¾èµ–ç®¡ç†å™¨å’Œæ„å»ºå·¥å…·**ã€‚ä¸‹é¢æˆ‘ä»¬å°†ç»“åˆæ–‡æ¡£å†…å®¹å’Œ `uv` æœ¬èº«çš„ç‰¹æ€§ï¼Œè¯¦ç»†ä»‹ç»å®ƒåœ¨ LangChain é¡¹ç›®ä¸­çš„è§’è‰²ã€ä¼˜åŠ¿ä»¥åŠå…·ä½“ç”¨æ³•ã€‚  
  
## ä¸€ã€ä»€ä¹ˆæ˜¯ `uv`ï¼Ÿ  
  
`uv` æ˜¯ç”± [Astral](https://astral.sh/)ï¼ˆå³ Ruff èƒŒåçš„å›¢é˜Ÿï¼‰å¼€å‘çš„ä¸€æ¬¾**è¶…é«˜é€Ÿ Python åŒ…å®‰è£…å™¨å’Œè§£æå™¨**ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ `pip`ã€`pip-tools`ã€`virtualenv`ï¼Œç”šè‡³éƒ¨åˆ†æ›¿ä»£ `poetry` å’Œ `pipenv`ã€‚å®ƒç”¨ Rust ç¼–å†™ï¼Œæ€§èƒ½è¿œè¶…ä¼ ç»Ÿå·¥å…·ï¼ˆå®˜æ–¹ç§°æ¯” `pip` å¿« 10â€“100 å€ï¼‰ã€‚  
  
æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š  
- è™šæ‹Ÿç¯å¢ƒç®¡ç†ï¼ˆç±»ä¼¼ `venv` + `virtualenv`ï¼‰  
- ä¾èµ–è§£æä¸å®‰è£…ï¼ˆç±»ä¼¼ `pip` + `pip-tools`ï¼‰  
- æ”¯æŒ `pyproject.toml` ä¸­çš„ä¾èµ–ç»„ï¼ˆdependency groupsï¼‰  
- æœ¬åœ°è·¯å¾„ä¾èµ–ï¼ˆlocal path dependenciesï¼‰  
- ä¸ç°ä»£ Python æ‰“åŒ…æ ‡å‡†ï¼ˆPEP 621ã€PEP 631ï¼‰å…¼å®¹  
  
> å®˜ç½‘ï¼šhttps://docs.astral.sh/uv/  
  
## äºŒã€LangChain ä¸­ `uv` çš„æ ¸å¿ƒç”¨é€”  
  
æ ¹æ®æ–‡æ¡£ï¼Œ`uv` åœ¨ LangChain å•ä½“ä»“åº“ä¸­æ‰¿æ‹…ä»¥ä¸‹å…³é”®è§’è‰²ï¼š  
  
### 1. **ç»Ÿä¸€ä¾èµ–ç®¡ç†**  
- æ›¿ä»£ä¼ ç»Ÿçš„ `poetry` æˆ– `pip` + `requirements.txt`  
- ç®¡ç† **50+ ä¸ªå­åŒ…**ä¹‹é—´çš„ä¾èµ–å…³ç³»  
- æ”¯æŒ **æ··åˆæ¨¡å¼**ï¼šæ—¢å…¼å®¹æ—§çš„ Poetry åŒ…ï¼Œä¹Ÿæ”¯æŒæ–°çš„ `uv` åŸç”ŸåŒ…ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰  
  
### 2. **æœ¬åœ°åŒ…å¼•ç”¨ï¼ˆLocal Package Linkingï¼‰**  
LangChain ä½¿ç”¨ `uv` çš„ `[tool.uv.sources]` åŠŸèƒ½å®ç°**å¼€å‘æ—¶çš„æœ¬åœ°ä¾èµ–é“¾æ¥**ï¼Œä¾‹å¦‚ï¼š  
  
```toml  
# pyproject.toml  
[tool.uv.sources]  
langchain-core = { path = "libs/core" }  
langchain-text-splitters = { path = "libs/text-splitters" }  
```  
  
è¿™ä½¿å¾—ï¼š  
- å¼€å‘è€…ä¿®æ”¹ `langchain-core` åï¼Œ`langchain` åŒ…èƒ½**ç«‹å³ä½¿ç”¨æœ€æ–°ä»£ç **ï¼Œæ— éœ€å‘å¸ƒæˆ–å®‰è£…  
- ä½†å‘å¸ƒæ—¶ä»ä½¿ç”¨ PyPI ä¸Šçš„æ­£å¼ç‰ˆæœ¬ï¼ˆå› ä¸º `uv` åœ¨æ„å»ºæ—¶ä¼šå¿½ç•¥ `path` æºï¼Œé™¤éæ˜¾å¼æŒ‡å®šï¼‰  
  
> è¿™è§£å†³äº† monorepo ä¸­â€œè·¨åŒ…å¼€å‘â€çš„ç»å…¸éš¾é¢˜ã€‚  
  
### 3. **ä¾èµ–åˆ†ç»„ï¼ˆDependency Groupsï¼‰**  
LangChain åœ¨ `pyproject.toml` ä¸­å®šä¹‰äº†å¤šä¸ªä¾èµ–ç»„ï¼Œä¾‹å¦‚ï¼š  
  
```toml  
[dependency-groups]  
test = ["pytest", "syrupy"]  
lint = ["ruff", "mypy"]  
dev = ["uv", "build"]  
```  
  
ç„¶åé€šè¿‡ `uv` å‘½ä»¤ä¸€é”®å®‰è£…ç‰¹å®šç»„ï¼š  
  
```bash  
uv run --group lint ruff check .  
uv run --group test pytest  
```  
  
è¿™æ¯” Poetry çš„ `--with` æˆ– pip çš„å¤šæ–‡ä»¶ç®¡ç†æ›´ç®€æ´é«˜æ•ˆã€‚  
  
### 4. **è™šæ‹Ÿç¯å¢ƒä¸æ‰§è¡Œç¯å¢ƒç®¡ç†**  
`uv` è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶æ”¯æŒç›´æ¥è¿è¡Œå‘½ä»¤ï¼š  
  
```bash  
# å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬ dev ç»„ï¼‰  
uv sync --all-extras --dev  
  
# è¿è¡Œæµ‹è¯•  
uv run pytest  
  
# æ ¼å¼åŒ–ä»£ç   
uv run ruff format .  
```  
  
æ— éœ€æ‰‹åŠ¨æ¿€æ´» `venv`ï¼Œ`uv` ä¼šè‡ªåŠ¨å¤„ç†ã€‚  
  
## ä¸‰ã€LangChain ä¸­ `uv` çš„å…¸å‹ç”¨æ³•ç¤ºä¾‹  
  
### 1. **å®‰è£…ä¾èµ–**  
```bash  
# å®‰è£…æ ¸å¿ƒä¾èµ– + å¼€å‘ä¾èµ–  
uv sync --all-extras --dev  
```  
  
### 2. **è¿è¡Œæµ‹è¯•**  
```bash  
# è¿è¡Œå•å…ƒæµ‹è¯•ï¼ˆä½¿ç”¨ test ä¾èµ–ç»„ï¼‰  
uv run --group test pytest tests/  
  
# è¿è¡Œé›†æˆæµ‹è¯•  
uv run --group test_integration pytest tests/integration/  
```  
  
### 3. **ä»£ç æ£€æŸ¥ä¸æ ¼å¼åŒ–**  
```bash  
# é™æ€æ£€æŸ¥  
uv run --group lint ruff check .  
  
# ç±»å‹æ£€æŸ¥  
uv run --group typing mypy .  
  
# è‡ªåŠ¨æ ¼å¼åŒ–  
uv run --group lint ruff format .  
```  
  
### 4. **æ„å»ºæ–‡æ¡£**  
```bash  
# ç”Ÿæˆ API æ–‡æ¡£  
uv run python docs/api_reference/create_api_rst.py  
  
# æ„å»º Sphinx æ–‡æ¡£  
cd docs && uv run make html  
```  
  
### 5. **æœ¬åœ°å¼€å‘å¤šåŒ…è”åŠ¨**  
å½“ä½ åŒæ—¶ä¿®æ”¹ `core` å’Œ `langchain` æ—¶ï¼š  
- åªéœ€åœ¨æ ¹ç›®å½•è¿è¡Œ `uv sync`  
- `uv` ä¼šè‡ªåŠ¨å°† `libs/core` ä½œä¸º `langchain-core` çš„æœ¬åœ°æº  
- æ‰€æœ‰åŒ…å…±äº«åŒä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œé¿å…ç‰ˆæœ¬å†²çª  
  
## å››ã€ä¸ºä»€ä¹ˆ LangChain é€‰æ‹© `uv`ï¼Ÿ  
  
| ä¼˜åŠ¿ | è¯´æ˜ |  
|------|------|  
| âš¡ **æé€Ÿ** | ä¾èµ–è§£æå’Œå®‰è£…é€Ÿåº¦è¿œè¶… pip/poetryï¼Œæå‡ CI å’Œæœ¬åœ°å¼€å‘æ•ˆç‡ |  
| ğŸ§© **Monorepo å‹å¥½** | åŸç”Ÿæ”¯æŒæœ¬åœ°è·¯å¾„ä¾èµ–å’Œè·¨åŒ…å¼€å‘ |  
| ğŸ“¦ **æ ‡å‡†å…¼å®¹** | åŸºäº PEP 621/631ï¼Œæœªæ¥å…¼å®¹æ€§å¥½ |  
| ğŸ”§ **å·¥å…·é›†æˆ** | ä¸ Ruffã€Mypy ç­‰ç°ä»£å·¥å…·é“¾æ— ç¼åä½œ |  
| ğŸ”„ **æ¸è¿›è¿ç§»** | å…è®¸ Poetry å’Œ uv åŒ…å…±å­˜ï¼Œé™ä½è¿ç§»æˆæœ¬ |  
  
## äº”ã€ä¸ Poetry çš„å¯¹æ¯”ï¼ˆLangChain çš„æ··åˆç­–ç•¥ï¼‰  
  
LangChain ç›®å‰å¤„äº**ä» Poetry å‘ uv è¿ç§»çš„è¿‡æ¸¡æœŸ**ï¼š  
- æ–°åŒ…ï¼ˆå¦‚ `langchain-core`ï¼‰å·²å…¨é¢é‡‡ç”¨ `uv` + `pdm-backend`  
- æ—§åŒ…ä»ä¿ç•™ Poetry é…ç½®  
- CI ä¸­åŒæ—¶æ”¯æŒ `.github/actions/poetry_setup` å’Œ `.github/actions/uv_setup`  
  
ä½†é•¿æœŸæ¥çœ‹ï¼Œ`uv` å°†æˆä¸ºå”¯ä¸€æ ‡å‡†ã€‚  
  
## å…­ã€å­¦ä¹ èµ„æº  
  
- å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.astral.sh/uv/  
- GitHub ä»“åº“ï¼šhttps://github.com/astral-sh/uv  
- LangChain çš„ `pyproject.toml` ç¤ºä¾‹ï¼ˆè§æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶ï¼‰  
  
## æ€»ç»“  
  
åœ¨ LangChain çš„å¼€å‘è€…ä½“éªŒä¸­ï¼Œ`uv` ä¸ä»…ä»…æ˜¯ä¸€ä¸ªâ€œæ›´å¿«çš„ pipâ€ï¼Œè€Œæ˜¯**æ•´ä¸ª monorepo å¼€å‘åŸºç¡€è®¾æ–½çš„æ ¸å¿ƒ**ã€‚å®ƒé€šè¿‡ï¼š  
- é«˜æ€§èƒ½ä¾èµ–è§£æ  
- æœ¬åœ°åŒ…é“¾æ¥  
- ä¾èµ–åˆ†ç»„  
- ç»Ÿä¸€æ‰§è¡Œç¯å¢ƒ  
  
æå¤§åœ°ç®€åŒ–äº†å¤§è§„æ¨¡ Python é¡¹ç›®çš„å¼€å‘ã€æµ‹è¯•å’Œå‘å¸ƒæµç¨‹ï¼Œæ˜¯ç°ä»£ Python å·¥ç¨‹åŒ–çš„é‡è¦å·¥å…·ã€‚  
  
å¦‚æœä½ æ­£åœ¨å‚ä¸ LangChain å¼€å‘æˆ–æ„å»ºç±»ä¼¼è§„æ¨¡çš„é¡¹ç›®ï¼Œå¼ºçƒˆå»ºè®®æŒæ¡ `uv` çš„ä½¿ç”¨ã€‚  
      
#### [æœŸæœ› PostgreSQL|å¼€æºPolarDB å¢åŠ ä»€ä¹ˆåŠŸèƒ½?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB å¼€æºæ•°æ®åº“](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB å­¦ä¹ å›¾è°±](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL è§£å†³æ–¹æ¡ˆé›†åˆ](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [å¾·å“¥ / digoal's Github - å…¬ç›Šæ˜¯ä¸€è¾ˆå­çš„äº‹.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About å¾·å“¥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
