## PostgreSQL 19 preview - 逻辑订阅端支持 `REFRESH SEQUENCES`      
                          
### 作者                          
digoal                          
                          
### 日期                          
2025-10-24                         
                          
### 标签                          
PostgreSQL , PolarDB , DuckDB , REFRESH SEQUENCES               
                          
----                          
                          
## 背景     
一直以来通过逻辑复制来进行数据迁移、大版本升级等时, 割接时都需要小心处理序列, 否则割接后容易导致使用序列生成的字段值重复、或违反唯一约束等问题.  
  
所以割接时需要对序列进行reset, 得先停业务(确保源端序列不再被消费), 然后读出源端所有序列的next value, 然后到订阅端执行set value的操作.   
  
挺繁琐的.  
  
前段时间PG 19出了个发布所有序列的补丁. [《PostgreSQL 19 preview - 发布端支持`FOR ALL SEQUENCES`, 通过逻辑复制进行大版本升级丝滑了亿点点》](../202510/20251010_07.md)    
  
今天这个补丁又让DBA更爽一点了, 支持在订阅端刷新序列值了.   
  
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=f0b3573c3aac6c0ea4cbc278f98178516579d370  
```  
Introduce "REFRESH SEQUENCES" for subscriptions.  
author  Amit Kapila <akapila@postgresql.org>      
Thu, 23 Oct 2025 08:30:27 +0000 (08:30 +0000)  
committer   Amit Kapila <akapila@postgresql.org>      
Thu, 23 Oct 2025 08:30:27 +0000 (08:30 +0000)  
commit  f0b3573c3aac6c0ea4cbc278f98178516579d370  
tree    af2caa24d8562050b79ccb302d97437596b4cc55    tree  
parent  6ae08d9583e9a5e951286948bdd9fcd58e67718a    commit | diff  
Introduce "REFRESH SEQUENCES" for subscriptions.  
  
This patch adds support for a new SQL command:  
ALTER SUBSCRIPTION ... REFRESH SEQUENCES  
This command updates the sequence entries present in the  
pg_subscription_rel catalog table with the INIT state to trigger  
resynchronization.  
  
In addition to the new command, the following subscription commands have  
been enhanced to automatically refresh sequence mappings:  
ALTER SUBSCRIPTION ... REFRESH PUBLICATION  
ALTER SUBSCRIPTION ... ADD PUBLICATION  
ALTER SUBSCRIPTION ... DROP PUBLICATION  
ALTER SUBSCRIPTION ... SET PUBLICATION  
  
These commands will perform the following actions:  
Add newly published sequences that are not yet part of the subscription.  
Remove sequences that are no longer included in the publication.  
  
This ensures that sequence replication remains aligned with the current  
state of the publication on the publisher side.  
  
Note that the actual synchronization of sequence data/values will be  
handled in a subsequent patch that introduces a dedicated sequence sync  
worker.  
  
Author: Vignesh C <vignesh21@gmail.com>  
Reviewed-by: Amit Kapila <amit.kapila16@gmail.com>  
Reviewed-by: shveta malik <shveta.malik@gmail.com>  
Reviewed-by: Masahiko Sawada <sawada.mshk@gmail.com>  
Reviewed-by: Hayato Kuroda <kuroda.hayato@fujitsu.com>  
Reviewed-by: Dilip Kumar <dilipbalaut@gmail.com>  
Reviewed-by: Peter Smith <smithpb2250@gmail.com>  
Reviewed-by: Nisha Moond <nisha.moond412@gmail.com>  
Reviewed-by: Shlok Kyal <shlok.kyal.oss@gmail.com>  
Reviewed-by: Chao Li <li.evan.chao@gmail.com>  
Reviewed-by: Hou Zhijie <houzj.fnst@fujitsu.com>  
Discussion: https://postgr.es/m/CAA4eK1LC+KJiAkSrpE_NwvNdidw9F2os7GERUeSxSKv71gXysQ@mail.gmail.com  
```  
    
#### [期望 PostgreSQL|开源PolarDB 增加什么功能?](https://github.com/digoal/blog/issues/76 "269ac3d1c492e938c0191101c7238216")
  
  
#### [PolarDB 开源数据库](https://openpolardb.com/home "57258f76c37864c6e6d23383d05714ea")
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
