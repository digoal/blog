## PostgreSQL 19 preview - 逻辑复制正式支持 Sequence 同步  
                                
### 作者                                
digoal                                
                                
### 日期                                
2025-11-06                               
                                
### 标签                                
PostgreSQL , DuckDB , sequence , 逻辑复制 , 同步                    
                                
----                                
                                
## 背景    
PostgreSQL 19 逻辑复制正式支持 Sequence 同步, 从创建订阅、刷新发布端到刷新序列的阶段性支持, 订阅端由一个专门的sequencesync worker来负责监控sequence同步状态, 同步并更新订阅端序列状态.    
    
https://git.postgresql.org/gitweb/?p=postgresql.git;a=commit;h=5509055d6956745532e65ab218e15b99d87d66ce  
```    
Add sequence synchronization for logical replication.  
author  Amit Kapila <akapila@postgresql.org>    
Wed, 5 Nov 2025 05:54:25 +0000 (05:54 +0000)  
committer Amit Kapila <akapila@postgresql.org>    
Wed, 5 Nov 2025 05:59:58 +0000 (05:59 +0000)  
commit  5509055d6956745532e65ab218e15b99d87d66ce  
tree  6d3776b6e028dbe5a465657395c5c624b0b21a75  tree  
parent  1fd981f05369340a8afa4d013a350b0b2ac6e33e  commit | diff  
Add sequence synchronization for logical replication.  
  
This patch introduces sequence synchronization. Sequences that are synced  
will have 2 states:  
   - INIT (needs [re]synchronizing)  
   - READY (is already synchronized)  
  
A new sequencesync worker is launched as needed to synchronize sequences.  
A single sequencesync worker is responsible for synchronizing all  
sequences. It begins by retrieving the list of sequences that are flagged  
for synchronization, i.e., those in the INIT state. These sequences are  
then processed in batches, allowing multiple entries to be synchronized  
within a single transaction. The worker fetches the current sequence  
values and page LSNs from the remote publisher, updates the corresponding  
sequences on the local subscriber, and finally marks each sequence as  
READY upon successful synchronization.  
  
Sequence synchronization occurs in 3 places:  
1) CREATE SUBSCRIPTION  
    - The command syntax remains unchanged.  
    - The subscriber retrieves sequences associated with publications.  
    - Published sequences are added to pg_subscription_rel with INIT  
      state.  
    - Initiate the sequencesync worker to synchronize all sequences.  
  
2) ALTER SUBSCRIPTION ... REFRESH PUBLICATION  
    - The command syntax remains unchanged.  
    - Dropped published sequences are removed from pg_subscription_rel.  
    - Newly published sequences are added to pg_subscription_rel with INIT  
      state.  
    - Initiate the sequencesync worker to synchronize only newly added  
      sequences.  
  
3) ALTER SUBSCRIPTION ... REFRESH SEQUENCES  
    - A new command introduced for PG19 by f0b3573c3a.  
    - All sequences in pg_subscription_rel are reset to INIT state.  
    - Initiate the sequencesync worker to synchronize all sequences.  
    - Unlike "ALTER SUBSCRIPTION ... REFRESH PUBLICATION" command,  
      addition and removal of missing sequences will not be done in this  
      case.  
  
Author: Vignesh C <vignesh21@gmail.com>  
Reviewed-by: shveta malik <shveta.malik@gmail.com>  
Reviewed-by: Hou Zhijie <houzj.fnst@fujitsu.com>  
Reviewed-by: Masahiko Sawada <sawada.mshk@gmail.com>  
Reviewed-by: Hayato Kuroda <kuroda.hayato@fujitsu.com>  
Reviewed-by: Dilip Kumar <dilipbalaut@gmail.com>  
Reviewed-by: Peter Smith <smithpb2250@gmail.com>  
Reviewed-by: Nisha Moond <nisha.moond412@gmail.com>  
Reviewed-by: Shlok Kyal <shlok.kyal.oss@gmail.com>  
Reviewed-by: Amit Kapila <amit.kapila16@gmail.com>  
Reviewed-by: Chao Li <li.evan.chao@gmail.com>  
Discussion: https://postgr.es/m/CAA4eK1LC+KJiAkSrpE_NwvNdidw9F2os7GERUeSxSKv71gXysQ@mail.gmail.com  
```  
      
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
