## 大学生数据库实践课开课了 : 1 大纲 及 教程入口  
  
### 作者  
digoal  
  
### 日期  
2025-12-02  
  
### 标签  
PostgreSQL , DuckDB , 语义搜索 , 向量搜索 , 关键词检索 , 全文检索 , 标量检索 , 混合搜索 , 多模态搜索 , 重排序 , embedding , document split , ORC , 大模型 , 多模态大模型 , Dify , 压力测试 , 索引优化 , 倒排向量索引 , Ivfflat , 图向量索引 , HNSW , DiskANN , 量化 , rabitq , sbq , 二值量化 , bm25 , 相关性 , 相似性 , 召回率 , pgbench , 数据集 , ann-benchmarks , 图搜索 , PGQ , 递归 , 深度优先 , 广度优先 , 最短路径 , N度关系 , LLM , Ollama  
  
----  
  
## 背景  
在 AI+ 时代, 数据会越来越重要, AI 可以被拆成3大要素: 大脑(LLM), 数据(记忆和知识库), 感官(MCP/function call).  
  
AI 处理任务的基本模式: 当 AI 接收到“任务指令/反馈”后, 通过大脑来进行推理, 在记忆和知识库中召回补充任务相关素材, 通过 mcp/function call 调用相关的外部工具并获得反馈. 循环往复.  
  
数据是 AI 的三大要素之一, 不可或缺.  
  
数据包括结构化数据(例如表格)、非结构化数据(例如文本、图像、音频、视频、地图等), 这些数据如何进行高效率的组织? 如何快速搜索到与任务最相关的数据? 如何标定相关性? 如何覆盖所有相关数据? 是数据库设计的关键!  
  
这么多数据种类, 不同种类搜索算子也各不相同(例如数值可能涉及的是比较大小, 排序; 文本涉及的是模糊匹配、关键词匹配、语义匹配等; 音频视频涉及的可能是相似内容、归类、特征匹配等; 地图涉及近邻搜索、空间交叠计算等; 结构化数据可能还包括图式关系搜索例如最短路径、N度关联等; 更多类型和相应的算子并未完全列出, 不过可想而知是非常庞杂的.  
  
AI 到底需要什么样的数据库才能满足以上诉求呢?  
  
答案可能是多模态数据库, 可以处理多种模态的数据!  
  
由于课程篇幅限制, 此课程将聚焦AI 搜索中最常见的这几个方面进行讲解: **向量化、语义搜索、关键词检索、标量检索、混合搜索、召回率、相关性、重排、图式搜索**  
  
掌握这些内容可以覆盖市面上最流行的 AI 应用框架对数据库数据搜索的需求, 例如: Dify, langgraph, langchain.  
  
**要义理解**  
  
### 1. AI 系统的“大脑、数据与感官”三要素架构  
  
这张图展示了 AI 时代的“三位一体”结构，强调了数据作为“记忆和知识库”的核心地位。  
  
```mermaid
graph TD
    subgraph AI_System [AI + 时代核心要素]
        A[大脑: LLM] <--> B[(数据: 记忆与知识库)]
        A <--> C[感官: MCP / Function Call]
    end

    B --- B1[结构化数据: 表格/数值]
    B --- B2[非结构化数据: 文本/音视频/地图]
    
    C --- C1[外部工具调用]
    C --- C2[环境反馈获取]

    style B fill:#f9f,stroke:#333,stroke-width:4px
```

  

### 2. AI 处理任务的闭环模式
  
这张流程图展示了 AI 在接收指令后，如何在不同要素间流转，形成一个循环往复的逻辑闭环。  
  
```mermaid
sequenceDiagram
    participant U as 用户指令/反馈
    participant B as 大脑 (LLM 推理)
    participant D as 数据 (召回与补充)
    participant T as 工具 (MCP/Function Call)

    U->>B: 输入任务指令
    loop 思考与执行
        B->>D: 检索相关素材 (Recall)
        D-->>B: 返回背景知识/记忆
        B->>T: 调用外部工具
        T-->>B: 返回执行结果/反馈
    end
    B->>U: 输出最终结果
```

 
  
### 3. 多模态数据库的复杂挑战与课程重点
  
这张图表详细拆解了不同类型数据的“算子”差异，并引出多模态数据库的必要性以及本课程的聚焦模块。  

```mermaid
mindmap
  root((多模态数据库))
    数据类型与算子
      结构化数据
        数值比较/排序
        图式关系/N度关联
      文本
        语义匹配
        关键词/模糊匹配
      音视频
        特征匹配
        相似性归类
      空间地图
        近邻搜索
        空间交叠计算
    核心挑战
      高效率组织
      相关性标定
      搜索全覆盖
    课程聚焦重点
      检索技术
        向量化/语义搜索
        关键词/标量检索
        混合搜索
      优化与评估
        召回率/相关性
        重排 (Rerank)
      进阶
        图式搜索
```
   
## 常用术语和命令(随时查阅)
### 术语
- WSL, Windows 上的 Linux 子系统.
- docker, 管理容器的工具. 
- docker 镜像, 将应用和依赖环境整体集成在一起的最小包裹. 
- docker 容器, 使用docker 镜像启动的应用. 
- PowerShell, windows 的命令行, 比cmd更复杂也更高级.
- cmd, windows 的命令行. 较为建议好入手. 使用时注意区分在哪个环境下, 如果执行命令报错, 先分析是不是环境不对.
- shell, Linux 命令行, bash,sh,zsh等都属于shell. 用来执行操作系统命令.
- 数据库 shell, 数据库命令行, 例如执行 psql/duckdb 可以进入到 PostgreSQL/DuckDB 的数据库命令行. 用来执行SQL.
- 大模型, 可运行推理、embedding(文本嵌入)、ranking 排序等任务
- ollama, 一种管理大模型的工具
- embedding, 将本文/图像等内容转换成大模型可以理解的向量
- rerank, 对结果和查询语句的向量进行相关性打分, 重新排序, 获得更好的相关性结果顺序
- 向量, 多个浮点数组成的高维数组
- 稠密向量, 多个浮点数组成的高维数组, 每个维度都有值
- 稀疏向量, 多个整型值组成的超高维数组, 不是每个维度都有值. 通常用来表示有限值中的若干个值, 例如表示字典中的若干个字.  
- 量化, 降低向量精度的技术, 例如将float32降精度到float16. 牺牲精度换取更高的性能, 更少的内存占用和更小的计算量.
- 向量搜索, 根据向量的距离进行搜索, 越近的向量, 越先被返回. 通常表示语义的相关, 例如一个意思可以有很多种表达方式, 如果在数据库中存在这种意思相近的内容, 则可通过向量搜索来实现. 
- 语义搜索, 等同于向量搜索. 
- 欧式距离, 一种向量距离计算公式
- 余弦距离, 一种向量距离计算公式
- 内积距离, 一种向量距离计算公式
- L1距离, 一种向量距离计算公式
- 汉明距离, 一种二值向量距离计算公式, 求不同bit位的个数
- 关键词搜索, 将文本根据切分方法, 切分成若干关键词, 过滤掉停用词、进行词干提取、同义词转换后得到的东西叫token, 关键词搜索就是token搜索.
- 标量搜索, 标量类型字段的检索, 例如等于、不等于、大于、小于等. 
- hnsw 图索引, 为了实现高效的向量搜索, 在向量字段上构建的一种索引. 采用图结构, 将所有向量勾连在一起, 成为图结构, 以进行快速搜索与查询语句相近的向量. 
- 邻居, 图中每个向量都有与之相连的邻居. 邻居的最大个数可以通过创建索引时的参数m进行指定. 
- 构图邻居候选点, 创建索引时, 邻居候选点列表的大小通过ef_construction来进行指定.
- 最大搜索限定条数, 使用图索引搜索相似向量时, 通过hnsw.ef_search可控制最大搜索条数.
- ivfflat 倒排索引, 为了实现高效的向量搜索, 对表里的向量进行采样, 然后生成若干个聚集点, 不同的聚集点就像不同的网红, 有不同的粉丝群体(注意没有交叉的粉丝). 将表中其他点都放到相应的聚集区域就玩了ivfflat索引的构建.
- 聚集点, 指每个区域中的中心点. 有点类似泰森多边形中的中心点, 多边形里面的所有点离这个中心点最近. 构建索引时, 通过 lists 参数可以指定将整张表的向量划分成多少个区域. 
- 聚集区域, 聚集区域就是区域中的所有点组成的区域. 
- 搜索时探测区域数, 通过设置 ivfflat.probes 参数, 可配置查询时的搜索区域数. 也就是查询时搜索多少个区域. 
- order by, SQL语句控制按什么排序返回结果
- limit, SQL语句控制最多返回条数
- 图式搜索, 使用图来表示关系, 适合于社交、金融风控等场景, 进行复杂的关联分析. 例如谁是网红, 分析可以转账, 推荐好友等. 
- 顶点, 图中的节点
- 边, 图中的边
- 最短路径, 从一个点到另一个点的最短路径
- N度关系, 从一个点出发经过N条边后可以到达的其他点
- 并行度, 数据库中运行某些SQL时可以并行, 并行度指一次拉起多少个并行进程运行这个SQL
- 构建索引最大并行度, 通过max_parallel_maintenance_workers可设置创建索引时的最大并行度.
- pgbench, 压测PostgreSQL数据库的客户端
- 连接数, pgbench 压测数据库时, 通过 -c 参数可指定发起多少个数据库连接
- 客户端线程数, pgbench 压测数据库时, 通过 -j 参数可指定启动多少个客户端线程来处理所有的数据库连接, -c 是 -j 的倍数, 例如 -c 12 -j 3

### 命令
- `Win+R` 按键, 启动 Windows cmd 终端  
- `Win+X` 按键, 选择“终端”, 启动 Windows PowerShell 终端  
- `D:\` , 切换到D盘  
- `cd D:\docker` , 进入D盘docker目录  
- `docker start pg` , 启动 pg 容器  
- `docker stop pg` , 停止 pg 容器  
- `docker exec -ti pg bash` , 进入容器的 bash shell 命令行, 所有命令都在这里执行.   
- `psql` , 从容器的 bash shell 进入到 PostgreSQL 数据库命令行, 所有 SQL 都在这里执行.   
- `\timing` , 在 PostgreSQL 数据库命令行中执行, 打印 SQL 运行时间  
- `\q` , 退出 PostgreSQL 数据库命令行, 回到容器的 bash shell 命令行  
- `duckdb` , 从容器的 bash shell 进入到 DuckDB 数据库命令行, 所有图式数据库 SQL 都在这里执行.   
- `.q` , 退出 DuckDB 数据库命令行, 回到容器的 bash shell 命令行  
- `ollama pull qwen3:0.6b` , 拉取 qwen3 0.6b 规格的模型  
- `ollama pull qwen3-embedding:0.6b` , 拉取 qwen3-embedding 0.6b 规格的模型
- `ollama list` , 列出已经拉取/下载的模型
- `ollama run qwen3:0.6b` , 在 ollama 命令行中使用 `qwen3:0.6b` 模型  
- `Ctrl+D` 按键, 退出 ollama 命令行, 回到上层 Shell  
- `OLLAMA_HOST=0.0.0.0 OLLAMA_ORIGINS="*" ollama serve` , 在 Linux/Mac 中启动 ollama 服务  
- `set OLLAMA_HOST=0.0.0.0&& set OLLAMA_ORIGINS=*&& ollama serve` , 在 windows cmd 终端中启动 ollama 服务  
- `$env:OLLAMA_HOST="0.0.0.0"; $env:OLLAMA_ORIGINS="*"; ollama serve` , 在 windows PowerShell 终端中启动 ollama 服务  
- `Ctrl+C` 按键, 强制退出当前会话正在运行的任务  
  
### FAQ  
1、dify 如何访问宿主机的ollama?   
  
`http://host.docker.internal:11434` , 优先选择这个, 如果无法访问则使用 docker 默认网桥 `172.17.0.1`    
  
`http://172.17.0.1:11434` , 如果这个也不行, 使用宿主机局域网IP.   
  
`http://<你的宿主机局域网IP>:11434` , 如何查询宿主机局域网IP? 如果是 macOS , 可使用docker 虚拟机网桥IP  
  
`http://<macOS docker 虚拟机网桥IP>:11434` , 通常是 192.168.64.1   
  
2、如何查询你的宿主机局域网IP?  
  
Windows PowerShell中运行  
```  
ipconfig  
  
# 关注 IPv4 Address  
```  
  
Linux 终端运行  
```  
ip addr show  
  
# 关注 inet 后面的数字  
```  
  
macOS 终端运行  
```  
# 获取 Wi-Fi 的 IP  
ipconfig getifaddr en0  
  
# 或者查看所有网络接口  
ifconfig | grep "inet "  
```  
  
macOS 查询 docker 虚拟机网桥IP. 注意网桥名字可能不是 bridge100.  
```  
ifconfig bridge100 | grep "inet " | awk '{print $2}'  
```  
    
3、Dify安装不了ollama插件怎么办?  
  
可能是网络问题, 可通过能下载的同学下载到本地, 分发给大家进行本地安装.  
  
4、duckdb attach 远程数据库无法正常下载怎么办?  
  
可能是网络问题, 可通过能下载的同学下载到本地, 分发给大家, 然后上传到docker容器内进行本地attach.  
   
5、无法`git clone dify`怎么办?   
  
可能是网络问题, 可通过能下载的同学下载到本地, 分发给大家.  
  
## 大纲  
0、环境准备
- windows 电脑, 请安装wsl2, 然后安装 docker desktop
- linux 和 mac 电脑, 直接安装 docker desktop
   
**注意:** 建议安装完容器后, 修改容器的资源目录, 因镜像较大. 将容器资源目录修改为有较大空间的磁盘. 如何修改可问AI: `针对不同的操作系统, 如何修改docker desktop的image存放目录?`.        
   
1、环境安装  
  
安装 Docker 环境, 没有环境可使用WASM(可能无法完成所有实验).  
- https://pglite.dev/repl/  
- https://shell.duckdb.org/  
    
推荐使用这个镜像进行学习 (拉到以下文章文末, 拉取镜像, 启动容器) :  
- [《大学生数据库实践课, docker 镜像》](../202512/20251205_02.md)  
  
打包实验用到的插件: pgvector, pgvectorscale, vectorchord, vectorchord-bm25, pg_tokenizer, pg_search, postgresml, duckdb, duckdb-pgq  
  
用AI辅助学习这个章节, 提示词:  
```  
使用postgresql官方docker镜像作为基础镜像, 在此基础上创建新的docker镜像, 要求包含如下:  
1、安装 PostreSQL 插件: pgvector, pgvectorscale, vectorchord, vectorchord-bm25, pg_tokenizer, pg_search, postgresml, jieba , pg_bigm , pgroonga , postgis ;  
2、安装 duckdb cli 二进制, 安装 duckdb-pgq 插件;  
3、安装 pgadmin (参考pgadmin的官方Dockerfile);  
4、将下载自“https://gitee.com/polardb-tianchi/polardb_competition_2025/tree/master/test”的文件和脚本上传到镜像的某个目录中  
请浅显易懂的讲解完成以上任务的步骤, 并给出示例.  
```  
  
2、熟悉基本SQL操作  
- https://www.postgresql.org/docs/online-resources/  
- https://neon.com/postgresql/tutorial  
  
用AI辅助学习这个章节, 提示词: (用postgresql 项目 deepwiki)  
```  
作为刚学完数据库原理的大学生, 以PostgreSQL数据库为例, 给出掌握数据库基本用法的SQL示例, 并解释其语法;  
```  
  
[《大学生数据库实践课: 2 熟悉基本SQL操作》](../202512/20251210_10.md)  
  
3、pgbench 工具  
- https://www.postgresql.org/docs/current/pgbench.html  
  
用AI辅助学习这个章节, 提示词: (用postgresql 项目 deepwiki)  
```  
给出使用pgbench压测postgresql数据库的范例;  
  
给出使用自定义sql对PostgreSQL进行压测的示例, 注意要包含详细步骤如: “设计压测用例, 创建表和索引, 创建压测函数(如有), 生成测试数据(如有), 编写测试脚本, 使用pgbench进行压测”;  
```  
  
[《大学生数据库实践课: 3 pgbench 工具使用》](../202512/20251210_11.md)  
  
4、如何构建测试数据  
- [《沉浸式学习PostgreSQL|PolarDB 12: 如何快速构建 海量 逼真 测试数据》](../202309/20230906_02.md)  
- [《DuckDB 快速生成海量数据的方法》](../202208/20220829_04.md)  
- [《PostgreSQL+MySQL 联合解决方案 - 第3课视频 - 如何压测PG数据库、如何瞬间构造海量测试数据》](../202001/20200103_01.md)  
- [《PostgreSQL 如何快速构建 海量 逼真 测试数据》](../201711/20171121_01.md)  
  
5、如何进行压力测试 (HTAP数据库 PostgreSQL 场景与性能测试 系列)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 3.1 - (OLAP) 大表JOIN统计查询-10亿 join 1亿 agg》](../201711/20171107_49.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 47 - (OLTP多模优化) 空间应用 - 高并发空间位置更新、多属性KNN搜索并测（含空间索引）末端配送、新零售类项目》](../201711/20171107_48.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 46 - (OLTP) 大json字段的高并发更新》](../201711/20171107_47.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 45 - (OLTP) 数据量与性能的线性关系(10亿+无衰减), 暨单表多大需要分区》](../201711/20171107_46.md)  
- [《[未完待续] HTAP数据库 PostgreSQL 场景与性能测试之 44 - (OLTP) 空间应用 - 空间包含查询(输入多边形 包含 表内空间对象)》](../201711/20171107_45.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 43 - (OLTP+OLAP) unlogged table 含索引多表批量写入》](../201711/20171107_44.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 42 - (OLTP+OLAP) unlogged table 不含索引多表批量写入》](../201711/20171107_43.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 41 - (OLTP+OLAP) 含索引多表批量写入》](../201711/20171107_42.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 40 - (OLTP+OLAP) 不含索引多表批量写入》](../201711/20171107_41.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 39 - (OLTP+OLAP) logged & unlogged table 含索引多表单点写入》](../201711/20171107_40.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 38 - (OLTP+OLAP) logged & unlogged table 不含索引多表单点写入》](../201711/20171107_39.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 37 - (OLTP+OLAP) 含索引单表批量写入》](../201711/20171107_38.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 36 - (OLTP+OLAP) 不含索引单表批量写入》](../201711/20171107_37.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 35 - (OLTP+OLAP) 含索引单表单点写入》](../201711/20171107_36.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 34 - (OLTP+OLAP) 不含索引单表单点写入》](../201711/20171107_35.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 33 - (OLAP) 物联网 - 线性字段区间实时统计》](../201711/20171107_34.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 32 - (OLTP) 高吞吐数据进出(堆存、行扫、无需索引) - 阅后即焚(JSON + 函数流式计算)》](../201711/20171107_33.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 31 - (OLTP) 高吞吐数据进出(堆存、行扫、无需索引) - 阅后即焚(读写大吞吐并测)》](../201711/20171107_32.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 30 - (OLTP) 秒杀 - 高并发单点更新》](../201711/20171107_31.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 29 - (OLTP) 空间应用 - 高并发空间位置更新（含空间索引）》](../201711/20171107_30.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 28 - (OLTP) 高并发点更新》](../201711/20171107_29.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 27 - (OLTP) 物联网 - FEED日志, 流式处理 与 阅后即焚 (CTE)》](../201711/20171107_28.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 26 - (OLTP) NOT IN、NOT EXISTS 查询》](../201711/20171107_27.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 25 - (OLTP) IN , EXISTS 查询》](../201711/20171107_26.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 24 - (OLTP) 物联网 - 时序数据并发写入(含时序索引BRIN)》](../201711/20171107_25.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 23 - (OLAP) 并行计算》](../201711/20171107_24.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 22 - (OLTP) merge insert|upsert|insert on conflict|合并写入》](../201711/20171107_23.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 21 - (OLTP+OLAP) 排序、建索引》](../201711/20171107_22.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 20 - (OLAP) 用户画像圈人场景 - 多个字段任意组合条件筛选与透视》](../201711/20171107_21.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 19 - (OLAP) 用户画像圈人场景 - 数组相交查询与聚合》](../201711/20171107_20.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 18 - (OLAP) 用户画像圈人场景 - 数组包含查询与聚合》](../201711/20171107_19.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 17 - (OLTP) 数组相似查询》](../201711/20171107_18.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 16 - (OLTP) 文本特征向量 - 相似特征(海明...)查询》](../201711/20171107_17.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 15 - (OLTP) 物联网 - 查询一个时序区间的数据》](../201711/20171107_16.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 14 - (OLTP) 字符串搜索 - 全文检索》](../201711/20171107_15.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 13 - (OLTP) 字符串搜索 - 相似查询》](../201711/20171107_14.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 12 - (OLTP) 字符串搜索 - 前后模糊查询》](../201711/20171107_13.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 11 - (OLTP) 字符串搜索 - 后缀查询》](../201711/20171107_12.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 10 - (OLTP) 字符串搜索 - 前缀查询》](../201711/20171107_11.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 9 - (OLTP) 字符串模糊查询 - 含索引实时写入》](../201711/20171107_10.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 8 - (OLTP) 多值类型(数组)含索引实时写入》](../201711/20171107_09.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 7 - (OLTP) 全文检索 - 含索引实时写入》](../201711/20171107_08.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 6 - (OLTP) 空间应用 - KNN查询（搜索附近对象，由近到远排序输出）》](../201711/20171107_07.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 5 - (OLTP) 空间应用 - 空间包含查询(表内多边形 包含 输入空间对象)》](../201711/20171107_06.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 4 - (OLAP) 大表OUTER JOIN统计查询》](../201711/20171107_05.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 3 - (OLAP) 大表JOIN统计查询》](../201711/20171107_04.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 2 - (OLTP) 多表JOIN》](../201711/20171107_03.md)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 1 - (OLTP) 点查》](../201711/20171107_02.md)  
  
6、RAG 概念  
- [《为什么用了RAG, 我的AI还是笨得跟猪一样! RAG效果评测与优化》](../202504/20250414_04.md)  
  
用AI辅助学习这个章节, 提示词: (用 qwen/gemini 上传附件功能)  
```  
面向大学生, 通俗易懂的解读以上文章;  
针对以上文章, 循序渐进的提出几个问题, 帮助加深对文章的理解;  
浅显易懂的回答这几个问题;  
```  
  
[《大学生数据库实践课: 6 RAG 概念》](../202512/20251210_12.md)  
  
7、Ollama 部署  
  
模型分类(推理、embedding、ranking)  
  
本地模型(huggingface, ollama 集市)  
  
云端模型(阿里云)  
  
模型 API  
  
用AI辅助学习这个章节, 提示词:  
```  
面向大学生通俗讲解以下内容:  
1、模型分类介绍(MoE模型、多模态模型、推理模型、embedding、ranking 等)  
2、使用ollama快速部署本地模型(huggingface, ollama 集市) , 并给出使用示例  
3、云端模型API介绍(例如 阿里云)  
4、本地ollama模型 API 介绍  
5、给出curl和Dify调用模型API示例  
```  
  
[《大学生数据库实践课: 7.1 模型介绍》](../202512/20251210_13.md)  
[《大学生数据库实践课: 7.2 ollama 部署》](../202512/20251210_14.md)  
[《大学生数据库实践课: 7.3 云端模型API介绍》](../202512/20251210_15.md)  
[《大学生数据库实践课: 7.4 ollama API介绍》](../202512/20251210_16.md)  
  
8、切词方法介绍  
  
用AI辅助学习这个章节, 提示词:  
```  
面向大学生通俗讲解以下内容:  
1、RAG 介绍  
2、为什么要embedding?  
3、embedding 之前为什么要对文本进行切分?  
4、文本切分的方法以及各自的优缺点介绍  
```  
  
[《大学生数据库实践课: 8 embedding 文本切分方法介绍》](../202512/20251210_17.md)  
  
9、切词和embedding实操  
  
使用postgresml插件实操切词和embedding  
  
用AI辅助学习这个章节, 提示词: (用 postgresml 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、RAG 介绍  
2、为什么要embedding?  
3、embedding 之前为什么要对文本进行切分?  
4、文本切分的方法以及各自的优缺点介绍  
```  
  
[《大学生数据库实践课: 9 embedding 文本切分实操》](../202512/20251210_18.md)  
  
10、dify 介绍, 安装和使用  
  
使用dify工具, 了解模型配置、模型调参、RAG配置等.  
  
用AI辅助学习这个章节, 提示词: (用 dify 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、Dify RAG 配置示例  
2、详细讲解 Dify 文本切分配置、模型配置、模型调参  
```  
  
[《大学生数据库实践课: 10 Dify RAG 配置详解》](../202512/20251210_19.md)  
  
11、向量类型  
  
了解向量类型(全精、半精、二值), 向量距离算法;  
  
了解 hnsw, ivfflat, diskann 索引接口; (参考向量索引 hnsw, ivfflat, diskann 筑基课/论文/blog)  
  
了解 sbq, rabitq, 二值量化技术原理;  
  
用AI辅助学习这个章节, 提示词: (用 pgvector 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、hnsw 索引原理  
2、ivfflat 索引原理  
3、hnsw 索引使用示例  
4、ivfflat 索引使用示例  
5、hnsw 和 ivfflat 索引优化示例  
```  
  
用AI辅助学习这个章节, 提示词: (用 pgvectorscale 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、diskann 原理介绍  
2、diskann 索引使用示例  
3、diskann 索引优化示例  
```  
  
用AI辅助学习这个章节, 提示词: (用 vectorchord 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、vectorchord 的优势讲解  
2、vectorchord ivf 索引原理  
3、vectorchord 图 索引原理  
4、vectorchord ivf 索引使用示例  
5、vectorchord 图 索引使用示例  
6、vectorchord ivf 索引优化实践  
7、vectorchord 图 索引优化实践  
```  
   
[《大学生数据库实践课: 11.1 向量类型基础》](../202512/20251211_07.md)  
[《大学生数据库实践课: 11.2 pgvector向量索引》](../202512/20251211_08.md)  
[《大学生数据库实践课: 11.3 pgvectorscale向量索引》](../202512/20251211_09.md)  
[《大学生数据库实践课: 11.4 vectorchord向量索引》](../202512/20251211_10.md)  
[《大学生数据库实践课: 11.4.1 线性量化技术》](../202512/20251211_11.md)  
  
12、召回率概念  
  
用AI辅助学习这个章节, 提示词: (用 pgvector 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、什么是召回率  
2、如何评测召回率  
3、如何提升召回率  
4、召回率和查询性能的平衡  
```  
  
[《大学生数据库实践课: 12 召回率》](../202512/20251211_12.md)  
  
13、向量搜索优化实战  
  
优化原理: 参考向量索引优化  [《德说-第362期, 读了500篇论文和数个顶级向量数据库项目后, 面向AI 搜索场景的数据库索引设计和优化思考》](../202511/20251110_11.md)  
  
采用 PolarDB 2025 大学生数据库竞赛题目和test目录测试脚本  
- download 测试集 (打包进docker image)  
- 建表并导入数据  
- 创建索引  
- 设计召回率计算SQL  
- 统计召回率  
- 设计性能测试SQL  
  
用AI辅助学习这个章节, 提示词: (用 qwen/gemini 上传文档功能) [《德说-第362期, 读了500篇论文和数个顶级向量数据库项目后, 面向AI 搜索场景的数据库索引设计和优化思考》](../202511/20251110_11.md)  
```  
面向大学生通俗讲解这篇文章;  
提出3个循序渐进的问题, 帮助理解这篇文章;  
通俗易懂的回答这3个问题;  
```  
  
用AI辅助学习这个章节, 提示词: (用 https://deepwiki.com/digoal/PolarDB-for-PostgreSQL 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、什么是召回率  
2、如何评测召回率  
3、如何提升召回率  
4、召回率和查询性能的平衡  
```  
  
[《大学生数据库实践课: 13 向量搜索优化实战》](../202512/20251211_13.md)  
  
14、全文检索/关键词检索  
  
vectorchord-bm25 , pg_tokenizer , pg_jieba , pg_trgm , pg_bigm , pgroonga  
  
用AI辅助学习这个章节, 提示词: (用 vectorchord-bm25 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、什么是关键词检索  
2、如何提取文本关键词  
3、如何计算查询语句和文本的相关性  
4、给出关键词检索的使用示例  
5、如何通过索引加速关键词搜索  
6、索引原理详解  
```  
  
[《大学生数据库实践课: 14.1 从文本到关键词》](../202512/20251211_14.md)  
[《大学生数据库实践课: 14.2 关键词检索》](../202512/20251211_15.md)  
  
15、标量检索  
  
用AI辅助学习这个章节, 提示词: (用 vectorchord 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、什么是标量检索  
2、标量检索例子  
3、标量检索优化  
```  
  
[《大学生数据库实践课: 15 标量检索》](../202512/20251211_16.md)  
  
16、混合搜索  
  
用AI辅助学习这个章节, 提示词: (用 vectorchord 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、什么是混合检索  
2、混合检索例子  
3、混合检索用到的加速技术和原理讲解  
4、混合检索用到的索引和原理讲解  
```  
  
[《大学生数据库实践课: 16.1 vectorchord 混合搜索》](../202512/20251211_17.md)  
[《大学生数据库实践课: 16.2 pgvectorscale 混合搜索》](../202512/20251211_18.md)  
[《大学生数据库实践课: 16.3 pgvector 混合搜索》](../202512/20251211_19.md)  
  
17、混合搜索优化技术  
  
混合索引、分区/剪枝优化 (参考 vectorchord, vexdb 项目)  
  
查询级 RRF 优化(参考 vectorchord)  
  
用AI辅助学习这个章节, 提示词: (用 vectorchord 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、什么是混合检索  
2、混合检索例子: 使用CTE将标量检索、关键词检索、向量检索进行union, 并为每个检索的结果赋予权重, 最终使用RRF进行综合排序, 返回TOP N  
3、混合检索的RRF和ranking技术和原理  
```
  
[《混合搜索的三大技术流派, 差异在哪? 哪个更有前途?》](../202510/20251027_09.md)  
    
18、PGQ 图式搜索语法讲解  
  
用AI辅助学习这个章节, 提示词: (用 duckdb-pgq 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、什么是属性图  
2、属性图语法详解  
3、表示属性图特征的统计信息有哪些? 详细介绍, 例如连通性? 聚集性? 
4、属性图可以用来挖掘数据的哪些特征信息? 例如最短路径, 共同好友, N度关系? 还有更多吗? 请详细讲解每一种特征信息以及使用示例!
5、详细介绍广度优先、深度优先  
6、duckdb-pgq 相比其他图数据库的优势及劣势  
7、属性图搜索性能优化技巧  
```  
  
[《大学生数据库实践课: 18 PGQ 图式搜索》](../202512/20251211_20.md)  
  
19、PGQ 实验(基于duckdb-pgq文档数据集)  
  
https://duckpgq.org/  
  
[《使用 DuckDB 图查询(PGQ)揭示金融犯罪》](../202510/20251023_13.md)  
  
用AI辅助学习这个章节, 提示词: (用 https://deepwiki.com/cwida/duckpgq-extension 项目 deepwiki)  
```  
面向大学生通俗讲解以下内容:  
1、给出使用图数据库的几个典型场景示例  
```  
  
用AI辅助学习这个章节, 提示词: (用 https://duckpgq.org/ 项目范例和 https://deepwiki.com/cwida/duckpgq-extension, 贴出例子并询问AI)  
```  
面向大学生通俗讲解以下内容:  
1、基于以下内容对应的实际场景, 讲解场景的背景和需求, 解释例子中的语法细节;  
2、基于以下内容提出3个循序渐进的问题, 帮助理解图数据库的设计原理、语法和使用场景;  
  
ATTACH 'https://github.com/Dtenwolde/duckpgq-docs/raw/refs/heads/main/datasets/snb.duckdb';  
  
use snb;  
install duckpgq from community;  
load duckpgq;  
  
CREATE or replace PROPERTY GRAPH snb  
VERTEX TABLES (  
  Person, Forum  
)  
EDGE TABLES (  
  Person_knows_person     SOURCE KEY (Person1Id) REFERENCES Person (id)  
                          DESTINATION KEY (Person2Id) REFERENCES Person (id)  
                          LABEL knows,  
  Forum_hasMember_Person  SOURCE KEY (ForumId) REFERENCES Forum (id)  
                          DESTINATION KEY (PersonId) REFERENCES Person (id)  
                          LABEL hasMember  
);  
  
-- find the shortest path from one person to all other persons  
FROM GRAPH_TABLE (snb  
  MATCH p = ANY SHORTEST (p1:person WHERE p1.id = 14)-[k:knows]->*(p2:person)  
  COLUMNS (p1.id, p2.id as other_person_id, element_id(p), path_length(p))  
);  
  
-- Find mutual friends between two users  
FROM GRAPH_TABLE (snb  
  MATCH (p1:Person WHERE p1.id = 16)-[k:knows]->(p2:Person)<-[k2:knows]-(p3:Person WHERE p3.id = 32)  
  COLUMNS (p2.firstName)  
);  
  
-- Find the 3 most popular people  
FROM GRAPH_TABLE (snb  
  MATCH (follower:Person)-[follows:knows]->(person:Person)  
  COLUMNS (person.id AS personID, person.firstname, person.lastname, follower.id AS followerID)  
)  
SELECT personID, firstname, lastname, COUNT(followerID) AS numFollowers  
GROUP BY ALL  
ORDER BY numFollowers DESC  
LIMIT 3;  
  
-- Number of forums posted on by the most followed person  
WITH  
mfp AS (  
  FROM GRAPH_TABLE (snb  
    MATCH (follower:Person)-[follows:knows]->(person:Person)  
    COLUMNS (person.id AS personID, person.firstname, follower.id AS followerID)  
  )  
SELECT personID, firstname, COUNT(followerID) AS numFollowers  
GROUP BY ALL ORDER BY numFollowers DESC LIMIT 1  
)  
FROM  
  mfp,  
  GRAPH_TABLE (snb  
    MATCH (person:Person)<-[fhm:hasMember]-(f:Forum)  
    COLUMNS (person.id AS personID, f.id as forumId)  
) mem  
SELECT mfp.personID, mfp.firstname, mfp.numFollowers, count(mem.forumId) forumCount  
WHERE mfp.personID = mem.personID  
GROUP BY ALL;  
```  
  
[《大学生数据库实践课: 19.1 PGQ 社交场景实践》](../202512/20251211_21.md)  
[《大学生数据库实践课: 19.2 PGQ 航空数据分析实践》](../202512/20251211_22.md)  
[《大学生数据库实践课: 19.3 PGQ 金融反欺诈风控系统实践》](../202512/20251211_23.md)  
  
## 课后大作业  
[《大学生数据库实践课 : 课后大作业》](../202512/20251217_02.md)  
  
带同学们分组打一场比赛, 比赛规则见课后大作业文末.  
  
## 实验手册
[《大学生数据库实践课 : 实验手册》](../202512/20251230_01.md)  
  
## 参考  
1、筑基课  
- [IVFFlat](../202512/20251202_09.md)  
- [HNSW](../202506/20250624_03.md)  
- [强势回归，数据库筑基课｜向量索引之 HNSW](https://mp.weixin.qq.com/s/4UGPpzCHKA137b6O0WqGBQ)  
- [HNSW索引原理直播讲解](https://mp.weixin.qq.com/s/roaTuYgM8i0qv12_ZDmLoQ)  
  
2、论文  
- [《AI论文解读 | Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World graphs》](../202506/20250619_02.md)  
- [《AI论文解读 | RaBitQ: Quantizing High-Dimensional Vectors with A Theoretical Error Bound for Approximate Nearest Neighbor Search》](../202512/20251201_03.md)  
- [《AI论文解读 | Filtered − DiskANN: Graph Algorithms for Approximate Nearest Neighbor Search with Filters》](../202507/20250702_01.md)  
- [《AI论文解读 | FreshDiskANN: A Fast and Accurate Graph-Based ANN Index for Streaming Similarity Search》](../202507/20250701_01.md)  
- [《AI论文解读 | DiskANN: Fast Accurate Billion-point Nearest Neighbor Search on a Single Node》](../202505/20250514_03.md)  
  
3、开源项目  
- https://github.com/postgres/postgres  
- https://github.com/duckdb/duckdb  
- https://github.com/milvus-io/milvus  
- https://github.com/pgvector/pgvector  
- https://github.com/timescale/pgvectorscale  
- https://github.com/tensorchord/VectorChord  
- https://github.com/tensorchord/VectorChord-bm25  
- https://github.com/tensorchord/pg_tokenizer.rs  
- https://github.com/cwida/duckdb-pgq  
- https://github.com/apache/age/  
- https://github.com/GraphBLAS  
- https://github.com/OneSparse/OneSparse  
- https://github.com/langgenius/dify  
- https://postgis.net/  
- 以上项目对应 deepwiki  
- https://deepwiki.com/langchain-ai/langgraph/  
- https://deepwiki.com/vllm-project/vllm/  
- https://deepwiki.com/duckdb/duckdb-vss/  
- https://deepwiki.com/VectorDB-NTU/RaBitQ-Library/  
- https://deepwiki.com/quickwit-oss/tantivy/  
- https://deepwiki.com/postgresml/postgresml/  
- https://github.com/paradedb/paradedb/  
  
4、源码解读  
- [《2025-DuckDB 源码入门学习27篇 汇总》](../202510/20251024_17.md)  
- [《2025-Milvus 源码入门学习31篇 汇总》](../202510/20251029_08.md)  
- [《2025-VectorChord 源码入门学习39篇 汇总》](../202511/20251103_17.md)  
- [《2025-pgvector 源码入门学习27篇 汇总》](../202511/20251105_17.md)  
- [《2025-DuckPGQ 源码入门学习35篇 汇总》](../202511/20251108_14.md)  
- [《2025-pgvectorscale(StreamingDiskANN) 源码入门学习39篇 汇总》](../202511/20251112_20.md)  
- [《2025-pg_tokenizer 源码入门学习29篇 汇总》](../202511/20251121_18.md)  
- [《2025-VectorChord-bm25 源码入门学习20篇 汇总》](../202511/20251126_18.md)  
- [《2025-SeekDB 源码入门学习13篇 汇总》](../202511/20251126_19.md)  
  
5、相关文档  
- [《谁说国产只会套壳, 这个国产向量数据库就不是pgvector套壳》](../202509/20250924_06.md)  
- [《VexDB BM25 算法的全文检索 fulltext 索引原理与实践》](../202510/20251011_07.md)  
- [《VexDB HybridAnn 向量标量混合索引原理与实践》](../202510/20251011_06.md)  
- [《VexDB DiskANN 图索引原理与实践》](../202510/20251011_05.md)  
- [《VexDB Graph_Index 图索引原理与实践》](../202510/20251011_04.md)  
- [《容器体验VexDB! 暴露PostgreSQL,openGauss,vastbase基因》](../202509/20250925_07.md)  
- [《德说-第362期, 读了500篇论文和数个顶级向量数据库项目后, 面向AI 搜索场景的数据库索引设计和优化思考》](../202511/20251110_11.md)  
- [《图数据库赛道没了 | SQL:PGQ标准出炉, 还不懂PGQ图式查询用法? 用DuckDB将PGQ一次整明白》](../202507/20250727_01.md)  
- [《使用 DuckDB 图查询(PGQ)揭示金融犯罪》](../202510/20251023_13.md)  
- [《还在为age图插件的停更惋惜? Postgres用GraphBLAS每秒处理数十亿条边》](../202507/20250723_08.md)  
- [《AGE要复活了? PG将内置PGQ(SQL:2023 Property-Graph Queries)》](../202507/20250725_06.md)  
- [《他山之石可以攻玉 | 向量召回IO性能问题解决之道 - 线性化降维(Hilbert & Z-Order)》](../202412/20241213_03.md)  
- [《提升RAG召回效果的方法探讨》](../202408/20240823_01.md)  
- [《向量搜索优化3板斧: 空间、性能、召回(recall)》](../202405/20240506_03.md)  
- [《头大! 索引扫描和全表扫描结果不一样, 这向量数据库还能用? 教你一招大幅提升召回率(recall)》](../202404/20240417_01.md)  
- [《为什么用了RAG, 我的AI还是笨得跟猪一样! RAG效果评测与优化》](../202504/20250414_04.md)  
- [《大模型(LLM) ACA ACP 通关经验分享》](../202504/20250411_01.md)  
- [《大学生数据库实践课设计》](../202509/20250903_06.md)  
  
6、测试数据集  
- http://ann-benchmarks.com  
- https://gitee.com/polardb-tianchi/polardb_competition_2025/tree/master/test  
- 向量数据库相关测试数据集和 benchmark  
- 图量数据库相关测试数据集和 benchmark  
  
7、其他  
- [《2023-PostgreSQL Docker镜像学习环境 ARM64版, 已集成热门插件和工具》](../202308/20230814_02.md)  
- [《2023-PostgreSQL Docker镜像学习环境 AMD64版, 已集成热门插件和工具》](../202307/20230710_03.md)  
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")  
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")  
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")  
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")  
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")  
  
