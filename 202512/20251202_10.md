## 大学生数据库实践课开课了 : 1 大纲  
      
### 作者      
digoal      
      
### 日期      
2025-12-02      
      
### 标签      
PostgreSQL , DuckDB , 语义搜索 , 向量搜索 , 关键词检索 , 全文检索 , 标量检索 , 混合搜索 , 多模态搜索 , 重排序 , embedding , document split , ORC , 大模型 , 多模态大模型 , Dify , 压力测试 , 索引优化 , 倒排向量索引 , Ivfflat , 图向量索引 , HNSW , DiskANN , 量化 , rabitq , sbq , 二值量化 , bm25 , 相关性 , 相似性 , 召回率 , pgbench , 数据集 , ann-benchmarks , 图搜索 , PGQ , 递归 , 深度优先 , 广度优先 , 最短路径 , N度关系 , LLM , Ollama    
      
----      
      
## 背景   
在 AI+ 时代, 数据会越来越重要, AI 可以被拆成3大要素: 大脑(LLM), 数据(记忆和知识库), 感官(MCP/function call).    
  
AI 处理任务的基本模式: 当 AI 接收到“任务指令/反馈”后, 通过大脑来进行推理, 在记忆和知识库中召回补充任务相关素材, 通过 mcp/function call 调用相关的外部工具并获得反馈. 循环往复.   
  
数据是 AI 的三大要素之一, 不可或缺.   
  
数据包括结构化数据(例如表格)、非结构化数据(例如文本、图像、音频、视频、地图等), 这些数据如何进行高效率的组织? 如何快速搜索到与任务最相关的数据? 如何标定相关性? 如何覆盖所有相关数据? 是数据库设计的关键!   
  
这么多数据种类, 不同种类搜索算子也各不相同(例如数值可能涉及的是比较大小, 排序; 文本涉及的是模糊匹配、关键词匹配、语义匹配等; 音频视频涉及的可能是相似内容、归类、特征匹配等; 地图涉及近邻搜索、空间交叠计算等; 结构化数据可能还包括图式关系搜索例如最短路径、N度关联等; 更多类型和相应的算子并未完全列出, 不过可想而知是非常庞杂的.    
  
AI 到底需要什么样的数据库才能满足以上诉求呢?   
  
答案可能是多模态数据库, 可以处理多种模态的数据!  
  
由于课程篇幅限制, 此课程将聚焦AI 搜索中最常见的这几个方面进行讲解: **向量化、语义搜索、关键词检索、标量检索、混合搜索、召回率、相关性、重排、图式搜索**  
  
掌握这些内容可以覆盖市面上最流行的 AI 应用框架对数据库数据搜索的需求, 例如: Dify, langgraph, langchain.    
  
## 大纲  
1、环境安装  
  
安装 Docker 环境, 没有环境可使用WASM(可能无法完成所有实验).   
- https://pglite.dev/repl/  
- https://shell.duckdb.org/  
- [《大学生数据库实践课 - PostgreSQL本地学习镜像的使用》](../202509/20250903_08.md)    
  
打包实验用到的插件: pgvector, pgvectorscale, vectorchord, vectorchord-bm25, pg_tokenizer, pg_search, postgresml, duckdb, duckdb-pgq   
  
2、熟悉基本SQL操作  
- https://www.postgresql.org/docs/online-resources/  
- https://neon.com/postgresql/tutorial  
  
3、pgbench 工具  
- https://www.postgresql.org/docs/current/pgbench.html  
  
4、如何构建测试数据  
- [《沉浸式学习PostgreSQL|PolarDB 12: 如何快速构建 海量 逼真 测试数据》](../202309/20230906_02.md)    
- [《DuckDB 快速生成海量数据的方法》](../202208/20220829_04.md)    
- [《PostgreSQL+MySQL 联合解决方案 - 第3课视频 - 如何压测PG数据库、如何瞬间构造海量测试数据》](../202001/20200103_01.md)    
- [《PostgreSQL 如何快速构建 海量 逼真 测试数据》](../201711/20171121_01.md)    
  
5、如何进行压力测试 (HTAP数据库 PostgreSQL 场景与性能测试 系列)  
- [《HTAP数据库 PostgreSQL 场景与性能测试之 3.1 - (OLAP) 大表JOIN统计查询-10亿 join 1亿 agg》](../201711/20171107_49.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 47 - (OLTP多模优化) 空间应用 - 高并发空间位置更新、多属性KNN搜索并测（含空间索引）末端配送、新零售类项目》](../201711/20171107_48.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 46 - (OLTP) 大json字段的高并发更新》](../201711/20171107_47.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 45 - (OLTP) 数据量与性能的线性关系(10亿+无衰减), 暨单表多大需要分区》](../201711/20171107_46.md)    
- [《[未完待续] HTAP数据库 PostgreSQL 场景与性能测试之 44 - (OLTP) 空间应用 - 空间包含查询(输入多边形 包含 表内空间对象)》](../201711/20171107_45.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 43 - (OLTP+OLAP) unlogged table 含索引多表批量写入》](../201711/20171107_44.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 42 - (OLTP+OLAP) unlogged table 不含索引多表批量写入》](../201711/20171107_43.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 41 - (OLTP+OLAP) 含索引多表批量写入》](../201711/20171107_42.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 40 - (OLTP+OLAP) 不含索引多表批量写入》](../201711/20171107_41.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 39 - (OLTP+OLAP) logged & unlogged table 含索引多表单点写入》](../201711/20171107_40.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 38 - (OLTP+OLAP) logged & unlogged table 不含索引多表单点写入》](../201711/20171107_39.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 37 - (OLTP+OLAP) 含索引单表批量写入》](../201711/20171107_38.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 36 - (OLTP+OLAP) 不含索引单表批量写入》](../201711/20171107_37.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 35 - (OLTP+OLAP) 含索引单表单点写入》](../201711/20171107_36.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 34 - (OLTP+OLAP) 不含索引单表单点写入》](../201711/20171107_35.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 33 - (OLAP) 物联网 - 线性字段区间实时统计》](../201711/20171107_34.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 32 - (OLTP) 高吞吐数据进出(堆存、行扫、无需索引) - 阅后即焚(JSON + 函数流式计算)》](../201711/20171107_33.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 31 - (OLTP) 高吞吐数据进出(堆存、行扫、无需索引) - 阅后即焚(读写大吞吐并测)》](../201711/20171107_32.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 30 - (OLTP) 秒杀 - 高并发单点更新》](../201711/20171107_31.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 29 - (OLTP) 空间应用 - 高并发空间位置更新（含空间索引）》](../201711/20171107_30.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 28 - (OLTP) 高并发点更新》](../201711/20171107_29.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 27 - (OLTP) 物联网 - FEED日志, 流式处理 与 阅后即焚 (CTE)》](../201711/20171107_28.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 26 - (OLTP) NOT IN、NOT EXISTS 查询》](../201711/20171107_27.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 25 - (OLTP) IN , EXISTS 查询》](../201711/20171107_26.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 24 - (OLTP) 物联网 - 时序数据并发写入(含时序索引BRIN)》](../201711/20171107_25.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 23 - (OLAP) 并行计算》](../201711/20171107_24.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 22 - (OLTP) merge insert|upsert|insert on conflict|合并写入》](../201711/20171107_23.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 21 - (OLTP+OLAP) 排序、建索引》](../201711/20171107_22.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 20 - (OLAP) 用户画像圈人场景 - 多个字段任意组合条件筛选与透视》](../201711/20171107_21.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 19 - (OLAP) 用户画像圈人场景 - 数组相交查询与聚合》](../201711/20171107_20.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 18 - (OLAP) 用户画像圈人场景 - 数组包含查询与聚合》](../201711/20171107_19.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 17 - (OLTP) 数组相似查询》](../201711/20171107_18.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 16 - (OLTP) 文本特征向量 - 相似特征(海明...)查询》](../201711/20171107_17.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 15 - (OLTP) 物联网 - 查询一个时序区间的数据》](../201711/20171107_16.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 14 - (OLTP) 字符串搜索 - 全文检索》](../201711/20171107_15.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 13 - (OLTP) 字符串搜索 - 相似查询》](../201711/20171107_14.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 12 - (OLTP) 字符串搜索 - 前后模糊查询》](../201711/20171107_13.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 11 - (OLTP) 字符串搜索 - 后缀查询》](../201711/20171107_12.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 10 - (OLTP) 字符串搜索 - 前缀查询》](../201711/20171107_11.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 9 - (OLTP) 字符串模糊查询 - 含索引实时写入》](../201711/20171107_10.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 8 - (OLTP) 多值类型(数组)含索引实时写入》](../201711/20171107_09.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 7 - (OLTP) 全文检索 - 含索引实时写入》](../201711/20171107_08.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 6 - (OLTP) 空间应用 - KNN查询（搜索附近对象，由近到远排序输出）》](../201711/20171107_07.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 5 - (OLTP) 空间应用 - 空间包含查询(表内多边形 包含 输入空间对象)》](../201711/20171107_06.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 4 - (OLAP) 大表OUTER JOIN统计查询》](../201711/20171107_05.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 3 - (OLAP) 大表JOIN统计查询》](../201711/20171107_04.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 2 - (OLTP) 多表JOIN》](../201711/20171107_03.md)    
- [《HTAP数据库 PostgreSQL 场景与性能测试之 1 - (OLTP) 点查》](../201711/20171107_02.md)    
  
6、RAG 概念  
- [《为什么用了RAG, 我的AI还是笨得跟猪一样! RAG效果评测与优化》](../202504/20250414_04.md)    
  
7、Ollama 部署  
  
模型分类(推理、embedding、ranking)  
  
模型 API  
  
本地模型(huggingface, ollama 集市)  
  
云端模型(阿里云)  
  
8、切词方法介绍  
  
9、切词和embedding实操  
  
使用postgresml插件实操切词和embedding  
  
10、dify 介绍, 安装和使用   
  
使用dify工具, 了解模型配置、模型调参、RAG配置等.    
  
11、向量类型  
  
了解向量类型(全精、半精、二值), 向量距离算法;   
  
了解 hnsw, ivfflat, diskann 索引接口; (参考向量索引 hnsw, ivfflat, diskann 筑基课/论文/blog)  
  
了解 sbq, rabitq, 二值量化技术原理;  
  
12、召回率概念  
  
13、向量搜索优化实战  
  
优化原理: 参考向量索引优化 (500篇论文)  
  
采用 PolarDB 2025 大学生数据库竞赛题目和test目录测试脚本  
  
download 测试集 (打包进docker image)  
建表并导入数据  
创建索引  
设计召回率计算SQL  
统计召回率  
设计性能测试SQL  
  
14、全文检索/关键词检索  
  
bm25 , jieba , pg_trgm , pg_bigm , pgroonga    
  
15、标量检索  
  
16、混合搜索  
  
17、混合搜索优化技术  
  
混合索引、分区/剪枝优化 (参考 vectorchord, vexdb 项目)  
  
查询级 RRF 优化(参考 vectorchord)  
  
18、PGQ 图式搜索语法讲解  
  
19、PGQ 实验(基于duckdb-pgq文档数据集)  
  
https://duckpgq.org/  
  
## 参考  
1、筑基课  
- [IVFFlat](../202512/20251202_09.md)  
- [HNSW](../202506/20250624_03.md)   
- [强势回归，数据库筑基课｜向量索引之 HNSW](https://mp.weixin.qq.com/s/4UGPpzCHKA137b6O0WqGBQ)  
- [HNSW索引原理直播讲解](https://mp.weixin.qq.com/s/roaTuYgM8i0qv12_ZDmLoQ)  
  
2、论文  
- [《AI论文解读 | Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World graphs》](../202506/20250619_02.md)    
- [《AI论文解读 | RaBitQ: Quantizing High-Dimensional Vectors with A Theoretical Error Bound for Approximate Nearest Neighbor Search》](../202512/20251201_03.md)    
- [《AI论文解读 | Filtered − DiskANN: Graph Algorithms for Approximate Nearest Neighbor Search with Filters》](../202507/20250702_01.md)    
- [《AI论文解读 | FreshDiskANN: A Fast and Accurate Graph-Based ANN Index for Streaming Similarity Search》](../202507/20250701_01.md)    
- [《AI论文解读 | DiskANN: Fast Accurate Billion-point Nearest Neighbor Search on a Single Node》](../202505/20250514_03.md)   
  
3、开源项目  
- https://github.com/postgres/postgres  
- https://github.com/duckdb/duckdb  
- https://github.com/milvus-io/milvus  
- https://github.com/pgvector/pgvector  
- https://github.com/timescale/pgvectorscale  
- https://github.com/tensorchord/VectorChord  
- https://github.com/tensorchord/VectorChord-bm25  
- https://github.com/tensorchord/pg_tokenizer.rs  
- https://github.com/cwida/duckdb-pgq  
- https://github.com/apache/age/  
- https://github.com/GraphBLAS  
- https://github.com/OneSparse/OneSparse  
- https://github.com/langgenius/dify  
- https://postgis.net/  
- 以上项目对应 deepwiki   
- https://deepwiki.com/langchain-ai/langgraph/   
- https://deepwiki.com/vllm-project/vllm/   
- https://deepwiki.com/duckdb/duckdb-vss/   
- https://deepwiki.com/VectorDB-NTU/RaBitQ-Library/   
- https://deepwiki.com/quickwit-oss/tantivy/   
- https://deepwiki.com/postgresml/postgresml/   
- https://github.com/paradedb/paradedb/  
  
4、源码解读  
- [《2025-DuckDB 源码入门学习27篇 汇总》](../202510/20251024_17.md)       
- [《2025-Milvus 源码入门学习31篇 汇总》](../202510/20251029_08.md)       
- [《2025-VectorChord 源码入门学习39篇 汇总》](../202511/20251103_17.md)       
- [《2025-pgvector 源码入门学习27篇 汇总》](../202511/20251105_17.md)       
- [《2025-DuckPGQ 源码入门学习35篇 汇总》](../202511/20251108_14.md)       
- [《2025-pgvectorscale(StreamingDiskANN) 源码入门学习39篇 汇总》](../202511/20251112_20.md)       
- [《2025-pg_tokenizer 源码入门学习29篇 汇总》](../202511/20251121_18.md)       
- [《2025-VectorChord-bm25 源码入门学习20篇 汇总》](../202511/20251126_18.md)       
- [《2025-SeekDB 源码入门学习13篇 汇总》](../202511/20251126_19.md)      
  
5、相关文档  
- [《谁说国产只会套壳, 这个国产向量数据库就不是pgvector套壳》](../202509/20250924_06.md)    
- [《VexDB BM25 算法的全文检索 fulltext 索引原理与实践》](../202510/20251011_07.md)    
- [《VexDB HybridAnn 向量标量混合索引原理与实践》](../202510/20251011_06.md)    
- [《VexDB DiskANN 图索引原理与实践》](../202510/20251011_05.md)    
- [《VexDB Graph_Index 图索引原理与实践》](../202510/20251011_04.md)    
- [《容器体验VexDB! 暴露PostgreSQL,openGauss,vastbase基因》](../202509/20250925_07.md)    
- [《德说-第362期, 读了500篇论文和数个顶级向量数据库项目后, 面向AI 搜索场景的数据库索引设计和优化思考》](../202511/20251110_11.md)    
- [《图数据库赛道没了 | SQL:PGQ标准出炉, 还不懂PGQ图式查询用法? 用DuckDB将PGQ一次整明白》](../202507/20250727_01.md)    
- [《还在为age图插件的停更惋惜? Postgres用GraphBLAS每秒处理数十亿条边》](../202507/20250723_08.md)    
- [《AGE要复活了? PG将内置PGQ(SQL:2023 Property-Graph Queries)》](../202507/20250725_06.md)    
- [《他山之石可以攻玉 | 向量召回IO性能问题解决之道 - 线性化降维(Hilbert & Z-Order)》](../202412/20241213_03.md)    
- [《提升RAG召回效果的方法探讨》](../202408/20240823_01.md)    
- [《向量搜索优化3板斧: 空间、性能、召回(recall)》](../202405/20240506_03.md)    
- [《头大! 索引扫描和全表扫描结果不一样, 这向量数据库还能用? 教你一招大幅提升召回率(recall)》](../202404/20240417_01.md)    
- [《为什么用了RAG, 我的AI还是笨得跟猪一样! RAG效果评测与优化》](../202504/20250414_04.md)    
- [《大模型(LLM) ACA ACP 通关经验分享》](../202504/20250411_01.md)    
- [《大学生数据库实践课设计》](../202509/20250903_06.md)    
  
6、测试数据集  
- http://ann-benchmarks.com  
- https://gitee.com/polardb-tianchi/polardb_competition_2025/tree/master/test  
- 向量数据库相关测试数据集和 benchmark  
- 图量数据库相关测试数据集和 benchmark  
  
7、其他
- [《2023-PostgreSQL Docker镜像学习环境 ARM64版, 已集成热门插件和工具》](../202308/20230814_02.md)     
- [《2023-PostgreSQL Docker镜像学习环境 AMD64版, 已集成热门插件和工具》](../202307/20230710_03.md)     
  
      
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
