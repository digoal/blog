## 跟着 ParadeDB 学 AI 搜索: 3 什么是 BM25？ (What is BM25?)       
              
### 作者              
digoal              
              
### 日期              
2025-12-08              
              
### 标签              
PostgreSQL , 搜索 , paradedb , tantivy , 语义搜索 , 关键词搜索 , ranking , 混合搜索 , RAG , RRF             
              
----              
              
## 背景         
看完 paradedb 的文档 , 我知道它也在朝着 AI 搜索数据库的方向发展.       
      
AI 搜索, 目前的共识需求是: 语义搜索 , 关键词搜索 , 标量搜索 , 混合搜索! ( 个人认为应该还要加上 图、GIS等多模态功能 )        
      
目前围绕AI 搜索需求在做的产品, 我大概总结一下:      
- PG 的插件: vectorchord + vectorchord-bm25 + pg_tokenizer      
- PG 商业发行版: 海量 vastbase 向量版、vexdb      
- PG 的插件(本文主角): paradedb      
- OceanBase SeekDB.      
- DuckDB: vss + fts       
      
好的, 话不多说, 下面就跟着 ParadeDB 文档来体系化学习一下AI 搜索      
      
https://www.paradedb.com/learn      
            
## 📚 什么是 BM25？ (What is BM25?)  
  
**Okapi BM25** 是一种用于**搜索引擎**（Search Engines）的**排序函数**（Ranking Function），它根据与**查询**（Query）的相关性来对**文档**（Documents）进行评分。  
  
* **BM** 是 **Best Matching**（最佳匹配）的缩写。  
* **25** 是在测试中表现最佳的函数版本号。  
  
尽管 **BM25** 已经有超过 30 年的历史，但它仍然是大多数搜索引擎中的**默认排序算法**（Default Ranking Algorithm），因为它**简单**（simple）、**可解释**（explainable）且在实践中**性能良好**（performs well）。  
  
  
## 🤔 BM25 如何工作？ (How BM25 Works)  
  
需要注意的是，**BM25** 是一种被称为**词袋检索函数**（Bag-of-Words Retrieval Function）的方法。  
  
对于查询中的每个**词项**（Term），它会根据三个主要的信号（Signals）来计算每个文档的匹配程度：  
  
1.  **词频（Term frequency, TF）** ：提到查询词项**更频繁**的文档得分更高。  
2.  **逆文档频率（Inverse document frequency, IDF）** ：**罕见的**词项比**常见的**词项权重更高。  
3.  **文档长度归一化（Document length normalization）** ：**较短**的文档比那些仅在长篇大论中**顺带提到**该词项的文档更受青睐。  
  
每个词项都贡献自己的分数，**BM25** 将这些分数**求和**，得出文档的**总体相关性值**（Overall Relevance Value）。  
  
以简化形式来看，**BM25** 可以被视为：  
  
$$\text{Score} = \sum_{\text{Term} \in \text{Query}} \text{IDF} \times \frac{\text{TF} \times (k_1 + 1)}{\text{TF} + k_1 \times (1 - b + b \times \frac{\text{Document Length}}{\text{Average Document Length}})}$$  
  
> **💡 注：** $k_1$ 和 $b$ 是用于调整**词频**和**文档长度归一化**的参数。 $k_1$ 控制词频的影响，而 $b$ 控制文档长度归一化的影响。  
  
  
## 💪 BM25 的优势 (Strengths of BM25)  
  
**BM25** 拥有三大关键优势，使其能够长期保持相关性：  
  
* **简单性（Simplicity）** ：易于理解和实现（easy to understand and implement）。  
* **效率（Efficiency）** ：速度足够快，可以在**大型数据集**（large datasets）上实时运行（fast enough to run in real-time）。  
* **可解释性（Explainability）** ：分数的每个部分都可以追溯到一个**清晰的因素**（traced to a clear factor）。  
  
因为 **BM25** 依赖于简单的**词项统计**（Term Statistics），所以它**准确**（accurate）、**一致**（consistent）且**极其快速**（extremely fast）。这使其成为**低查询延迟**（low query latency）和**关键词相关性**（keyword relevance）至关重要的应用中的热门选择。  
  
  
## 🗓️ 什么时候应该使用 BM25？ (When to Use BM25)  
  
**BM25** 在**检索工作负载**（Retrieval Workloads）中表现出色，尤其是在**特定关键词**（Specific Keywords）带有重要信息的情况下。  
  
例如：  
  
* 在产品目录中搜索**品牌名称**（Brand Name）  
* 在交易应用中查找**股票代码**（Stock Ticker）  
* 在信用卡交易账本中匹配**商家名称**（Merchant Name）  
* 在法律文件中查找**人名**  
* 在医疗报告中查找**诊断代码**（Diagnosis Code）  
* 在 **RAG** 应用中，检索文件以馈送给 **LLM**（大型语言模型）  
  
由于 **BM25** 依赖于简单的**词项统计**（Term Statistics），因此它**准确**（accurate）、**一致**（consistent）且**极其快速**（extremely fast）。这使得它成为对**低查询延迟**（low query latency）和**关键词相关性**（keyword relevance）至关重要的应用中的热门选择。  
  
## 📝 示例：使用 BM25 对查询进行评分 (Example: Scoring a Query with BM25)  
  
假设用户搜索 "**inverted index**"（倒排索引）。  
  
**BM25** 首先将查询分解为两个词项："inverted"（倒排）和 "index"（索引）。然后，对于每个文档，它会计算这些词项的匹配程度：  
  
| 文档 (Document) | 长度 (Length) | 词项计数 (Term counts) | TF–IDF 信号 (TF–IDF signals) | 相对分数 (Relative Score) |  
| :--- | :--- | :--- | :--- | :--- |  
| 文档 A (Doc A) | 60 词 | inverted: 1, index: 1 | 罕见词 $\rightarrow$ **高 IDF**；常见词 $\rightarrow$ **低 IDF** | **更高** (Higher) |  
| 文档 B (Doc B) | 200 词 | inverted: 1, index: 10 | 罕见词 $\rightarrow$ **高 IDF**；常见词 $\rightarrow$ **低 IDF** | 较低 (Lower) |  
  
尽管**文档 B** 提到 "index" 的次数更多，但由于以下因素，**文档 A** 的分数更高：  
  
1.  **词项 "inverted"** 相对稀有（罕见词），**IDF 值较高**，因此它的权重更大。  
2.  **文档 A** 更短，意味着它更**集中**（focused）地讨论了这些词项，从而获得了更高的**文档长度归一化**加权。  
  
  
## 🚫 BM25 的局限性 (Limitations of BM25)  
  
**BM25** 的工作原理是：将查询中的**词项**映射到文档中的**完全匹配**（exact matches）。  
  
这个设计导致了 **BM25** 的根本局限性：它**缺乏语义理解**（Semantic Understanding）。  
  
* 当用户搜索 "**database performance optimization**"（数据库性能优化）时，**BM25** 将不会找到只提到 "**PostgreSQL tuning**"（PostgreSQL 调优）或 "**query optimization**"（查询优化）的文档，即使这些文档可能正是用户需要的。  
* 它侧重于**关键词匹配**（Keyword Matching），这意味着它会遗漏掉使用**同义词**（synonyms）或以**不同方式表达相同概念**的文档。  
  
**BM25** 的局限性促进了**混合搜索**（Hybrid Search）的兴起，它将 **BM25** 的**精度**（Precision）与**向量搜索**（Vector Search）的**语义理解**（Semantic Understanding）结合起来。  
  
    
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
