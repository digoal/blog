## 跟着 ParadeDB 学 AI 搜索: 5 什么是 RAG (检索增强生成)？       
                  
### 作者                  
digoal                  
                  
### 日期                  
2025-12-08                  
                  
### 标签                  
PostgreSQL , 搜索 , paradedb , tantivy , 语义搜索 , 关键词搜索 , ranking , 混合搜索 , RAG , RRF                 
                  
----                  
                  
## 背景             
看完 paradedb 的文档 , 我知道它也在朝着 AI 搜索数据库的方向发展.           
          
AI 搜索, 目前的共识需求是: 语义搜索 , 关键词搜索 , 标量搜索 , 混合搜索! ( 个人认为应该还要加上 图、GIS等多模态功能 )            
          
目前围绕AI 搜索需求在做的产品, 我大概总结一下:          
- PG 的插件: vectorchord + vectorchord-bm25 + pg_tokenizer          
- PG 商业发行版: 海量 vastbase 向量版、vexdb          
- PG 的插件(本文主角): paradedb          
- OceanBase SeekDB.          
- DuckDB: vss + fts           
          
好的, 话不多说, 下面就跟着 ParadeDB 文档来体系化学习一下AI 搜索          
          
https://www.paradedb.com/learn          
                
## 什么是 RAG (检索增强生成)？  
  
重要术语：  
  
| 英文原文 (English) | 中文译文 (Chinese) | 简称/备注 |  
| :--- | :--- | :--- |  
| **Retrieval-Augmented Generation** | 检索增强生成 | **RAG** |  
| **Large Language Model** | 大语言模型 | **LLM** |  
| **Context Window** | 上下文窗口 | |  
| **Vector Search** | 向量搜索 | |  
| **Full-Text Search** | 全文搜索 | **FTS** |  
| **Hybrid Search** | 混合搜索 | |  
| **Semantic Similarity** | 语义相似性 | |  
| **Reciprocal Rank Fusion** | 倒数排名融合 | **RRF** |  
| **Fine-tuning** | 微调 | |  
  
  
**检索增强生成 (Retrieval-Augmented Generation, RAG)** 是一种从外部来源检索知识，以提高 **AI 模型 (AI models)** 响应准确性的架构。如果没有 RAG，AI 模型只能访问其训练数据。有了 RAG，**提示 (prompts)** 会被附加相关的**上下文 (context)** ，以辅助 AI 模型的输出。  
  
最初，RAG 作为一种策略出现，旨在解决 **LLM (Large Language Model，大语言模型)** 有限的**上下文窗口 (Context Window)** 问题。传递所有可用上下文（例如公司的内部知识库或客户数据库）可能会超出 LLM 的输入限制。现代 LLM 拥有明显更大的**上下文窗口 (Context Window)** ；然而，RAG 仍然是一种过滤上下文的技术，它可以辅助 LLM 的推理，而不是分散其注意力。  
  
## RAG 如何工作？  
  
RAG 包含与其名称对应的三个步骤：  
  
1.  **检索 (Retrieval)** ：从外部数据源检索信息。通常会使用用户的查询，RAG 管道会采用**向量搜索 (Vector Search)** 或**全文搜索 (Full-Text Search)** 来浮现相关信息。  
2.  **增强 (Augmentation)** ：将检索到的信息附加到用户的查询中，并将其标记为上下文。  
3.  **生成 (Generation)** ：AI 模型（例如 GPT-5、Claude 等）根据增强后的查询生成输出。  
  
RAG 的最后一步很直接。但是，您必须为您的应用确定最佳的检索和增强策略。  
  
  
## RAG 检索策略  
  
RAG 可以与任何外部数据源配合使用。这包括现有的数据库、**API** 或文档存储库。然而，RAG 最常见的实现是专门围绕存储和检索而构建的。如果数据在存储中没有得到有效**索引 (indexed)** ，那么就很难找到并检索到正确的数据。  
  
目前有两种常见的策略（以及一种混合选项）来高效地存储和检索数据：**向量搜索 (Vector Search)** 和**全文搜索 (Full-Text Search)** 。  
  
### 向量搜索 (Vector Search)  
  
**向量搜索 (Vector Search)** 使用多维**向量嵌入 (vector embeddings)** ，基于**语义相似性 (semantic similarity)** 来检索信息。当用户需要概念上相关的信息，即使措辞不完全相同时，**向量搜索**也最有效。它对于**多模态 (multimodal)** 应用以及查找与查询含义而非精确文本匹配相关的信息特别有效。  
  
### 全文搜索 (Full-Text Search)  
  
**全文搜索 (Full-Text Search, FTS)** 基于匹配的文本内容来检索信息，通常使用像 **BM25** 这样的算法。当用户确切地知道他们在寻找什么时：例如产品代码、文件名或特定短语时，**全文搜索**效果最佳。它精确、确定且快速。  
  
### 混合搜索 (Hybrid Search)  
  
因为**向量搜索 (Vector Search)** 难以检索文本上相似的信息（例如，共享的书名），而**全文搜索 (Full-Text Search)** 难以检索**语义上相似 (semantically similar)** 的信息（例如，两本关于同一主题的书），因此**混合搜索 (Hybrid Search)** 成为了另一种选择。**混合搜索**采用**向量搜索 (Vector Search)** 和**全文搜索 (Full-Text Search)** 两种方式，提供了一种累积的方法。  
  
通过使用**倒数排名融合 (Reciprocal Rank Fusion)** ，**混合搜索**可以检索在两种搜索方法中排名都很高的文档。  
  
  
## 增强 (Augmentation)  
  
一旦 RAG 应用检索到相关信息，它必须在将最终提示发送给 AI 模型之前，将其与用户原始查询结合起来。这个**增强 (Augmentation)** 步骤决定了模型能多有效地利用检索到的上下文。  
  
最常见的方法是使用清晰的**分隔符 (delimiters)** 将检索到的文档附加到原始提示中。例如：  
  
> **Context (上下文)** : [检索到的文档 1] [检索到的文档 2]  
> **User Query (用户查询)** : 我们的退货政策是什么？  
> 请根据提供的上下文回答用户的问题。  
  
您可以通过以下方式改进增强：  
  
* **排名和过滤 (Ranking and filtering)** ：只包含最相关的检索文档，以避免用过多的上下文淹没模型。  
* **摘要 (Summarization)** ：在纳入之前，将冗长的检索文档浓缩成要点。  
* **结构化格式 (Structured formatting)** ：用标题、项目符号或编号列表来组织检索到的信息，以便模型更容易理解。  
* **来源归属 (Source attribution)** ：包含文档标题或**元数据 (metadata)** ，以便模型在其回复中可以引用特定的来源。  
  
目标是提供足够的相关上下文以实现准确的回复，同时保持清晰度并停留在模型的**上下文窗口 (Context Window)** 限制内。  
  
  
  
## RAG 有哪些好处？  
  
RAG 是大多数 AI 商业应用中必不可少的架构。AI 模型没有经过私有信息（例如公司的内部政策、产品文档或客户数据）的训练。相反，必须在查询时向它们提供这些上下文，才能有效地回答提示。  
  
RAG 的一种替代（或补充）策略是**微调 (Fine-tuning)** ，即在查询之前，用上下文信息对 AI 模型进行进一步训练。这种方法必须提前进行，并且复杂得多；但它非常适用于以下应用场景：上下文是固定的、非动态的；查询可预测地集中在特定领域；以及上下文信息量不是特别庞大。  
  
  
  
## 总结  
  
RAG 是一种用于检索相关信息以提高 **LLM (大语言模型)** 模型响应性能的架构。通常，RAG 最具挑战性的方面是选择正确的检索策略，该策略要针对**语义相似性 (semantic similarity)** 、**文本相似性 (textual similarity)** 或两者的组合进行优化。  
    
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
