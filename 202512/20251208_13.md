## 跟着 ParadeDB 学 AI 搜索: 7 什么是混合搜索？ (What is Hybrid Search?)  
  
### 作者  
digoal  
  
### 日期  
2025-12-08  
  
### 标签  
PostgreSQL , 搜索 , paradedb , tantivy , 语义搜索 , 关键词搜索 , ranking , 混合搜索 , RAG , RRF  
  
----  
  
## 背景  
看完 paradedb 的文档 , 我知道它也在朝着 AI 搜索数据库的方向发展.  
  
AI 搜索, 目前的共识需求是: 语义搜索 , 关键词搜索 , 标量搜索 , 混合搜索! ( 个人认为应该还要加上 图、GIS等多模态功能 )  
  
目前围绕AI 搜索需求在做的产品, 我大概总结一下:  
- PG 的插件: vectorchord + vectorchord-bm25 + pg_tokenizer  
- PG 商业发行版: 海量 vastbase 向量版、vexdb  
- PG 的插件(本文主角): paradedb  
- OceanBase SeekDB.  
- DuckDB: vss + fts  
  
好的, 话不多说, 下面就跟着 ParadeDB 文档来体系化学习一下AI 搜索  
  
https://www.paradedb.com/learn  
  
## 什么是混合搜索？ (What is Hybrid Search?)  
  
**混合搜索 (Hybrid search)** 结合了**全文搜索 (full-text search)** 和**向量搜索 (vector search)** ，在单个查询中同时实现**精确关键词匹配 (precise keyword matching)** 和**语义理解 (semantic understanding)** 。这种方法解决了在查找**精确术语 (exact terms)** 和发现**概念相关内容 (conceptually related content)** 之间的根本性权衡问题，对于那些用户以多样化方式表达查询但期望获得全面、相关结果的应用来说，它尤为有价值。  
  
## 为什么要组合搜索方法？ (Why Combine Search Methods?)  
  
每种搜索方法都有其独特的优点和缺点，这使得组合它们变得有价值：  
  
* **全文搜索 (Full-text search)** 依赖于**精确关键词匹配 (exact keyword matching)** ，当用户表达概念的方式与文档不同时，它就会遇到困难。搜索“automobile”（汽车）不会找到关于“cars”（小轿车）的文档，除非配置了显式的**同义词 (synonyms)** 。**技术术语 (Technical terms)** 、**产品代码 (product codes)** 和**精确规格 (precise specifications)** 运行良好，但**自然语言查询 (natural language queries)** 通常无法匹配**语义相关 (semantically related)** 的内容。  
* **向量搜索 (Vector search)** 能够理解**语义关系 (semantic relationships)** ，但可能会错过关键的**精确匹配 (exact matches)** 。搜索一个特定的产品型号，例如“iPhone 15 Pro”，可能会返回**语义相似 (semantically similar)** 但**事实不正确 (factually incorrect)** 的“高端智能手机”的结果。**产品代码 (Product codes)** 、**技术规格 (technical specifications)** 和**精确术语 (precise terminology)** 可能会被概念上相关但错误的结 果所掩盖。  
  
## 组合排名 (Combining Rankings)  
  
混合搜索中的核心挑战是**合并来自不同排序算法的分数 (combining scores from different ranking algorithms)** 。像 **BM25** 这样的**全文搜索 (Full-text search)** 系统根据**词频 (term frequency)** 和**文档统计数据 (document statistics)** 产生**相关性分数 (relevance scores)** ，而**向量搜索 (vector search)** 则通过**数学距离计算 (mathematical distance calculations)** 生成**相似性分数 (similarity scores)** 。这些分数在不同的尺度上运作，不能直接合并。  
  
**倒数排名融合 (Reciprocal Rank Fusion, RRF)** 是解决此问题的一种方法。RRF 不是试图标准化不同的评分系统，而是根据文档出现在每个排名列表中的位置来分配分数。在两种搜索方法中都排名靠前的文档将获得最高的**组合分数 (combined scores)** 。  
  
> 关于 RRF 的完整讨论，包括它为何有效、如何加权以及一个可运行的 SQL 示例，请参阅我们的**倒数排名融合 (Reciprocal Rank Fusion)** 文章。  
  
## 混合系统中的查询处理 (Query Processing in Hybrid Systems)  
  
**混合搜索系统 (Hybrid search systems)** 通过可以**同时执行 (execute simultaneously)** 的处理管道来处理查询：  
  
* **文本处理 (Text processing)** ：查询在与**倒排索引 (inverted index)** 使用像 **BM25** 这样的算法匹配之前，会经过传统的**文本分析 (text analysis)** （**分词 (tokenization)** 、**词干提取 (stemming)** 和**停用词去除 (stopword removal)** ）。  
* **向量生成 (Vector generation)** ：同一个查询使用**机器学习模型 (machine learning models)** 转换为**密集向量嵌入 (dense vector embedding)** ，然后使用像**余弦距离 (cosine distance)** 这样的**相似性指标 (similarity metrics)** 与**文档嵌入 (document embeddings)** 进行比较。  
* **结果融合 (Result fusion)** ：两个结果集使用像**倒数排名融合 (Reciprocal Rank Fusion)** 这样的技术进行组合，以产生**统一的排名 (unified ranking)** 。  
  
这种**并行处理 (parallel processing)** 允许混合系统捕获相关性的不同方面。搜索“带降噪功能的无线耳机”的查询，将匹配包含这些**精确术语 (exact terms)** 的文档，同时也会找到关于“带 ANC 功能的蓝牙耳塞”的内容，它们共享**语义含义 (semantic meaning)** 但使用了不同的**术语 (terminology)** 。  
  
## 实施考量因素 (Implementation Considerations)  
  
构建有效的混合搜索需要仔细关注几个技术因素：  
  
* **索引同步 (Index synchronization)** 确保在文档添加、更新或删除时，**文本索引 (text indexes)** 和**向量索引 (vector indexes)** 保持一致。索引之间的不一致可能导致令人困惑的结果，即文档出现在一种搜索方法中，却不出现在另一种中。  
* **嵌入模型选择 (Embedding model selection)** 显著影响**语义搜索 (semantic search)** 的质量。针对**领域特定数据 (domain-specific data)** 训练的模型通常在专业应用中的表现优于**通用模型 (general-purpose models)** 。一个医疗搜索系统会受益于基于**医学文献 (medical literature)** 而非通用网页内容训练的**嵌入 (embeddings)** 。  
* **融合权重调优 (Fusion weight tuning)** 需要通过真实的**用户查询 (user queries)** 和**反馈 (feedback)** 进行实验。文本搜索和向量搜索之间的相对**权重 (weighting)** 取决于用户行为。**技术型用户 (Technical users)** 可能更喜欢**精确关键词匹配 (exact keyword matching)** ，而**一般用户 (casual users)** 则受益于**语义灵活性 (semantic flexibility)** 。  
  
## 混合搜索表现出色之时 (When Hybrid Search Excels)  
  
**混合搜索 (Hybrid search)** 在需要**精确度 (precision)** 和**语义理解 (semantic understanding)** 的应用中提供了明显的优势：  
  
* **电商搜索 (E-commerce search)** ：查找精确的产品名称和型号，同时理解“舒适的跑鞋”这样的描述性查询。  
* **技术文档 (Technical documentation)** ：匹配精确的 **API 名称 (API names)** 和**错误代码 (error codes)** ，同时找到**概念相关 (conceptually related)** 的**故障排除内容 (troubleshooting content)** 。  
* **企业搜索 (Enterprise search)** ：按标题或 ID 定位特定文档，同时发现跨不同部门的**语义相关信息 (semantically related information)** 。  
* **客户支持 (Customer support)** ：匹配**精确的错误消息 (exact error messages)** ，同时理解**自然语言的问题描述 (natural language problem descriptions)** 。  
* **学术研究 (Academic research)** ：查找具有特定**方法论 (methodologies)** 的论文，同时发现使用不同**术语 (terminology)** 的**概念相关工作 (conceptually related work)** 。  
  
在每种情况下，用户都受益于**关键词匹配 (keyword matching)** 的**精确度 (precision)** 和**语义理解 (semantic understanding)** 的**灵活性 (flexibility)** 。  
  
## 局限性 (Limitations)  
  
尽管混合搜索提供了**卓越的相关性 (superior relevance)** ，但它引入了显著的**复杂性 (complexity)** ：  
  
* **计算开销 (Computational overhead)** ：同时运行**全文 (full-text)** 和**向量搜索 (vector search)** 增加了**计算需求 (computational requirements)** 和**存储需求 (storage needs)** 。  
* **实施复杂性 (Implementation complexity)** ：管理两个不同的**索引系统 (indexing systems)** 和**调优融合参数 (tuning fusion parameters)** 需要**工程努力 (engineering effort)** 。  
* **查询延迟 (Query latency)** ：通过多个系统处理查询并合并结果可能会增加**响应时间 (response times)** 。  
* **成本影响 (Cost implications)** ：维护**关键词索引 (keyword indexes)** 和**向量嵌入 (vector embeddings)** 都会增加**基础设施成本 (infrastructure costs)** 。  
  
对于许多应用来说，单一的搜索方法可能提供足够的结果，同时具有低得多的复杂性。只有当**改进的相关性 (improved relevance)** 证明**额外开销 (additional overhead)** 是合理的时候，**混合搜索 (hybrid search)** 才有意义。  
  
### 总结 (Summary)  
  
**混合搜索 (Hybrid search)** 通过结合**全文搜索 (full-text search)** 的**精确度 (precision)** 和**向量搜索 (vector search)** 的**语义理解 (semantic understanding)** ，代表了**信息检索 (information retrieval)** 领域的当前**最先进技术 (state-of-the-art)** 。  
  
虽然增加的**复杂性 (complexity)** 和**计算开销 (computational overhead)** 是显著的，但如果它们得到了很好的调优，**混合系统 (hybrid systems)** 可以在各种查询类型中提供**卓越的相关性 (superior relevance)** 。  
    
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
