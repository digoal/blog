## Qwen coder AI ç¼–ç¨‹ç»ˆææŠ€å·§  
                  
### ä½œè€…                  
digoal                  
                  
### æ—¥æœŸ                  
2026-01-14                 
                  
### æ ‡ç­¾                  
pgvector , PostgreSQL , å‘é‡æ’ä»¶ , tinyintvec , Qwen Coder , Deepwiki , å¼€å‘è€…æ‰‹å†Œ , mcp server , mcp client , mcp tools                   
                  
----                  
                  
## èƒŒæ™¯    
**ç”¨AIç¼–ç¨‹, æ—©ä¸Šèµ·æ¥å‘ç°ä¸€å †å±å±±ä»£ç , æ€ä¹ˆåŠ?**   
  
ä¸¾ä¸ªä¾‹å­, æˆ‘åœ¨ç”¨ Qwen Coder ç»™ pgvector å¢åŠ ä¸€ä¸ª 8bit çš„å‘é‡ç±»å‹, AI å†™çš„ä»£ç ä¸€å † bug , ä¾‹å¦‚    
- ä¼šå¯¼è‡´æ•°æ®åº“å´©æºƒ  
- ç´¢å¼•è¿”å›çš„ç»“æœå’Œå…¨è¡¨æ‰«æçš„ç»“æœä¸ä¸€è‡´  
- å›å½’æµ‹è¯•çš„SQLä¸ä¸¥è°¨  
- é‡åˆ°å›å½’æµ‹è¯•ä¸­ç¬¦åˆé¢„æœŸçš„ ERROR æ—¶, åå¤å°è¯•ä¿®å¤, é™·å…¥æ­»å¾ªç¯  
- ç¼ºå°‘ support å‡½æ•°, çº é”™é™·å…¥æ­»èƒ¡åŒ
- æ–°å¢ä»£ç æ’å…¥åˆ° vector.sql ä¸­é—´, å¯¼è‡´ä¾èµ–é—®é¢˜æŠ¥é”™ç­‰ 
  
è¿™äº›é—®é¢˜å¯èƒ½æ˜¯ AI ç¼ºä¹å¯¹pgvector é¡¹ç›®æ•´ä½“çš„ç†è§£å¯¼è‡´, ç”¨ Deepwiki å³å¯è§£å†³.   
  
## AI ç¼–ç¨‹ç»ˆææŠ€å·§: ç»™å®ƒä¸€æœ¬å¼€å‘è€…å‚è€ƒæ‰‹å†Œ(deepwiki)   
  
å‡è®¾ä½ å·²ç»çŸ¥é“[ã€Šå¦‚ä½•ä½¿ç”¨ Qwen coderã€‹](../202601/20260111_01.md)    
  
æˆ‘çš„ç›®æ ‡æ˜¯ç”¨ qwen coder ç»™ pgvector å¢åŠ ä¸€ä¸ª 8bit çš„å‘é‡ç±»å‹.  
  
1ã€å…‹éš†ä»£ç   
```  
git clone -b tinyint_vector https://github.com/digoal/pgvector   
git clone -b tinyint https://github.com/pgvector/pgvector pgvector_tinyint   
```  
  
2ã€ç»™qwen coderæ·»åŠ deepwikiå·¥å…·  
```  
# qwen mcp add --scope user --transport http deepwiki https://mcp.deepwiki.com/mcp  
MCP server "deepwiki" added to user settings. (http)  
```  
  
3ã€æµ‹è¯•ä¸€ä¸‹deepwikiå·¥å…·æ˜¯å¦æ­£å¸¸  
```  
# qwen  
  
â–ˆâ–ˆâ•—       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—    â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—  
â•šâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘    â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘  
 â•šâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘  
 â–ˆâ–ˆâ•”â•    â–ˆâ–ˆâ•‘â–„â–„ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  
â–ˆâ–ˆâ•”â•     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘  
â•šâ•â•       â•šâ•â•â–€â–€â•â•  â•šâ•â•â•â•šâ•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•  
  
Tips for getting started:  
1. Ask questions, edit files, or run commands.  
2. Be specific for the best results.  
3. /help for more information.  
  
> /mcp desc

Configured MCP servers:

ğŸŸ¢ deepwiki - Ready (3 tools)
  Tools:
  - ask_question
    Ask any question about a GitHub repository
  - read_wiki_contents
    View documentation about a GitHub repository
  - read_wiki_structure
    Get a list of documentation topics for a GitHub repository
  
> è¯·ä½¿ç”¨ deepwiki mcp å·¥å…·ï¼Œå¸®æˆ‘æŸ¥ä¸€ä¸‹ `karpathy/minGPT` è¿™ä¸ªé¡¹ç›®çš„ README å’Œæ ¸å¿ƒé€»è¾‘è¯´æ˜ï¼Œå¹¶æ€»ç»“ä¸€ä¸‹å®ƒçš„è®­ç»ƒæµç¨‹ã€‚  
  
å¦‚æœå®ƒå¼€å§‹æ­£å¸¸è°ƒç”¨ deepwiki mcp å·¥å…·, è¯´æ˜æ­£å¸¸.    
```  
  
ä¸‹é¢å°±æ˜¯æˆ‘çš„ä¸€å †æç¤ºè¯äº†  
  
````  
> æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .   
åŒæ—¶å‚è€ƒ @pgvector_tinyint/src/tinyint.c @pgvector_tinyint/src/tinyint.h @pgvector/src/halfvec.c @pgvector/src/halfvec.h @pgvector/src/halfutils.c @pgvector/src/halfutils.h @pgvector/sql/vector.sql   
åœ¨ @pgvector/ ä»£ç åº“çš„ tinyint_vector åˆ†æ”¯ä¸­å®ç°ä¸€ä¸ª tinyintvec ç±»å‹.   
è¦æ±‚å¦‚ä¸‹:   
ä½¿ç”¨ 8 bit å­˜å‚¨å‘é‡çš„æ¯ä¸ªç»´åº¦å€¼, å–å€¼åŒºé—´ -128 åˆ° 127 ;   
å®ç° hnsw å’Œ ivfflat ç´¢å¼•, æ”¯æŒ tinyintvec_l2_ops, tinyintvec_l1_ops, tinyintvec_ip_ops, tinyintvec_cosine_ops, ä»¥åŠå¯¹åº”çš„æ“ä½œç¬¦ ; (ç»™ tinyintvec å­—æ®µåˆ›å»ºç´¢å¼•æ—¶, è¦è·³è¿‡ NULL å‘é‡å€¼, ä¸èƒ½æŠ¥é”™.)   
æ³¨æ„ tinyintvec_cosine_ops å› ä¸ºè¦ normal åŒ–, è®°å¾—é‡åˆ°NULLå€¼æ—¶è¦å¤„ç†é™¤0é—®é¢˜.   
ä¿®æ”¹å¯¹åº”çš„ @pgvector/Makefile , @pgvector/sql/vector.sql ;  
è®°å¾—åœ¨ @pgvector/sql/vector.sql è¦åˆ›å»º tinyintvec å¯¹åº”çš„ ivfflat å’Œ hnsw çš„ support å‡½æ•°. 
æ–°å¢å†…å®¹å¿…é¡»æ”¾åˆ° @pgvector/sql/vector.sql æœ«å°¾.
å›å½’æµ‹è¯•é‡‡ç”¨ @tinyintvec.sql   
æ³¨æ„, å¦‚æœå›å½’æµ‹è¯•è¿‡ç¨‹ä¸­é‡åˆ°æ•°æ®åº“å´©æºƒé‡å¯çš„é—®é¢˜, è¯´æ˜ä½ æ–°å¢çš„ä»£ç æœ‰é—®é¢˜, ä¸€å®šè¦è§£å†³é—®é¢˜ç›´åˆ°å›å½’æµ‹è¯•å…¨éƒ¨æ­£å¸¸.   
æ³¨æ„, å›å½’æµ‹è¯•ä¸­ç¬¦åˆé¢„æœŸçš„ ERROR ä¸éœ€è¦å¤„ç†, ç¡®è®¤ pgvector/test/sql/tinyintvec.sql è¾“å‡ºéƒ½ç¬¦åˆé¢„æœŸ(è¯¥ä½¿ç”¨ç´¢å¼•çš„å¿…é¡»ä½¿ç”¨ç´¢å¼•, ç´¢å¼•çš„ç»“æœå¿…é¡»å’Œå…¨è¡¨æ‰«æçš„ç»“æœä¸€è‡´)å, å°†å…¶ç»“æœå†™å…¥ pgvector/test/expected/tinyintvec.out   
æ•°æ®åº“å·²å®‰è£…å¥½, pg_config ä¹Ÿå·²ç»åœ¨ PATH å˜é‡ä¸­åŠŸèƒ½, ç›´æ¥ä½¿ç”¨ USE_PGXS=1 make clean && USE_PGXS=1 make distclean && USE_PGXS=1 make && USE_PGXS=1 make installcheck å°±å¯ä»¥è¿›è¡Œæµ‹è¯• .  
````
  
commit  
  
````  
æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .     
ä¸‹é¢çš„case, å³ä½¿lists = 1 (æ‰€æœ‰æ•°æ®éƒ½åœ¨ä¸€ä¸ªèšé›†å†…), ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•æ‰«æå’Œå…¨è¡¨æ‰«æçš„ç»“æœè¿˜æ˜¯ä¸ä¸€è‡´å‘¢?   
```  
CREATE TABLE t_idx (val tinyintvec(3));  
INSERT INTO t_idx SELECT ('[' || g || ',' || (g+1) || ',' || (g+2) || ']')::tinyintvec FROM generate_series(1, 100) g;  
  
CREATE INDEX idx_t_idx_ivfflat ON t_idx USING ivfflat (val tinyintvec_cosine_ops) WITH (lists = 1);  
  
SET enable_seqscan = OFF;  
SET enable_indexscan = ON;  
EXPLAIN SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;  
SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;  
  
SET enable_seqscan = ON;  
SET enable_indexscan = OFF;  
EXPLAIN SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;  
SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;  
  
DROP TABLE t_idx;  
```  
ivfflat tinyintvec_cosine_ops å®ç°æœ‰ bug.   
è¯·ä»SQLä»£ç å±‚é¢ä»¥åŠåº•å±‚Cä»£ç å±‚é¢æ¥ä¿®å¤è¿™ä¸ªbug @pgvector/  
å¦‚ä½•æµ‹è¯•? USE_PGXS=1 make && make install ç„¶å drop extension vector; create extension vector;  å†è¿›è¡Œæµ‹è¯•.   
æœ€ç»ˆç›®çš„æ˜¯: åˆ›å»ºç´¢å¼•æˆåŠŸ, explain æ˜¾ç¤ºæ­£ç¡®çš„ä½¿ç”¨ç´¢å¼•æ‰«æ, ä½¿ç”¨ç´¢å¼•æ‰«æçš„ç»“æœå’Œä½¿ç”¨å…¨è¡¨æ‰«æçš„ç»“æœä¸€è‡´. éƒ½å¿…é¡»è¿”å›å¦‚ä¸‹ç»“æœ  
```  
        ?column?        |   val      
------------------------+----------  
                      0 | [5,6,7]  
 0.00018305519267358683 | [6,7,8]  
  0.0003542540112344561 | [4,5,6]  
  0.0005624824669272499 | [7,8,9]  
  0.0010023576479969432 | [8,9,10]  
(5 rows)  
```  
````  
  
  
   
commit  
  
````  
æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .     
ä¸‹é¢çš„case, ä¸ºä»€ä¹ˆä½¿ç”¨ç´¢å¼•æ‰«æå’Œå…¨è¡¨æ‰«æçš„ç»“æœä¸ä¸€è‡´å‘¢?   
```  
CREATE TABLE t_idx (val tinyintvec(3));  
INSERT INTO t_idx SELECT ('[' || g || ',' || (g+1) || ',' || (g+2) || ']')::tinyintvec FROM generate_series(1, 100) g;  
  
CREATE INDEX idx_t_idx_hnsw ON t_idx USING hnsw (val tinyintvec_cosine_ops);  
  
SET enable_seqscan = OFF;  
SET enable_indexscan = ON;  
EXPLAIN SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;  
SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;  
  
SET enable_seqscan = ON;  
SET enable_indexscan = OFF;  
EXPLAIN SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;  
SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;  
  
DROP TABLE t_idx;  
```  
hnsw tinyintvec_cosine_ops å®ç°æœ‰ bug.   
è¯·ä»SQLä»£ç å±‚é¢ä»¥åŠåº•å±‚Cä»£ç å±‚é¢æ¥ä¿®å¤è¿™ä¸ªbug @pgvector/  
å¦‚ä½•æµ‹è¯•? USE_PGXS=1 make && make install ç„¶å drop extension vector; create extension vector;  å†è¿›è¡Œæµ‹è¯•.   
æœ€ç»ˆç›®çš„æ˜¯: åˆ›å»ºç´¢å¼•æˆåŠŸ, explain æ˜¾ç¤ºæ­£ç¡®çš„ä½¿ç”¨ç´¢å¼•æ‰«æ, ä½¿ç”¨ç´¢å¼•æ‰«æçš„ç»“æœå’Œä½¿ç”¨å…¨è¡¨æ‰«æçš„ç»“æœä¸€è‡´. éƒ½å¿…é¡»è¿”å›å¦‚ä¸‹ç»“æœ  
```  
        ?column?        |   val      
------------------------+----------  
                      0 | [5,6,7]  
 0.00018305519267358683 | [6,7,8]  
  0.0003542540112344561 | [4,5,6]  
  0.0005624824669272499 | [7,8,9]  
  0.0010023576479969432 | [8,9,10]  
(5 rows)  
```  
````  
   
commit  
  
````  
æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .   
åœ¨ @pgvector/ ä»£ç åº“çš„ tinyint_vector åˆ†æ”¯ä¸­å®ç° tinyintvec ç±»å‹çš„é‡åŒ–å‡½æ•°:   
å‚è€ƒ binary_quantize å®ç°2ä¸ªç¼©æ”¾é‡åŒ–å‡½æ•° tinyint_quantize , åˆ†åˆ«å°† vector/halfvec ç±»å‹çš„å€¼é‡åŒ–åˆ° -128 åˆ° 127 åŒºé—´, é‡‡ç”¨ç¼©æ”¾æ–¹å¼, è¿™ä¸ªé‡åŒ–å‡½æ•°å‡è®¾ vector/halfvec åŸå§‹å€¼çš„å–å€¼åŒºé—´ä¸º [-1.1] , è¶…å‡ºèŒƒå›´å–-128æˆ–127çš„è¾¹ç•Œå€¼ .   
````  
  
commit  
  
````  
æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .   
@pgvector/src/tinyintvec.c @pgvector/src/tinyintvec.h   
ä½¿ç”¨ SIMD ä¼˜åŒ– build index, search, é‡åŒ–ç­‰è¿‡ç¨‹ä¸­çš„ tinyintvec å‘é‡ç›¸å…³çš„è¿ç®—.   
````  
  
commit  
  
````  
æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .   
@pgvector/sql/vector.sql  
åˆ›å»ºä¸€å¼ è¡¨, åˆ›å»º vector æ’ä»¶æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªè¡¨, å¦‚æœè¿™ä¸ªè¡¨å·²å­˜åœ¨, åˆ™åˆ›å»ºæ’ä»¶æ—¶ä¸è¿›è¡Œé‡å¤åˆ›å»º.   
`create table tinyintvec_quantbase (id serial primray key, quant float8[]);`  
````  
  
````  
æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .   
@pgvector/src/tinyintvec.c  
æ–°å¢ä¸€ä¸ªSQLå‡½æ•° tinyintvec_compute_quantization_centroids , è¾“å…¥ä¸ºâ€œschema name, table name, column name, å‘é‡ç±»å‹, ç»´åº¦æ•°â€. è¾“å‡ºç±»å‹ä¸º`float8[]`, è¿™ä¸ªfloat8æ•°ç»„çš„æ¯256ä¸ªå…ƒç´ è¡¨ç¤ºè¿™ä¸ªè¡¨åœ¨æ¯ä¸ªç»´åº¦ä¸Šçš„èšé›†ç‚¹çš„åŸå§‹å€¼(ä¾‹å¦‚åŸå§‹å€¼çš„åŒºé—´å¯èƒ½æ˜¯ä»»æ„å€¼, è€Œä¸æ˜¯é‡åŒ–åçš„-128åˆ°127).  
å¦‚ä½•ç»Ÿè®¡èšé›†ç‚¹? æ‰«æè¿™å¼ è¡¨æŒ‡å®šå­—æ®µçš„æ•°æ®, æ¯ä¸ªç»´åº¦éƒ½é‡‡ç”¨kmeansç®—æ³•è®¡ç®—å‡ºå‡åºçš„256ä¸ªèšé›†ç‚¹çš„å€¼. ä¾‹å¦‚è¾“å…¥ä¸ºâ€œpublic,tbl_test,embedding,vector,128â€, é‚£ä¹ˆè®¡ç®—å‡ºçš„`float8[]`å°†æœ‰`128*256`ä¸ªå…ƒç´ .  
ç”¨cå‡½æ•°çš„ä»£ç å®ç°è¯¥SQLå‡½æ•°.  
å¹¶åœ¨ @pgvector/sql/vector.sql ä¸­æ·»åŠ è¯¥SQLå‡½æ•°.  
````  
  
commit  
  
````  
æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .   
@pgvector/src/tinyintvec.c  
æ–°å¢ä¸€ä¸ªSQLå‡½æ•° quantize_vector_with_centroids , è¾“å…¥ä¸ºâ€œintã€vectorâ€å€¼. è¾“å‡ºç±»å‹ä¸º`tinyintvec`, ä½¿ç”¨è¾“å…¥çš„intä»tinyintvec_quantbaseè¡¨æŸ¥è¯¢å¾—åˆ°quantå€¼(å¦‚æœåœ¨åˆ›å»ºç´¢å¼•çš„è¯­å¥ä¸­è°ƒç”¨, ä»…æŸ¥è¯¢ä¸€æ¬¡), ç”¨è¿™ä¸ªquantæ¥é‡åŒ–vectorå€¼.  
é‡åŒ–æ–¹æ³•: æå–vectoræ¯ä¸ªç»´åº¦çš„å€¼, å°†å®ƒæ˜ å°„åˆ°åœ¨quantå€¼å¯¹åº”çš„256ä¸ªå…ƒç´ ä¸­çš„ä½ç½®, ä¹Ÿå°±æ˜¯ç¦»å‡åºçš„256ä¸ªèšé›†ç‚¹çš„å€¼å“ªä¸ªä½ç½®çš„å€¼æœ€è¿‘(æ³¨æ„ä¼˜åŒ–ç®—æ³•)å°±æ˜ å°„åˆ°å“ªä¸ªä½ç½®, æœ€ç»ˆå®ƒå°±è½¬æ¢ä¸ºäº†[-128,127]åŒºé—´çš„å€¼, è¾¾åˆ°å°†vectoré‡åŒ–ä¸ºtinyintvecçš„ç›®çš„.  
ç”¨cå‡½æ•°çš„ä»£ç å®ç°è¯¥SQLå‡½æ•°.  
å¹¶åœ¨ @pgvector/sql/vector.sql ä¸­æ·»åŠ è¯¥SQLå‡½æ•°.    
````  
  
commit  
  
````  
æˆ‘æ­£åœ¨ä½¿ç”¨ `pgvector/pgvector` å¼€å‘, deepwiki æœ‰è¯¥é¡¹ç›®çš„å¼€å‘æ–‡æ¡£, è¯·å…ˆè°ƒç”¨ deepwiki mcp å·¥å…·æ¥äº†è§£å®ƒ, ä¹Ÿå¯ä»¥ç”¨ deepwiki æ¥æŒ‰éœ€ç”Ÿæˆä»£ç , æ£€æŸ¥ä»£ç .   
@pgvector/src/tinyintvec.c  
æ–°å¢ä¸€ä¸ªSQLå‡½æ•° quantize_vector_with_centroids , è¾“å…¥ä¸ºâ€œintã€halfvecâ€å€¼. è¾“å‡ºç±»å‹ä¸º`tinyintvec`, ä½¿ç”¨è¾“å…¥çš„intä»tinyintvec_quantbaseè¡¨æŸ¥è¯¢å¾—åˆ°quantå€¼(å¦‚æœåœ¨åˆ›å»ºç´¢å¼•çš„è¯­å¥ä¸­è°ƒç”¨, ä»…æŸ¥è¯¢ä¸€æ¬¡), ç”¨è¿™ä¸ªquantæ¥é‡åŒ–halfvecå€¼.  
é‡åŒ–æ–¹æ³•: æå–halfvecæ¯ä¸ªç»´åº¦çš„å€¼, å°†å®ƒæ˜ å°„åˆ°åœ¨quantå€¼å¯¹åº”çš„256ä¸ªå…ƒç´ ä¸­çš„ä½ç½®, ä¹Ÿå°±æ˜¯ç¦»å‡åºçš„256ä¸ªèšé›†ç‚¹çš„å€¼å“ªä¸ªä½ç½®çš„å€¼æœ€è¿‘(æ³¨æ„ä¼˜åŒ–ç®—æ³•)å°±æ˜ å°„åˆ°å“ªä¸ªä½ç½®, æœ€ç»ˆå®ƒå°±è½¬æ¢ä¸ºäº†[-128,127]åŒºé—´çš„å€¼, è¾¾åˆ°å°†halfvecé‡åŒ–ä¸ºtinyintvecçš„ç›®çš„.  
ç”¨cå‡½æ•°çš„ä»£ç å®ç°è¯¥SQLå‡½æ•°.  
å¹¶åœ¨ @pgvector/sql/vector.sql ä¸­æ·»åŠ è¯¥SQLå‡½æ•°.    
````  
  
tinyintvec.sql å›å½’æµ‹è¯•
```
-- Basic type creation and input/output
SELECT '[1,2,3]'::tinyintvec;
SELECT '[-128,0,127]'::tinyintvec;
SELECT '[1, 2, 3]'::tinyintvec;
SELECT '[ 1 , 2 , 3 ]'::tinyintvec;

-- Test invalid values
SELECT '[128]'::tinyintvec;  -- Out of range
SELECT '[-129]'::tinyintvec;  -- Out of range

-- Test empty and malformed input
SELECT '[]'::tinyintvec;  -- Empty vector
SELECT '[1,2,hello]'::tinyintvec;  -- Invalid character
SELECT '[1,2'::tinyintvec;  -- Malformed
SELECT '1,2,3]'::tinyintvec;  -- Malformed

-- Test with dimensions constraint
CREATE TABLE test_tinyintvec (val tinyintvec(3));
INSERT INTO test_tinyintvec VALUES ('[1,2,3]');
INSERT INTO test_tinyintvec VALUES ('[1,2,3,4]');  -- Wrong dimensions
DROP TABLE test_tinyintvec;

-- Test casting from arrays
SELECT ARRAY[1,2,3]::tinyintvec;
SELECT ARRAY[1,2,3]::int2[]::tinyintvec;
SELECT ARRAY[1.0,2.0,3.0]::tinyintvec;
SELECT ARRAY[1,2,3]::float4[]::tinyintvec;
SELECT ARRAY[1,2,3]::float8[]::tinyintvec;
SELECT ARRAY[1,2,3]::numeric[]::tinyintvec;

-- Test casting to arrays
SELECT ('[1,2,3]'::tinyintvec)::int2[];

-- Test casting from vector and halfvec
SELECT ('[1,2,3]'::vector)::tinyintvec;
SELECT ('[1,2,3]'::halfvec)::tinyintvec;

-- Test basic operations
SELECT '[1,2,3]'::tinyintvec + '[4,5,6]'::tinyintvec;
SELECT '[5,6,7]'::tinyintvec - '[1,2,3]'::tinyintvec;
SELECT '[1,2,3]'::tinyintvec * '[2,3,4]'::tinyintvec;
SELECT '[1,2]'::tinyintvec || '[3,4]'::tinyintvec;

-- Test comparison operations
SELECT '[1,2,3]'::tinyintvec = '[1,2,3]'::tinyintvec;
SELECT '[1,2,3]'::tinyintvec = '[1,2,4]'::tinyintvec;
SELECT '[1,2,3]'::tinyintvec < '[1,2,4]'::tinyintvec;
SELECT '[1,2,4]'::tinyintvec > '[1,2,3]'::tinyintvec;

-- Test distance functions
SELECT '[0,0]'::tinyintvec <-> '[3,4]'::tinyintvec;
SELECT '[0,0]'::tinyintvec <#> '[3,4]'::tinyintvec;
SELECT '[1,2]'::tinyintvec <=> '[2,4]'::tinyintvec;
SELECT '[1,2]'::tinyintvec <+> '[3,4]'::tinyintvec;

-- Test L2 distance with various values
SELECT '[1,2]'::tinyintvec <-> '[1,2]'::tinyintvec;
SELECT '[1,2,3]'::tinyintvec <-> '[4,5,6]'::tinyintvec;

-- Test inner product
SELECT '[1,2,3]'::tinyintvec <#> '[4,5,6]'::tinyintvec;
SELECT '[1,2]'::tinyintvec <#> '[3,4]'::tinyintvec;

-- Test cosine distance
SELECT '[1,2]'::tinyintvec <=> '[2,4]'::tinyintvec;
SELECT '[1,2]'::tinyintvec <=> '[1,2]'::tinyintvec;
SELECT '[1,0]'::tinyintvec <=> '[0,1]'::tinyintvec;

-- Test L1 distance
SELECT '[1,2,3]'::tinyintvec <+> '[4,5,6]'::tinyintvec;
SELECT '[1,2]'::tinyintvec <+> '[1,2]'::tinyintvec;

-- Test utility functions
SELECT tinyintvec_dims('[1,2,3,4,5]'::tinyintvec);
SELECT tinyintvec_norm('[3,4]'::tinyintvec);

-- Test normalization
SELECT tinyintvec_l2_normalize('[3,4]'::tinyintvec);

-- Test subvector
SELECT subvector('[1,2,3,4,5]'::tinyintvec, 2, 3);

-- Test indexing
CREATE TABLE t_idx (val tinyintvec(3));
INSERT INTO t_idx SELECT ('[' || g || ',' || (g+1) || ',' || (g+2) || ']')::tinyintvec FROM generate_series(1, 100) g;
INSERT INTO t_idx VALUES (NULL);

-- Test B-tree index
CREATE INDEX ON t_idx USING btree (val);
SELECT * FROM t_idx WHERE val = '[5,6,7]';
DROP INDEX IF EXISTS t_idx_val_idx;

-- Test ivfflat index with different opclasses
CREATE INDEX idx_t_idx_ivfflat1 ON t_idx USING ivfflat (val tinyintvec_l2_ops) WITH (lists = 10);
CREATE INDEX idx_t_idx_ivfflat2 ON t_idx USING ivfflat (val tinyintvec_ip_ops) WITH (lists = 10);
-- Note: IVFFlat with cosine_ops may fail with "Zero norm detected" error during k-means clustering
-- This is a known limitation in pgvector for all vector types with cosine distance
-- CREATE INDEX idx_t_idx_ivfflat3 ON t_idx USING ivfflat (val tinyintvec_cosine_ops) WITH (lists = 10);
CREATE INDEX idx_t_idx_ivfflat4 ON t_idx USING ivfflat (val tinyintvec_l1_ops) WITH (lists = 10);

-- Test queries with indexes
SET enable_seqscan = OFF;
SET enable_indexscan = ON;
EXPLAIN SELECT val <-> '[5,6,7]',* FROM t_idx WHERE val <-> '[5,6,7]' < 5 ORDER BY val <-> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <#> '[5,6,7]',* FROM t_idx WHERE val <#> '[5,6,7]' < 100 ORDER BY val <#> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <+> '[5,6,7]',* FROM t_idx WHERE val <+> '[5,6,7]' < 10 ORDER BY val <+> '[5,6,7]' LIMIT 5;

SELECT val <-> '[5,6,7]',* FROM t_idx WHERE val <-> '[5,6,7]' < 5 ORDER BY val <-> '[5,6,7]' LIMIT 5;
SELECT val <#> '[5,6,7]',* FROM t_idx WHERE val <#> '[5,6,7]' < 100 ORDER BY val <#> '[5,6,7]' LIMIT 5;
SELECT val <+> '[5,6,7]',* FROM t_idx WHERE val <+> '[5,6,7]' < 10 ORDER BY val <+> '[5,6,7]' LIMIT 5;

SET enable_seqscan = ON;
SET enable_indexscan = OFF;
EXPLAIN SELECT val <-> '[5,6,7]',* FROM t_idx WHERE val <-> '[5,6,7]' < 5 ORDER BY val <-> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <#> '[5,6,7]',* FROM t_idx WHERE val <#> '[5,6,7]' < 100 ORDER BY val <#> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <+> '[5,6,7]',* FROM t_idx WHERE val <+> '[5,6,7]' < 10 ORDER BY val <+> '[5,6,7]' LIMIT 5;

SELECT val <-> '[5,6,7]',* FROM t_idx WHERE val <-> '[5,6,7]' < 5 ORDER BY val <-> '[5,6,7]' LIMIT 5;
SELECT val <#> '[5,6,7]',* FROM t_idx WHERE val <#> '[5,6,7]' < 100 ORDER BY val <#> '[5,6,7]' LIMIT 5;
SELECT val <+> '[5,6,7]',* FROM t_idx WHERE val <+> '[5,6,7]' < 10 ORDER BY val <+> '[5,6,7]' LIMIT 5;

-- Test hnsw index with different opclasses
DROP INDEX idx_t_idx_ivfflat1;
DROP INDEX idx_t_idx_ivfflat2;
-- DROP INDEX idx_t_idx_ivfflat3; -- Skipped due to cosine limitation
DROP INDEX idx_t_idx_ivfflat4;
CREATE INDEX idx_t_idx_hnsw1 ON t_idx USING hnsw (val tinyintvec_l2_ops);
CREATE INDEX idx_t_idx_hnsw2 ON t_idx USING hnsw (val tinyintvec_ip_ops);
CREATE INDEX idx_t_idx_hnsw3 ON t_idx USING hnsw (val tinyintvec_cosine_ops);
CREATE INDEX idx_t_idx_hnsw4 ON t_idx USING hnsw (val tinyintvec_l1_ops);

-- Test queries with indexes
SET enable_seqscan = OFF;
SET enable_indexscan = ON;
EXPLAIN SELECT val <-> '[5,6,7]',* FROM t_idx WHERE val <-> '[5,6,7]' < 5 ORDER BY val <-> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <#> '[5,6,7]',* FROM t_idx WHERE val <#> '[5,6,7]' < 100 ORDER BY val <#> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <+> '[5,6,7]',* FROM t_idx WHERE val <+> '[5,6,7]' < 10 ORDER BY val <+> '[5,6,7]' LIMIT 5;

SELECT val <-> '[5,6,7]',* FROM t_idx WHERE val <-> '[5,6,7]' < 5 ORDER BY val <-> '[5,6,7]' LIMIT 5;
SELECT val <#> '[5,6,7]',* FROM t_idx WHERE val <#> '[5,6,7]' < 100 ORDER BY val <#> '[5,6,7]' LIMIT 5;
SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;
SELECT val <+> '[5,6,7]',* FROM t_idx WHERE val <+> '[5,6,7]' < 10 ORDER BY val <+> '[5,6,7]' LIMIT 5;

SET enable_seqscan = ON;
SET enable_indexscan = OFF;
EXPLAIN SELECT val <-> '[5,6,7]',* FROM t_idx WHERE val <-> '[5,6,7]' < 5 ORDER BY val <-> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <#> '[5,6,7]',* FROM t_idx WHERE val <#> '[5,6,7]' < 100 ORDER BY val <#> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;
EXPLAIN SELECT val <+> '[5,6,7]',* FROM t_idx WHERE val <+> '[5,6,7]' < 10 ORDER BY val <+> '[5,6,7]' LIMIT 5;

SELECT val <-> '[5,6,7]',* FROM t_idx WHERE val <-> '[5,6,7]' < 5 ORDER BY val <-> '[5,6,7]' LIMIT 5;
SELECT val <#> '[5,6,7]',* FROM t_idx WHERE val <#> '[5,6,7]' < 100 ORDER BY val <#> '[5,6,7]' LIMIT 5;
SELECT val <=> '[5,6,7]',* FROM t_idx WHERE val <=> '[5,6,7]' < 1 ORDER BY val <=> '[5,6,7]' LIMIT 5;
SELECT val <+> '[5,6,7]',* FROM t_idx WHERE val <+> '[5,6,7]' < 10 ORDER BY val <+> '[5,6,7]' LIMIT 5;

-- Test with zero vectors (important for tinyintvec)
CREATE TABLE t_idx_zero (val tinyintvec(3));
INSERT INTO t_idx_zero VALUES ('[0,0,0]'), ('[1,2,3]'), ('[4,5,6]');
CREATE INDEX idx_zero_l2 ON t_idx_zero USING hnsw (val tinyintvec_l2_ops);
CREATE INDEX idx_zero_cosine ON t_idx_zero USING hnsw (val tinyintvec_cosine_ops);
SET enable_seqscan = OFF;
SET enable_indexscan = ON;
EXPLAIN SELECT val <=> '[1,1,1]',* FROM t_idx_zero ORDER BY val <=> '[1,1,1]' LIMIT 5;
EXPLAIN SELECT val <-> '[1,1,1]',* FROM t_idx_zero ORDER BY val <-> '[1,1,1]' LIMIT 5;
SELECT val <=> '[1,1,1]',* FROM t_idx_zero ORDER BY val <=> '[1,1,1]' LIMIT 5;
SELECT val <-> '[1,1,1]',* FROM t_idx_zero ORDER BY val <-> '[1,1,1]' LIMIT 5;
SET enable_seqscan = ON;
SET enable_indexscan = OFF;
EXPLAIN SELECT val <=> '[1,1,1]',* FROM t_idx_zero ORDER BY val <=> '[1,1,1]' LIMIT 5;
EXPLAIN SELECT val <-> '[1,1,1]',* FROM t_idx_zero ORDER BY val <-> '[1,1,1]' LIMIT 5;
SELECT val <=> '[1,1,1]',* FROM t_idx_zero ORDER BY val <=> '[1,1,1]' LIMIT 5;
SELECT val <-> '[1,1,1]',* FROM t_idx_zero ORDER BY val <-> '[1,1,1]' LIMIT 5;
DROP TABLE t_idx_zero;

-- Clean up
DROP TABLE t_idx;
RESET enable_seqscan;
```
  
#### [PolarDB å­¦ä¹ å›¾è°±](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL è§£å†³æ–¹æ¡ˆé›†åˆ](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [å¾·å“¥ / digoal's Github - å…¬ç›Šæ˜¯ä¸€è¾ˆå­çš„äº‹.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About å¾·å“¥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
