## Gemini CLI Coder Agent 解决外网访问 方法 (含 brew 部署)  
          
### 作者          
digoal          
          
### 日期          
2026-01-17         
          
### 标签          
Gemini CLI Coder Agent , Qwen Coder , 外网 , 科学上网  
          
----          
          
## 背景  
在 macOS 中使用 Gemini CLI Coder Agent, 假设你在本机已经有 `http(squid) Port:22222` 和 `socks5 Port:11112` 代理.    
  
代理参考:   
- [《socks5 代理》](../202310/20231029_01.md)    
- [《http 代理》](../202407/20240704_01.md)    
- [《iphone / macOS 使用内网 socks5 代理》](../202405/20240505_02.md)    
- [《容器使用宿主机代理》](../202403/20240327_01.md)    
  
  
-----  
  
1、安装 brew  
  
如未安装 brew 则先安装 brew   
```  
all_proxy=socks5h://127.0.0.1:11112 /bin/bash -c "$(all_proxy=socks5h://127.0.0.1:11112 curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"  
```  
  
如有必要, 可先卸载 brew  
```  
# 它会提示你确认，输入 y 即可。  
# 这不会删除你已安装的软件（如 Node、Python 等），但会删除 /opt/homebrew 目录。   
all_proxy=socks5h://127.0.0.1:11112 /bin/bash -c "$(all_proxy=socks5h://127.0.0.1:11112 curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)"  
```  
  
2、配置 brew  
  
```  
# brew 配置, 关闭自动更新, 换源  
echo 'export HOMEBREW_NO_AUTO_UPDATE=1' >> ~/.bash_profile  
echo 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.bash_profile  
source ~/.bash_profile  
  
cd "$(brew --repo)"  
git remote set-url origin https://mirrors.ustc.edu.cn/brew.git  
```  
  
3、安装 nvm  
  
```  
brew install nvm  
```  
  
  
4、配置 nvm  
  
```  
mkdir ~/.nvm  
echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.bash_profile  
echo '[ -s "/opt/homebrew/opt/nvm/nvm.sh" ] && . "/opt/homebrew/opt/nvm/nvm.sh"' >> ~/.bash_profile  
echo '[ -s "/opt/homebrew/etc/bash_completion.d/nvm" ] && . "/opt/homebrew/etc/bash_completion.d/nvm"' >> ~/.bash_profile  
source ~/.bash_profile  
  
  
# 安装 npm  
all_proxy=socks5h://127.0.0.1:11112 nvm install --lts      # 安装 LTS 版本  
nvm use --lts          # 使用该版本  
  
# 确认版本  
node -v  
npm -v  
```  
  
5、配置 npm  
  
```  
npm config delete proxy  
npm config delete https-proxy  
npm config delete http-proxy  
  
npm config set registry https://registry.npmmirror.com  
# 如何恢复官方 registry ? : npm config set registry https://registry.npmjs.org  
```  
  
6、安装 Gemini CLI Coder Agent , Qwen CLI Coder Agent   
  
```  
all_proxy=socks5h://127.0.0.1:11112 npm install -g @google/gemini-cli@latest    
all_proxy=socks5h://127.0.0.1:11112 npm install -g @qwen-code/qwen-code@latest    
```  
  
7、安装(可选, playwright 是一种控制浏览器的MCP Server)  
  
```  
npm init playwright@latest   
  
# 设置如下  
Getting started with writing end-to-end tests with Playwright:  
Initializing project in '.'  
✔ Do you want to use TypeScript or JavaScript? · TypeScript  
✔ Where to put your end-to-end tests? · tests  
✔ Add a GitHub Actions workflow? (Y/n) · false  
✔ Install Playwright browsers (can be done manually via 'npx playwright install')? (Y/n) · true  
✔ Install Playwright operating system dependencies (requires sudo / root - can be done manually via 'sudo npx playwright install-deps')? (y/N) · true  
```  
  
8、给 Gemini CLI Coder Agent , Qwen CLI Coder Agent 添加 MCP  
  
```
# 安装 mcp-server-playwright 
all_proxy=socks5h://127.0.0.1:11112 npm install -g @playwright/mcp

gemini mcp add deepwiki https://mcp.deepwiki.com/mcp --scope user --transport http  
gemini mcp add playwright "`which mcp-server-playwright`" --scope user
  
qwen mcp add deepwiki https://mcp.deepwiki.com/mcp --scope user --transport http  
qwen mcp add playwright "`which mcp-server-playwright`" --scope user
```  
  
  
9、启动 Gemini CLI Coder Agent  
```  
# 在 macOS 执行  
# 1. 基础环境变量（覆盖大多数库）  
export http_proxy=http://127.0.0.1:22222  
export https_proxy=http://127.0.0.1:22222  
export HTTP_PROXY=http://127.0.0.1:22222  
export HTTPS_PROXY=http://127.0.0.1:22222  
  
# 2. 针对 Node.js global-agent 库（如果 Gemini CLI 引用了它）  
export GLOBAL_AGENT_HTTP_PROXY=http://127.0.0.1:22222  
  
# 3. 解决 Playwright 浏览器的代理（关键！）  
# Playwright 启动的 Chromium 实例有时不读取系统环境变量，  
# 显式传参给浏览器引擎：  
export ALL_PROXY=http://127.0.0.1:22222  
  
# 4. 禁止绕过（防止某些库默认尝试直连）  
export no_proxy=localhost,127.0.0.1  
  
  
# 进入某个工作目录  
mkdir -p ~/gemini_workdir  
cd ~/gemini_workdir  
gemini  
```  
  
第一次启动会提示你认证  
  
10、启动 Qwen CLI Coder Agent   
```  
unset http_proxy  
unset https_proxy  
unset HTTP_PROXY  
unset HTTPS_PROXY  
unset GLOBAL_AGENT_HTTP_PROXY  
unset ALL_PROXY  
unset no_proxy  
  
  
# 进入某个工作目录  
mkdir -p ~/qwen_workdir  
cd ~/qwen_workdir  
qwen  
```  
  
第一次启动会提示你认证  
  
  
  
#### [PolarDB 学习图谱](https://www.aliyun.com/database/openpolardb/activity "8642f60e04ed0c814bf9cb9677976bd4")
  
  
#### [PostgreSQL 解决方案集合](../201706/20170601_02.md "40cff096e9ed7122c512b35d8561d9c8")
  
  
#### [德哥 / digoal's Github - 公益是一辈子的事.](https://github.com/digoal/blog/blob/master/README.md "22709685feb7cab07d30f30387f0a9ae")
  
  
#### [About 德哥](https://github.com/digoal/blog/blob/master/me/readme.md "a37735981e7704886ffd590565582dd0")
  
  
![digoal's wechat](../pic/digoal_weixin.jpg "f7ad92eeba24523fd47a6e1a0e691b59")
  
