## PostgreSQL æ—¥å¸¸å·¡æ£€ SKILL æ‹¿èµ°ä¸è°¢  
                        
### ä½œè€…                          
digoal                          
                       
### æ—¥æœŸ                          
2026-02-04                     
                          
### æ ‡ç­¾                          
gemini , opencode , AI Agent , SKILL     
                          
----         
                          
## èƒŒæ™¯     
ç”¨ gemini(æœ€å¼€å§‹å†™çš„åˆç‰ˆ) å’Œ opencode(åŸºäºåˆç‰ˆçš„æ”¹è‰¯ç‰ˆ, ä½¿ç”¨ kimi-2.5 free æ¨¡å‹) å†™äº†1ä¸ªå¯¹ PostgreSQL è¿›è¡Œ**æ—¥å¸¸å·¡æ£€**çš„ Agent Skill.  
  
è®© AI å‚è€ƒäº† [ã€ŠPostgreSQL DBAæœ€å¸¸ç”¨SQLã€‹](../202005/20200509_02.md)  [ã€ŠPostgreSQL Freeze é£æš´é¢„æµ‹ç»­ - çè—çº§SQLã€‹](../201804/20180411_01.md) ç­‰æ–‡ç«    
  
ä»¥åè¿˜å¯å‚è€ƒæ›´å¤š `grep çè— https://github.com/digoal/blog/tree/master/README.md`    
  
ä»¥åŠ deepwiki postgres/postgres é¡¹ç›®çš„å»ºè®®: ç”¨ postgres/postgres é¡¹ç›®ä½œä¸ºå‚æ•°è°ƒç”¨ deepwiki mcp , å°†ç°æœ‰ skill çš„æŠ€èƒ½è„šæœ¬å‘ç»™ deepwiki , å¹¶è®© deepwiki æ£€æŸ¥è·å–æ–¹æ³•æ˜¯å¦æœ‰bugã€åŒæ—¶è®© deepwiki ç»™å‡º postgresql çš„å·¡æ£€è¿˜ç¼ºä»€ä¹ˆ? è®© deepwiki ç»™å‡ºé—æ¼å·¡æ£€é¡¹çš„è¯¦ç»†é‡‡é›†æ–¹æ³•ã€åˆ¤æ–­æ ‡å‡†.    
      
æ‰€æœ‰çš„æ–‡ä»¶éƒ½å·²æŒ‰ç…§ gemini cli ä¸­çš„ â€œSkill structureâ€ æŒ‡å—è¿›è¡Œäº†é‡æ–°ç»„ç»‡.   
  
SKILL ä»£ç å·²æ”¾åˆ° https://github.com/digoal/postgres_skill/ æ‹¿èµ°ä¸è°¢, ä»¥åå¯åŸºäºè¿™ä¸ª skill å†è¿›è¡Œè¿­ä»£. ( ç›®å‰å·²åœ¨ PG 18 æ£€æµ‹é€šè¿‡. )    
```
æ ¹æ® ai agent çš„è¯´æ˜, å°† postgres-daily-check æ‹·è´åˆ°å¯¹åº”ç›®å½•.

ä¾‹å¦‚ opencode çš„ skill åœ¨å“ª? å‚è€ƒ https://opencode.ai/docs/skills
Project config: .opencode/skills/<name>/SKILL.md
Global config: ~/.config/opencode/skills/<name>/SKILL.md
Project Claude-compatible: .claude/skills/<name>/SKILL.md
Global Claude-compatible: ~/.claude/skills/<name>/SKILL.md
```
  
å¤‡æ³¨: è¿™ä¸ª skill æ˜¯å·¡æ£€ç”¨çš„, è®¡åˆ’å†æä¸€ä¸ªä»¥ç»è¥åˆ†æä¸ºç›®æ ‡çš„ SKILL , è¦å…ˆè·å–å¹¶åˆ†æå…ƒæ•°æ®, é‡‡æ ·æ•°æ®, ç”Ÿæˆç»è¥åˆ†æç›¸å…³çš„SQLå’Œç»“æœåˆ†æä»£ç .  
```
# ç¼–å†™ SKILL Prompt:
ä»¥ç»è¥åˆ†æä¸ºç›®çš„, å†™ä¸€ä¸ªé’ˆå¯¹postgresqlæ•°æ®åº“çš„SKILL, å¯èƒ½è¦å…ˆè·å–å®ä¾‹çš„å…ƒæ•°æ®ã€å¹¶é‡‡æ ·ä¸€äº›æ•°æ®è¿›è¡Œåˆ†æ, ç„¶åç”Ÿæˆç”¨äºç»è¥åˆ†æçš„SQLs, ç„¶åè¿è¡Œè¿™äº›SQL, æœ€åå¯¹æ‰€æœ‰SQLçš„ç»“æœè¿›è¡Œæ·±åº¦åˆ†æ, å¾—åˆ°ç»è¥åˆ†ææŠ¥å‘Š.
å¯ä½¿ç”¨ deepwiki postgres/postgres è·å¾—å¸®åŠ©, å¦‚ä½•è·å– postgresql å®ä¾‹çš„å…ƒæ•°æ®, å¦‚ä½•é«˜æ•ˆé‡‡æ ·å¿…è¦çš„æ•°æ®?

# ä½¿ç”¨ä¸¾ä¾‹ :
ä»¥ç»è¥åˆ†æçš„è§†è§’, é‡æ–°åˆ†æè¿™ä¸ª postgresql æ•°æ®åº“: host 127.0.0.1 port 1922 user digoal dbname postgres password 123456
```
   
1ã€PostgreSQL Daily Check æ–‡ä»¶ç»“æ„ä¸ç”¨é€”  
  
```  
postgres-daily-check/  
â”œâ”€â”€ assets/  
â”‚   â””â”€â”€ db_config.env          # æ•°æ®åº“è¿æ¥é…ç½®ï¼ˆPGHOST, PGPORT, PGUSER, PGDATABASEï¼‰  
â”œâ”€â”€ scripts/  
â”‚   â”œâ”€â”€ run_postgres_check.sh  # æ ¸å¿ƒè„šæœ¬ï¼šæ‰§è¡Œå„ skill çš„ SQL æŸ¥è¯¢  
â”‚   â””â”€â”€ postgres_agent.py      # Agentï¼šè°ƒåº¦æ‰§è¡Œã€åˆ†æç»“æœã€ç”ŸæˆæŠ¥å‘Š  
â””â”€â”€ SKILL.md                   # Skill å®šä¹‰æ–‡æ¡£  
```  
  
2ã€æ–‡ä»¶ç”¨é€”  
  
| æ–‡ä»¶ | ç”¨é€” |  
|------|------|  
| db_config.env | å®šä¹‰ PostgreSQL è¿æ¥ç¯å¢ƒå˜é‡ |  
| run_postgres_check.sh | å°è£… 30+ ä¸ª SQL æŸ¥è¯¢ï¼Œæ¯ä¸ªå¯¹åº”ä¸€ä¸ª skillï¼Œè¿”å› JSON |  
| postgres_agent.py | ä¾æ¬¡è°ƒç”¨ skillï¼Œåˆ†æ JSON è¾“å‡ºï¼Œç”Ÿæˆ Markdown æŠ¥å‘Š |  
| SKILL.md | å„ skill çš„åŠŸèƒ½è¯´æ˜ã€ç”¨æ³•ã€è¾“å‡ºæ ¼å¼ |  
  
3ã€Skill ç”¨æ³•  
  
1\. ç‹¬ç«‹æ‰§è¡Œå•ä¸ª skill  
```  
./run_postgres_check.sh <skill_name> [å‚æ•°]  
  
# ç¤ºä¾‹  
./run_postgres_check.sh get_long_running_queries 5    # æŸ¥è¯¢è¶…è¿‡5åˆ†é’Ÿçš„é•¿æŸ¥è¯¢  
./run_postgres_check.sh get_idle_in_transaction_sessions 2  # æŸ¥è¯¢è¶…è¿‡2åˆ†é’Ÿçš„idleäº‹åŠ¡  
./run_postgres_check.sh get_cache_hit_rate  
./run_postgres_check.sh get_table_bloat  
```  
  
2\. å®Œæ•´å·¡æ£€ï¼ˆæ¨èï¼‰  
  
ä½¿ç”¨æ–¹å¼  
```  
cd postgres-daily-check  
  
# è¿è¡Œå·¡æ£€  
# ç”Ÿæˆ daily_health_report.md  
python3 scripts/postgres_agent.py  
```  
  
è¯´æ˜ï¼š`postgres_agent.py` åªä½¿ç”¨ Python æ ‡å‡†åº“ï¼ˆ`json, subprocess, datetime, os`ï¼‰ï¼Œæ— éœ€é¢å¤–ä¾èµ–ã€‚  
  
3\. ç›®å‰å¯ç”¨ Skill åˆ—è¡¨å¦‚ä¸‹  
  
PostgreSQL å·¡æ£€æŠ¥å‘Šæ€»ç»“ (æŒ‰ SKILL.md åˆ†ç±»)  
   
1. Core Health & Availability âœ…/âŒ  
  
| Skill | Status | Finding |  
|-------|--------|---------|  
| get_invalid_indexes | âœ… OK | æ— æ— æ•ˆç´¢å¼• |  
| get_xid_wraparound_risk | âœ… OK | XIDå¹´é¾„æ­£å¸¸ |  
| get_blocking_locks | âŒ ERROR | æ£€æµ‹åˆ°5ä¸ªé˜»å¡é” |  
| get_deadlock_detection | âœ… OK | æ— æ­»é” |  
| get_critical_settings | âœ… OK | å…³é”®å‚æ•°æ­£å¸¸ |  
  
å…³é”®é—®é¢˜: truncate test é˜»å¡äº†æ‰€æœ‰å¯¹ test è¡¨çš„æŸ¥è¯¢ï¼Œå·²æŒç»­1å°æ—¶16åˆ†é’Ÿã€‚  
   
2. Session & Connection Monitoring âœ…/âš ï¸  
  
| Skill | Status | Finding |  
|-------|--------|---------|  
| get_long_running_queries | âš ï¸ WARNING | 5ä¸ªé•¿æŸ¥è¯¢ (æœ€é•¿1å°æ—¶16åˆ†) |  
| get_idle_in_transaction_sessions | âš ï¸ WARNING | 1ä¸ªidle in transaction (1å°æ—¶16åˆ†) |  
| get_long_running_transactions | âš ï¸ WARNING | å­˜åœ¨é•¿æ—¶é—´è¿è¡Œäº‹åŠ¡ |  
| get_long_running_prepared_transactions | âœ… OK | æ— é¢„å¤‡äº‹åŠ¡ |  
| get_connection_usage | âœ… OK | 8/100 è¿æ¥ (8%) |  
| get_lock_waiters | âš ï¸ WARNING | 20ä¸ªé”ç­‰å¾…è€… |  
| get_wait_events | âš ï¸ WARNING | 5ä¸ª relation é”ç­‰å¾… |  
   
3. Performance & Activity âš ï¸  
  
| Skill | Status | Finding | å»ºè®®å€¼ |  
|-------|--------|---------|--------|  
| get_cache_hit_rate | âš ï¸ WARNING | 54.8% | >99% |  
| get_rollback_rate | âœ… OK | æ­£å¸¸ | <5% |  
| get_top_sql_by_time | â„¹ï¸ INFO | pgbenchæ›´æ–°è¯­å¥è€—æ—¶æœ€é•¿ | - |  
| get_table_hotspots | â„¹ï¸ INFO | pgbench_accounts DMLæœ€å¤š | - |  
| get_bgwriter_stats | âš ï¸ WARNING | maxwritten_clean=13,844 | <100 |  
| get_temp_file_usage | âœ… OK | 4ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œ191MB | - |  
| get_io_statistics | â„¹ï¸ INFO | æ€»å—è¯»å†™æ­£å¸¸ | - |  
| get_io_statistics_v2 | â„¹ï¸ INFO | client backend I/Oè¯¦æƒ… | - |  
| get_analyze_progress | âœ… OK | æ— è¿è¡Œä¸­çš„ANALYZE | - |  
| get_create_index_progress | âœ… OK | æ— è¿è¡Œä¸­çš„CREATE INDEX | - |  
| get_cluster_progress | âœ… OK | æ— è¿è¡Œä¸­çš„CLUSTER | - |  
| get_wal_statistics | âš ï¸ WARNING | wal_buffers_full=113,935 | <1000 |  
| get_checkpointer_stats | â„¹ï¸ INFO | å®šæ—¶æ£€æŸ¥ç‚¹=0, è¯·æ±‚æ£€æŸ¥ç‚¹=0 | - |  
| get_slru_stats | â„¹ï¸ INFO | transaction SLRUå‘½ä¸­ç‡97.85% | >90% |  
| get_user_function_stats | â„¹ï¸ INFO | track_functionsæœªå¼€å¯ | - |  
   
4. Replication & Archiving âœ…  
  
| Skill | Status | Finding |  
|-------|--------|---------|  
| get_replication_slots | âœ… OK | æ— å¤åˆ¶æ§½ |  
| get_replication_status | âœ… OK | æ— æ´»è·ƒå‰¯æœ¬ |  
| get_logical_replication_status | âœ… OK | æ— é€»è¾‘å¤åˆ¶ |  
| get_wal_archiver_status | âœ… OK | å½’æ¡£æ­£å¸¸ |  
   
5. Maintenance & Storage âš ï¸  
  
| Skill | Status | Finding | æµªè´¹ç©ºé—´ |  
|-------|--------|---------|----------|  
| get_autovacuum_status | âœ… OK | æ— è¿è¡Œä¸­çš„autovacuum | - |  
| get_table_bloat | âŒ ERROR | pgbench_accounts 88.6% è†¨èƒ€ | 2.03 GB |  
| get_index_bloat | âŒ ERROR | pgbench_tellers_pkey 99.94% è†¨èƒ€ | 31.77 MB |  
| get_top_objects_by_size | â„¹ï¸ INFO | pgbench_accounts: 2346 MB | - |  
| get_large_unused_indexes | âœ… OK | æ— å¤§ç´¢å¼•æœªè¢«ä½¿ç”¨ | - |  
| get_stale_statistics | âœ… OK | ç»Ÿè®¡ä¿¡æ¯å·²æ›´æ–° | - |  
| get_database_sizes | â„¹ï¸ INFO | postgres: 3579 MB | - |  
| get_sequence_exhaustion | âœ… OK | æ— åºåˆ—å³å°†è€—å°½ | - |  
| get_database_conflict_stats | â„¹ï¸ INFO | éå¤‡åº“ï¼Œæ— å†²çªç»Ÿè®¡ | - |  
   
6. Freeze & Wraparound Protection âœ…  
  
| Skill | Status | Finding |  
|-------|--------|---------|  
| get_freeze_prediction | âœ… OK | æ— è¡¨æ¥è¿‘å†»ç»“é˜ˆå€¼ |  
  
âœ… SKILL.md è¦†ç›–ç‡  
  
| ç±»åˆ« | Skillsæ€»æ•° | å·²æ‰§è¡Œ | è¦†ç›–ç‡ |  
|------|-----------|--------|--------|  
| Core Health & Availability | 5 | 5 | 100% |  
| Session & Connection Monitoring | 7 | 7 | 100% |  
| Performance & Activity | 14 | 14 | 100% |  
| Replication & Archiving | 4 | 4 | 100% |  
| Maintenance & Storage | 9 | 9 | 100% |  
| Freeze & Wraparound Protection | 1 | 1 | 100% |  
| æ€»è®¡ | 40 | 40 | 100% |  
  
  
  
4ã€ä½¿ç”¨æ³¨æ„  
  
éœ€è¦æå‰é…ç½® PostgreSQL pg_stat_statements æ’ä»¶.   
  
ç”±äº PG é‡‡ç”¨ç±»ä¼¼ PDB çš„æ¶æ„, ä¸åŒçš„ database éœ€è¦ä¸åŒçš„è¿æ¥, æ‰€ä»¥å¦‚æœä½ çš„å®ä¾‹ä¸­æœ‰å¤šä¸ªæ•°æ®åº“, è®°å¾—å‘Šè¯‰ AI è¿›è¡Œå¤šæ¬¡å·¡æ£€.   
  
ai agent ç«¯éœ€è¦å®‰è£…äº† psql å®¢æˆ·ç«¯.    
  
## ä¾‹å­  
æ”¯æŒ SKILL çš„ AI Agent éƒ½å¯ä»¥ä½¿ç”¨å®ƒäº†.   
  
ç›´æ¥åœ¨ opencode ä¸­è¿›è¡Œå·¡æ£€.   
```  
å·¡æ£€è¿™ä¸ª PostgreSQL å®ä¾‹: host 127.0.0.1 port 1922 user digoal dbname postgres password 123456 , å·¡æ£€å®Œæˆåæ ¹æ®æŠ¥å‘Šç»™å‡ºè¯¦ç»†çš„å»ºè®®.  
```  
  
AIä¼šè‡ªåŠ¨æ ¹æ® SKILL.md æŒ‡å¼•è¿›è¡Œå·¡æ£€, åŒ…æ‹¬è‡ªåŠ¨é…ç½® `db_config.env`, è¾“å‡ºå¦‚ä¸‹  
  
```  
å·¡æ£€å®Œæˆï¼æŠ¥å‘Šæ—¶é—´ï¼š2026-02-04 14:53:46  
---  
PostgreSQL å·¡æ£€æŠ¥å‘Šè¯¦ç»†åˆ†æ  
æ•´ä½“çŠ¶æ€: âŒ ERROR  
---  
  
ğŸ”´ ä¸¥é‡é—®é¢˜  
  
1. é˜»å¡é” (Blocking Locks)  
é—®é¢˜æè¿°: å‘ç° 5 ä¸ªé”é˜»å¡åœºæ™¯  
- PID 23716 (truncate test) æŒæœ‰ AccessExclusiveLockï¼Œé˜»å¡äº†æ‰€æœ‰å…¶ä»–ä¼šè¯  
- å¤šä¸ª select * from test æŸ¥è¯¢åœ¨ç­‰å¾…é”  
  
å»ºè®®:  
-- 1. æŸ¥çœ‹é˜»å¡ä¼šè¯  
SELECT pid, usename, state, query, wait_event_type, wait_event   
FROM pg_stat_activity   
WHERE pid IN (23716, 23718, 23636, 23637, 23757, 23828);  
-- 2. ç»ˆæ­¢é˜»å¡ä¼šè¯ï¼ˆå¦‚æœç¡®è®¤å¯ä»¥ç»ˆæ­¢ï¼‰  
SELECT pg_terminate_backend(23716);  
-- 3. æˆ–è€…ç­‰å¾…ä¼šè¯è‡ªè¡Œé‡Šæ”¾é”  
æ ¹å› åˆ†æ: truncate test å‘½ä»¤æŒæœ‰æ’å®ƒé”ï¼Œè€Œå¤šä¸ª SELECT æŸ¥è¯¢éœ€è¦è®¿é—®è¯¥è¡¨ã€‚é•¿æ—¶é—´ä¸æäº¤äº‹åŠ¡å¯¼è‡´é”æŒæœ‰æ—¶é—´è¿‡é•¿ã€‚  
  
---  
  
2. é•¿äº‹åŠ¡ (Idle-in-Transaction)  
é—®é¢˜æè¿°:   
- PID 23716 idle in transaction 30åˆ†é’Ÿ45ç§’  
å»ºè®®:  
-- æŸ¥æ‰¾é•¿æ—¶é—´ idle in transaction çš„ä¼šè¯  
SELECT pid, usename, state, age(clock_timestamp(), xact_start) AS xact_age,  
       query, xact_start  
FROM pg_stat_activity  
WHERE state = 'idle in transaction'  
  AND age(clock_timestamp(), xact_start) > interval '5 minutes'  
ORDER BY xact_start;  
-- ç»ˆæ­¢é—®é¢˜ä¼šè¯  
SELECT pg_terminate_backend(23716);  
å»ºè®®é…ç½®:  
-- åœ¨ postgresql.conf ä¸­æ·»åŠ   
idle_in_transaction_session_timeout = 60000  -- 60ç§’åè‡ªåŠ¨ç»ˆæ­¢  
  
---  
  
ğŸŸ  è­¦å‘Šé—®é¢˜  
  
3. é•¿æŸ¥è¯¢ (Long-Running Queries)  
é—®é¢˜æè¿°: 5 ä¸ªæŸ¥è¯¢è¿è¡Œè¶…è¿‡ 5 åˆ†é’Ÿ  
| PID | ç”¨æˆ· | æ—¶é•¿ | æŸ¥è¯¢ |  
|-----|------|------|------|  
| 23718 | postgres | 30:34 | truncate test |  
| 23636 | postgres | 30:30 | select * from test |  
| 23637 | postgres | 30:27 | select * from test |  
å»ºè®®:  
-- æŸ¥çœ‹è¯¦ç»†æŸ¥è¯¢å†…å®¹  
SELECT pid, now() - query_start AS duration, usename, query  
FROM pg_stat_activity  
WHERE state = 'active'  
ORDER BY duration DESC LIMIT 10;  
  
---  
  
4. ç¼“å­˜å‘½ä¸­ç‡ä½ (Low Cache Hit Rate)  
é—®é¢˜æè¿°:   
- å½“å‰: 51.4%  
- æ­£å¸¸å€¼: >99%  
å»ºè®®:  
-- æ£€æŸ¥å…±äº«å†…å­˜å¤§å°  
SHOW shared_buffers;  
-- æ£€æŸ¥å®é™…ç¼“å­˜ä½¿ç”¨  
SELECT   
    sum(heap_blks_read) AS heap_read,  
    sum(heap_blks_hit) AS heap_hit,  
    round(sum(heap_blks_hit) / (sum(heap_blks_hit) + sum(heap_blks_read)) * 100, 2) AS hit_ratio  
FROM pg_statio_user_tables;  
-- è°ƒä¼˜å»ºè®®  
-- 1. å¢åŠ  shared_buffers (å»ºè®®ä¸ºç‰©ç†å†…å­˜çš„ 25%)  
-- 2. è€ƒè™‘å¢åŠ  work_mem  
-- 3. ä¼˜åŒ–æŸ¥è¯¢å‡å°‘å…¨è¡¨æ‰«æ  
postgresql.conf è°ƒä¼˜å»ºè®®:  
shared_buffers = 4GB                    # ç‰©ç†å†…å­˜çš„ 25%  
effective_cache_size = 12GB            # ç‰©ç†å†…å­˜çš„ 75%  
work_mem = 64MB                        # æ¯ä¸ªæ’åºæ“ä½œ  
maintenance_work_mem = 1GB              # VACUUM ç­‰ç»´æŠ¤æ“ä½œ  
  
---  
  
5. Background Writer Maxwritten  
é—®é¢˜æè¿°: bgwriter è¾¾åˆ° max pages é™åˆ¶ 12590 æ¬¡  
å»ºè®®:  
-- æ£€æŸ¥å½“å‰ bgwriter å‚æ•°  
SHOW bgwriter_lru_maxpages;  
SHOW bgwriter_flush_after;  
SHOW bgwriter_lru_multiplier;  
-- postgresql.conf è°ƒä¼˜å»ºè®®  
bgwriter_lru_maxpages = 1000           # æé«˜åˆ° 1000  
bgwriter_lru_multiplier = 2.0           # ä¿æŒåˆç†çš„é¢„å†™æ¯”ä¾‹  
bgwriter_flush_after = 512kB           # æ‰¹é‡åˆ·ç›˜  
  
---  
  
6. è¡¨è†¨èƒ€ä¸¥é‡ (Table Bloat)  
é—®é¢˜æè¿°:  
| è¡¨å | å¤§å° | è†¨èƒ€ç‡ | æµªè´¹ç©ºé—´ |  
|------|------|--------|----------|  
| pgbench_accounts | 2.29 GB | 88.65% | 2.03 GB |  
| pgbench_history | 598 MB | 54% | 314 MB |  
å»ºè®®:  
-- 1. æ‰‹åŠ¨æ‰§è¡Œ VACUUM (ä¸ä¼šé”è¡¨ï¼Œä½†å¯èƒ½ä¸å®Œå…¨å›æ”¶ç©ºé—´)  
VACUUM VERBOSE ANALYZE pgbench_accounts;  
-- 2. æ‰§è¡Œ VACUUM FULL (ä¼šé”è¡¨ï¼Œå®Œå…¨å›æ”¶ç©ºé—´)  
VACUUM FULL pgbench_accounts;  
-- 3. æˆ–è€…ä½¿ç”¨ pg_repack (åœ¨çº¿å›æ”¶ï¼Œä¸é˜»å¡è¯»å†™)  
-- éœ€è¦å®‰è£… pg_repack æ‰©å±•  
é¢„é˜²æªæ–½:  
-- æ£€æŸ¥ autovacuum è®¾ç½®  
SHOW autovacuum;  
SHOW autovacuum_vacuum_threshold;  
SHOW autovacuum_vacuum_scale_factor;  
-- postgresql.conf è°ƒä¼˜  
autovacuum = on  
autovacuum_naptime = 30s  
autovacuum_vacuum_scale_factor = 0.05  
autovacuum_vacuum_cost_delay = 2ms  
  
---  
  
7. ç´¢å¼•è†¨èƒ€ (Index Bloat)  
é—®é¢˜æè¿°:  
| ç´¢å¼•å | å¤§å° | è†¨èƒ€ç‡ |  
|--------|------|--------|  
| pgbench_tellers_pkey | 31.79 MB | 99.94% |  
| pgbench_branches_pkey | 6.42 MB | 99.97% |  
å»ºè®®:  
-- é‡å»ºè†¨èƒ€çš„ç´¢å¼•  
REINDEX INDEX pgbench_tellers_pkey;  
REINDEX INDEX pgbench_branches_pkey;  
-- æˆ–è€…ä½¿ç”¨ CONCURRENTLY (ä¸é˜»å¡è¯»å†™)  
REINDEX INDEX CONCURRENTLY pgbench_tellers_pkey;  
  
---  
  
âœ… æ­£å¸¸é¡¹ç›®  
  
| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |  
|--------|------|------|  
| æ— æ•ˆç´¢å¼• | âœ… OK | æ— æŸåç´¢å¼• |  
| XID å›ç»• | âœ… OK | é£é™©ä½ |  
| æ­»é” | âœ… OK | æ— æ­»é”å‘ç”Ÿ |  
| è¿æ¥æ•° | âœ… OK | ä»…ä½¿ç”¨ 8% |  
| å›æ»šç‡ | âœ… OK | æ­£å¸¸èŒƒå›´ |  
| WAL å½’æ¡£ | âœ… OK | æ­£å¸¸ |  
  
---  
  
ğŸ“Š å­˜å‚¨ä½¿ç”¨ç»Ÿè®¡  
| æ•°æ®åº“ | å¤§å° |  
|--------|------|  
| postgres | 3501 MB |  
| gemini_test | 8 MB |  
| contrib_regression | 8 MB |  
| test | 7 MB |  
  
---  
  
ğŸ”§ ç«‹å³è¡ŒåŠ¨å»ºè®®  
  
ç´§æ€¥ (ç«‹å³å¤„ç†)  
  
1. ç»ˆæ­¢é˜»å¡ä¼šè¯  
SELECT pg_terminate_backend(23716);  -- ç»ˆæ­¢ idle in transaction ä¼šè¯  
2. é‡å»ºè†¨èƒ€ç´¢å¼•  
REINDEX INDEX pgbench_tellers_pkey;  
REINDEX INDEX pgbench_branches_pkey;  
  
çŸ­æœŸ (æœ¬å‘¨å†…)  
  
3. æ‰§è¡Œè¡¨æ¸…ç†  
VACUUM FULL pgbench_accounts;  
VACUUM FULL pgbench_history;  
4. è°ƒä¼˜ bgwriter å‚æ•°  
  
é•¿æœŸ (é…ç½®ä¼˜åŒ–)  
  
5. ä¼˜åŒ– postgresql.conf  
shared_buffers = 4GB  
effective_cache_size = 12GB  
work_mem = 64MB  
maintenance_work_mem = 1GB  
bgwriter_lru_maxpages = 1000  
idle_in_transaction_session_timeout = 60000  
6. å¯ç”¨è‡ªåŠ¨æ¸…ç†ç›‘æ§  
-- åˆ›å»ºç›‘æ§è§†å›¾  
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;  
-- è®¾ç½®åˆç†çš„ autovacuum å‚æ•°  
  
---  
  
æ³¨æ„: è¯¥å®ä¾‹æ­£åœ¨è¿è¡Œ pgbench æµ‹è¯•è´Ÿè½½ï¼Œä»¥ä¸Šé—®é¢˜ä¸»è¦æ˜¯æµ‹è¯•åœºæ™¯ä¸‹çš„æ­£å¸¸ç°è±¡ã€‚å¦‚æœæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®æ ¹æ®å®é™…ä¸šåŠ¡è´Ÿè½½è°ƒæ•´å‚æ•°ã€‚  
```  
  
## å‚è€ƒ  
[ã€Šå¤§å­¦ç”Ÿæ•°æ®åº“å®è·µè¯¾: Docker é•œåƒã€‹](../202512/20251205_02.md)     
  
[ã€Šopencode åˆä¸€ä¸ªæ–°çš„ AI Coding Agent, æœ‰äººè¯´æ¯” Claude/gemini/qwen coder å¥½ç”¨ã€‹](../202602/20260203_01.md)    
  
[ã€ŠGemini CLI Coder Agent è§£å†³å¤–ç½‘è®¿é—® æ–¹æ³• (å« brew éƒ¨ç½²)ã€‹](../202601/20260117_02.md)    
  
[ã€ŠGemini CLI å¯¹æ¯” Qwen3 Coder è°æ›´å¼º?ã€‹](../202601/20260115_05.md)    
  
[ã€ŠQwen coder AI ç¼–ç¨‹ç»ˆææŠ€å·§: æ¥å…¥ DeepWiki mcpã€‹](../202601/20260114_01.md)     
  
https://github.com/digoal/blog/tree/master/README.md  
  
https://opencode.ai/docs/skills  
  
