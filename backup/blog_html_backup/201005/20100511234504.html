<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL Statistics and Query Explain Introduction</h2>
	<h5 id="">2010-05-11 23:45:04&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201041111454178/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><p style="TEXT-INDENT: 2em;"  >熟悉ORACLE的朋友对执行计划和统计信息肯定不陌生。今天我要说的是PostgreSQL的统计信息和执行计划，同时那ORACLE的做一个简单比较。</p>  <p style="TEXT-INDENT: 2em;"  >在说PostgreSQL的统计信息和SQL优化器之前，先来看一个ORACLE SQL的处理过程，因为PG的处理过程和这个非常类似：</p>  <p style="TEXT-INDENT: 2em;"  ><a rel="nofollow" href="http://dba.sky-mobi.com/wp-content/uploads/2010/05/sqlprocess.jpg"  ></a></p>  <p style="TEXT-INDENT: 2em;"  ><a target="_blank" href="http://img166.ph.126.net/IUfo3TEwvBpWyUACoNNvZw==/1638184364457824592.jpg"  ><img title="PostgreSQL Statistics and Query Explain Introduction - 德哥(DiGoal,Just Do It!) - Not Only DBA"  alt="PostgreSQL Statistics and Query Explain Introduction - 德哥(DiGoal,Just Do It!) - Not Only DBA"  src="http://img166.ph.126.net/IUfo3TEwvBpWyUACoNNvZw==/1638184364457824592.jpg"  ></a></p>  <p style="TEXT-INDENT: 2em;"  >可以看出SQL处理分成了五个部分，SQL Statement(接收到客户端提交的SQL),Parsing(语法检查，语义检测，共享池检测),Optimization（产生多种执行计划和成本）,Row Source Generation（生成迭代查询计划）,Execution（执行）如果是硬解析的话才有Optimization和Row Source Generation的过程。</p>  <p style="TEXT-INDENT: 2em;"  >Oracle是需要依赖统计信息来产生执行计划的，如果没有统计信息，Oracle将使用内部信息如（块数）来产生执行计划。PostgreSQL也有统计信息的概念，我们一起来看一看。</p>  <p style="TEXT-INDENT: 2em;"  >首先涉及到一个参数：default_statistics_target</p>  <p style="TEXT-INDENT: 2em;"  >这是一个PostgreSQL的全局参数，指定列柱状图中柱子的个数，也就是表列里边被统计到的散列值目标有多少个，PostgreSQL8.3默认是10,PostgreSQL8.4及9.0的默认值是100。值越大，收集统计信息的耗费也越大。（打个比方，表table_a(col1 int,col2 varchar(60)),那么col1和col2都将有10个值出现在柱状图当中，包含了值，行数占比）</p>  <p style="TEXT-INDENT: 2em;"  >使用ALTER TABLE SET STATISTICS语法可以定义表级别的statistics_target。将覆盖数据库的全局参数。</p>  <p style="TEXT-INDENT: 2em;"  >说完这个参数，接下来看看哪里可以看到这些统计信息：</p>  <p style="TEXT-INDENT: 2em;"  >pg_class系统表：这个表中的relpages,reltuples可作为PLANNER的评估值。relpages表示这个数据库对象占用的disk blocks，reltuples表示行数。（这两个值都不是实时的，只有在VACUUM,ANALYZE,或者某些DDL语句如CREATE INDEX执行之后才会更新。当单独执行analyze时，更新的reltuples可能是个大概值，因为ANALYZE不会进行全表扫描.）planner将扩展取自pg_class的值以匹配表的物理大小，获得更真实的值。</p>  <p style="TEXT-INDENT: 2em;"  >举例：</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >snake=&gt; select relname,relkind,relpages,reltuples from pg_class where relname ~’club’;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >relname &nbsp; &nbsp; &nbsp; &nbsp;| relkind | relpages | reltuples</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――――――C+―――+―――-+―――C</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| r &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;9 | &nbsp; &nbsp; &nbsp; 301</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club_clubid_key &nbsp; &nbsp; &nbsp; | i &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;2 | &nbsp; &nbsp; &nbsp; 301</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club_masterskyid_key1 | i &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;2 | &nbsp; &nbsp; &nbsp; 301</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club_name_key1 &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp; &nbsp; &nbsp; 301</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club_pkey &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | i &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;2 | &nbsp; &nbsp; &nbsp; 301</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >(6 rows)</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >snake=&gt; select count(*) from club;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >count</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >――-</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >305</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >snake=&gt; analyze club;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >ANALYZE</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >snake=&gt; select relname,relkind,relpages,reltuples from pg_class where relname ~’club’;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >relname &nbsp; &nbsp; &nbsp; &nbsp;| relkind | relpages | reltuples</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――――――C+―――+―――-+―――C</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| r &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;9 | &nbsp; &nbsp; &nbsp; 305</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club_clubid_key &nbsp; &nbsp; &nbsp; | i &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;2 | &nbsp; &nbsp; &nbsp; 305</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club_masterskyid_key1 | i &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;2 | &nbsp; &nbsp; &nbsp; 305</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club_name_key1 &nbsp; &nbsp; &nbsp; &nbsp;| i &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;5 | &nbsp; &nbsp; &nbsp; 305</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >club_pkey &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | i &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp;2 | &nbsp; &nbsp; &nbsp; 305</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >由于这个表的PAGE数较小，所以更新之后的值是精确值。</p>  <p style="TEXT-INDENT: 2em;"  >pg_statistic系统表：许多查询并不是查询所有的行的，往往返回的是部分行，如使用WHERE条件查询。PLANNER需要评估WHERE条件将带来多少的结果返回，生成合适的查询计划。此时pg_class提供的两个值就不能满足PLANNER的需求了，需要用到pg_statistic的值。pg_statistic的更新来自analyze,vacuum analyze操作，并且获取到的是近似值。PostgreSQL不推荐我们直接查询pg_statistic，因为需要超级用户的权限，后面我们会说到使用pg_stats来替代查询pg_statistic。</p>  <p style="TEXT-INDENT: 2em;"  >pg_stats系统视图：对于DBA来说，pg_stats更具有可读性，并且权限控制得更好，权限控制在当前用户具有读权限的表。</p>  <p style="TEXT-INDENT: 2em;"  >来看看pg_stats的字段解释：</p>  <p style="TEXT-INDENT: 2em;"  >schemaname =&nbsp;<tt>pg_namespace</tt>.nspname</p>  <p style="TEXT-INDENT: 2em;"  >tablename =&nbsp;<tt>pg_class</tt>.relname</p>  <p style="TEXT-INDENT: 2em;"  >attname =&nbsp;<tt>pg_attribute</tt>.attname</p>  <p style="TEXT-INDENT: 2em;"  >inherited =&nbsp;true, 这行所表示的列的统计信息包含了本表和所有的继承表。</p>  <p style="TEXT-INDENT: 2em;"  >= false，这行所表示的列的统计信息只包含了本表。</p>  <p style="TEXT-INDENT: 2em;"  >null_frac，这行所表示的列的NULL值占总记录数的比例。</p>  <p style="TEXT-INDENT: 2em;"  >avg_width，字段平均宽度。</p>  <p style="TEXT-INDENT: 2em;"  >n_distinct，正数表示所有记录中，唯一值的个数。而且正值一般表示不管记录数怎么变化，此列都有一个固定的唯一值个数。</p>  <p style="TEXT-INDENT: 2em;"  >负数表示随着记录数的增长，唯一值的个数和总记录数保持一定比例。（如-1表示唯一值个数=记录数，如PK COLUMN）</p>  <p style="TEXT-INDENT: 2em;"  >most_common_vals，出现概率较大的列值，如果都一样的概率，这个值为空。如果是某些特殊字段类型如TSVECTOR,这里出现的就是相应的元素值。</p>  <p style="TEXT-INDENT: 2em;"  >most_common_freqs，对应上一个字段中的值概率。如果是某些特殊字段如TSVECTOR，可能包含更多的信息。超过前一个字段的值个数。</p>  <p style="TEXT-INDENT: 2em;"  >histogram_bounds，只有当被统计列的类型可以使用&lt;这样的操作符时，这一列才有值。代表的意义是，两个值之间的记录数被认为是相等的。另外，当most_common_vals中列出了被统计列的所有可能的值，那么histogram_bounds将为NULL，因为没有必要再统计了。这里的被统计列的值不能等于most_comm_vals的被统计列的值。</p>  <p style="TEXT-INDENT: 2em;"  >correlation，取值范围-1到1,值越靠近-1或1被统计列的逻辑顺序与物理行的顺序越有接近趋势。（越接近的话，使用该索引扫排序可以减少磁头移动概率，CLUSTERDB和CLUSTER命令可以强制将表的物理排序匹配索引列的逻辑排序）一般我们去看一个含SERIAL作为PK的表，PK的这一列得到的统计信息里面correlation=1.</p>  <p style="TEXT-INDENT: 2em;"  >好了，这个视图的解释就是如上，还可以使用ALTER TABLE SET STATISTICS或default_statistics_target 来限制<tt>most_common_vals</tt>&nbsp;and&nbsp;<tt>histogram_bounds的最大值范围。</tt></p>  <p style="TEXT-INDENT: 2em;"  >举例：</p>  <p style="TEXT-INDENT: 2em;"  >建立测试表</p>  <p style="TEXT-INDENT: 2em;"  >create table tbl_test(id serial primary key,name varchar(10));</p>  <p style="TEXT-INDENT: 2em;"  >插入测试数据</p>  <p style="TEXT-INDENT: 2em;"  >insert into tbl_test (name) values (‘a’),(‘b’),(‘b’),(‘c’),(‘c’),(‘c’); &nbsp;插入65898行为止</p>  <p style="TEXT-INDENT: 2em;"  >确认总共插入了多少记录</p>  <p style="TEXT-INDENT: 2em;"  >db_monitor=&gt; select count(*) from tbl_test;</p>  <p style="TEXT-INDENT: 2em;"  >65898</p>  <p style="TEXT-INDENT: 2em;"  >查看真实的记录分布</p>  <p style="TEXT-INDENT: 2em;"  >db_monitor=&gt; select name,count(*) from tbl_test group by name;</p>  <p style="TEXT-INDENT: 2em;"  >name | count</p>  <p style="TEXT-INDENT: 2em;"  >c &nbsp; &nbsp;| 32949</p>  <p style="TEXT-INDENT: 2em;"  >b &nbsp; &nbsp;| 21966</p>  <p style="TEXT-INDENT: 2em;"  >a &nbsp; &nbsp;| 10983</p>  <p style="TEXT-INDENT: 2em;"  >更新统计信息</p>  <p style="TEXT-INDENT: 2em;"  >db_monitor=&gt;&nbsp;ANALYZE tbl_test ;</p>  <p style="TEXT-INDENT: 2em;"  >查看系统统计信息表是否属实：</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; select relpages,reltuples from pg_class where relname=’tbl_test’;</font></p><font size="2"  >  </font><p style="TEXT-INDENT: 2em;"  ><font size="2"  >relpages | reltuples</font></p><font size="2"  >  </font><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――-+―――C</font></p><font size="2"  >  </font><p style="TEXT-INDENT: 2em;"  ><font size="2"  >292 | &nbsp; &nbsp; 65898</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >属实。</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; select * from pg_stats where tablename=’tbl_test’;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >schemaname | tablename | attname | null_frac | avg_width | n_distinct | most_common_vals | &nbsp; &nbsp; most_common_freqs &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;histogram_bounds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | correlation</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――+―――C+―――+―――C+―――C+――――+――――――+―――――――――+―――――――――――――――――――――C+――――-</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >monitor &nbsp; &nbsp;| tbl_test &nbsp;| id &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 4 | &nbsp; &nbsp; &nbsp; &nbsp; -1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | {62,6329,13154,19733,26939,33241,39332,45982,52163,58763,65884} | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >monitor &nbsp; &nbsp;| tbl_test &nbsp;| name &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | {c,b,a} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| {0.512333,0.326,0.161667} | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp;0.391998</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >简单解释一下：</p>  <p style="TEXT-INDENT: 2em;"  >当attname=name时most_common_vals列出了所有的列唯一值{c,b,a}，根据规则所以histogram_bounds为空。most_common_freqs 对应的是c,b,a的记录数比例。n_distinct=3。</p>  <p style="TEXT-INDENT: 2em;"  >当attname=id时，n_distinct=-1,表示行数和count(DISTINCT)值一致。most_common_vals为空，因为没有任何一个值比其他的值在行中出现的概率大。histogram_bounds把取值均分成了10个区间{62,6329,13154,19733,26939,33241,39332,45982,52163,58763,65884}。correlation值=1，表示物理行的顺序和ID列的逻辑顺序一致，这个很好理解，因为我们是顺序插入的，而且没有做UPDATE DELETE。</p>  <p style="TEXT-INDENT: 2em;"  >创建索引</p>  <p style="TEXT-INDENT: 2em;"  >db_monitor=&gt; create index idx_test on tbl_test(name);</p>  <p style="TEXT-INDENT: 2em;"  >强制按照IDX_TEST的索引进行物理排序</p>  <p style="TEXT-INDENT: 2em;"  >db_monitor=&gt; CLUSTER tbl_test USING idx_test;</p>  <p style="TEXT-INDENT: 2em;"  >更新统计信息</p>  <p style="TEXT-INDENT: 2em;"  >db_monitor=&gt; ANALYZE tbl_test ;</p>  <p style="TEXT-INDENT: 2em;"  >ANALYZE</p>  <p style="TEXT-INDENT: 2em;"  >查看统计信息</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; select * from pg_stats where tablename=’tbl_test’;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >schemaname | tablename | attname | null_frac | avg_width | n_distinct | most_common_vals | &nbsp; &nbsp; &nbsp;most_common_freqs &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;histogram_bounds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | correlation</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――+―――C+―――+―――C+―――C+――――+――――――+――――――――――+―――――――――――――――――――――C+――――-</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >monitor &nbsp; &nbsp;| tbl_test &nbsp;| id &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 4 | &nbsp; &nbsp; &nbsp; &nbsp; -1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| {13,6506,12518,19576,25779,32641,39293,45957,52579,60063,65834} | &nbsp; &nbsp; 0.39861</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >monitor &nbsp; &nbsp;| tbl_test &nbsp;| name &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | {c,b,a} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| {0.493667,0.334667,0.171667} | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >变化：</p>  <p style="TEXT-INDENT: 2em;"  >most_common_freqs值有变化{0.493667,0.334667,0.171667},因为analyze是随机抽样统计的，所有每次ANALYZE后会有细微差距.</p>  <p style="TEXT-INDENT: 2em;"  >correlation=1 的值出现在name列那一行了。</p>  <p style="TEXT-INDENT: 2em;"  >测一下反向索引</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; drop index idx_test ;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; create index idx_test on tbl_test (name desc);</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; CLUSTER tbl_test USING idx_test ;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; select * from pg_stats where tablename=’tbl_test’;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; analyze tbl_test;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >schemaname | tablename | attname | null_frac | avg_width | n_distinct | most_common_vals | &nbsp; &nbsp; most_common_freqs &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;histogram_bounds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | correlation</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――+―――C+―――+―――C+―――C+――――+――――――+―――――――――+―――――――――――――――――――――――――C+――――-</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >monitor &nbsp; &nbsp;| tbl_test &nbsp;| id &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 4 | &nbsp; &nbsp; &nbsp; &nbsp; -1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | {42,109298,211208,318511,425216,532181,631480,738856,854741,956067,1053950} | &nbsp; &nbsp;0.349504</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >monitor &nbsp; &nbsp;| tbl_test &nbsp;| name &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | {c,b,a} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| {0.491667,0.324333,0.184} | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; -0.681599</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >并没有得到期望的-1结果，而是&nbsp;-0.681599</p>  <p style="TEXT-INDENT: 2em;"  >换ID DESC试试</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; create index idx_test1 on tbl_test (id desc);</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >CREATE INDEX</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; CLUSTER tbl_test USING idx_test1 ;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >CLUSTER</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; analyze tbl_test;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >ANALYZE</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >db_monitor=&gt; select * from pg_stats where tablename=’tbl_test’;</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >schemaname | tablename | attname | null_frac | avg_width | n_distinct | most_common_vals | &nbsp; &nbsp; most_common_freqs &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; histogram_bounds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | correlation</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――+―――C+―――+―――C+―――C+――――+――――――+―――――――――+――――――――――――――――――――――――――+――――-</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >monitor &nbsp; &nbsp;| tbl_test &nbsp;| id &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 4 | &nbsp; &nbsp; &nbsp; &nbsp; -1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | {217,101308,205017,307335,404545,505911,615753,724481,856028,959332,1054205} | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >monitor &nbsp; &nbsp;| tbl_test &nbsp;| name &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; 0 | &nbsp; &nbsp; &nbsp; &nbsp; 2 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 | {c,b,a} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| {0.505333,0.331,0.163667} | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp;0.322349</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >得到了-1的期望结果。</p></div>
	</div>
</div>
</body>
</html>