<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL 行评估算法</h2>
	<h5 id="">2010-05-11 23:49:09&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201041111499884/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><p style="TEXT-INDENT: 2em;"  >了解本文需要先了解一下PostgreSQL的统计信息表pg_class,pg_stats。可以查看我前面写的</p>  <p style="TEXT-INDENT: 2em;"  ><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/163877040201041111454178/"  >PostgreSQL Statistics and Query Explain Introduction</a></p>  <p style="TEXT-INDENT: 2em;"  >接下来先看一个PostgreSQL EXPLAIN语句的输出:</p>  <p style="TEXT-INDENT: 2em;"  ><a rel="nofollow" href="http://dba.sky-mobi.com/wp-content/uploads/2010/05/pg_explain.jpg"  ></a></p>  <p style="TEXT-INDENT: 2em;"  ><a target="_blank" href="http://img856.ph.126.net/kczF4c4Ttb1C3s3Vx98eqA==/2774498845437917747.jpg"  ><img title="PostgreSQL 行评估算法 - 德哥(DiGoal,Just Do It!) - Not Only DBA"  alt="PostgreSQL 行评估算法 - 德哥(DiGoal,Just Do It!) - Not Only DBA"  src="http://img856.ph.126.net/kczF4c4Ttb1C3s3Vx98eqA==/2774498845437917747.jpg"  ></a></p>  <p style="TEXT-INDENT: 2em;"  >注意看图中的rows=114688,PostgreSQL是怎么来算这个值的，这里简单的写一下我对PostgreSQL行评估的理解，有兴趣的朋友可以线下交流,同时这对了解PostgreSQL的代码也是有帮助的。</p>  <p style="TEXT-INDENT: 2em;"  >创建测试表，写入测试记录：</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >create table tbl_test1 (id serial8 primary key,name varchar(32));</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >create table tbl_test2 (id serial8 primary key,name varchar(32));</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >插入测试记录</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  ><span style="line-height: 19px;"  >insert into tbl_test1 (name) values ('a'),('b'),('b'),('c'),('c'),('c'),('d'),('d'),('d'),('d'),('e'),('e'),('e'),('e'),('e'),('f'),('f'),('f'),('f'),('f'),('f'),('g'),('g'),('g'),('g'),('g'),('g'),('g');</span></font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >insert into tbl_test1(name) select name from tbl_test1;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >…………….</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; insert into tbl_test2(name) select name from tbl_test1;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >INSERT 0 14336</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; insert into tbl_test2(name) select name from tbl_test1;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >INSERT 0 14336</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select count(*) from tbl_test1;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >count</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――-</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >14336</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select count(*) from tbl_test2;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >count</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――-</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >28672</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >再插入几条稀有记录</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; insert into tbl_test1 (name) values ('digoal');</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >INSERT 0 1</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; insert into tbl_test2 (name) values ('digoal');</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >INSERT 0 1</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >查看测试记录</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  ><span style="line-height: 19px;"  >bj_dsm_0=&gt; select * from tbl_Test1 limit 29;<br>id | name<br>―-+――<br>1 | a<br>2 | b<br>3 | b<br>4 | c<br>5 | c<br>6 | c<br>7 | d<br>8 | d<br>9 | d<br>10 | d<br>11 | e<br>12 | e<br>13 | e<br>14 | e<br>15 | e<br>16 | f<br>17 | f<br>18 | f<br>19 | f<br>20 | f<br>21 | f<br>22 | g<br>23 | g<br>24 | g<br>25 | g<br>26 | g<br>27 | g<br>28 | g<br>29 | a<br>(29 rows)</span></font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >更新统计信息</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >analyze tbl_test1;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >analyze tbl_test2;</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >例一：</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; explain select * from tbl_test1;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >QUERY PLAN</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――――――――――――――――――――-</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Seq Scan on tbl_test1 &nbsp;(cost=0.00..221.36 rows=14336 width=10)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >PostgreSQL要得出rows=14336，首先得到真实的pages,然后去比较pg_class中的relpages，如果一致的话直接取出pg_class中的reltuples.如果不一致,PostgreSQL会根据真实的pages值自动计算出reltuples。得到的rows=reltuples。</p>  <p style="TEXT-INDENT: 2em;"  >我们来通过查看pg_class验证一下:</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select relname,relpages,reltuples from pg_class where relname='tbl_test1';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >relname &nbsp;| relpages | reltuples</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――C+―――-+―――C</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >tbl_test1 | &nbsp; &nbsp; &nbsp; 78 | &nbsp; &nbsp; 14336</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >完全正确。</p>  <p style="TEXT-INDENT: 2em;"  >例二:</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; explain select * from tbl_test1 where id &lt; 1000;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >QUERY PLAN</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――――――――――――――――――――――――――-</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Index Scan using tbl_test1_pkey on tbl_test1 &nbsp;(cost=0.00..43.52 rows=1044 width=10)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Index Cond: (id &lt; 1000)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(2 rows)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >我们查看一下pg_stats的统计信息</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select attname,histogram_bounds from pg_stats where tablename = 'tbl_test1' and attname='id';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >attname | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;histogram_bounds</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――+――――――――――――――――――――</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >id &nbsp; &nbsp; &nbsp;| {17,1367,2838,4328,5704,7162,8621,10028,11467,12903,14332}</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >ID总共被划分为10个区段，id&lt;1000落在第一个区段.</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >rows=</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >round(14336.0*(((1000.0-17.0)/(1367.0-17.0))/10.0))</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >=1044</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >验证正确。</p>  <p style="TEXT-INDENT: 2em;"  >例三：</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; explain select * from tbl_test1 where name='a';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >QUERY PLAN</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――――――――――――――――――C</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Seq Scan on tbl_test1 &nbsp;(cost=0.00..257.20 rows=487 width=10)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Filter: ((name)::text = 'a'::text)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(2 rows)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >查看一下统计信息：</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select attname,most_common_vals,most_common_freqs from pg_stats where tablename = 'tbl_test1' and attname='name';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >attname | most_common_vals | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;most_common_freqs</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――+――――――+―――――――――――――――――――-</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >name &nbsp; &nbsp;| {g,f,e,d,c,b,a} &nbsp;| {0.239667,0.229,0.174333,0.145333,0.103,0.0746667,0.034}</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >刚好'a'落在了MCV里面,通过统计信息可以看出频率为0.034</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  ><br></font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >rows=</font><span style="text-indent: 2em; line-height: 19px;"  ><font size="2"  >14336*0.034=</font></span><span style="font-size: small; text-indent: 2em;"  >487</span></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >验证正确。</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select count(*) from tbl_test1 where name='a';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >count</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――-</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >512</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >与真实记录差别不大</p>  <p style="TEXT-INDENT: 2em;"  >例四：</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; explain select * from tbl_test1 where name='digoal';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >QUERY PLAN</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――――――――――――――――――</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Seq Scan on tbl_test1 &nbsp;(cost=0.00..257.20 rows=1 width=10)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Filter: ((name)::text = 'digoal'::text)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(2 rows)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >查看统计信息</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select n_distinct,most_common_vals,most_common_freqs,histogram_bounds from pg_stats where tablename='tbl_test1' and attname='name';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >n_distinct | most_common_vals | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;most_common_freqs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | histogram_bounds</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――+――――――+――――――――――――――――――――C+――――――</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >7 | {g,f,e,d,c,b,a} &nbsp;| {0.243,0.225667,0.184333,0.147,0.103333,0.0633333,0.0333333} |</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select 0.243+0.225667+0.184333+0.147+0.103333+0.0633333+0.0333333;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >?column?</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――C</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >0.9999996</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p>  <p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select (1-0.9999996)*14336;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >?column?</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――C</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >0.0057344</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >显然round(0.0057344)=0,但是PostgreSQL取了rows=1。</p>  <p style="TEXT-INDENT: 2em;"  >所以估计rows返回应该都是&gt;=1。</p>  <p style="TEXT-INDENT: 2em;"  >例五:</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; explain select * from tbl_test1 where name='a' and id&lt;1000;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >QUERY PLAN</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――――――――――――――――――――――――――C</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Index Scan using tbl_test1_pkey on tbl_test1 &nbsp;(cost=0.00..45.85 rows=34 width=10)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Index Cond: (id &lt; 1000)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Filter: ((name)::text = 'a'::text)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(3 rows)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >查看统计信息</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select n_distinct,most_common_vals,most_common_freqs,histogram_bounds from pg_stats where tablename='tbl_test1';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >n_distinct | most_common_vals | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;most_common_freqs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; histogram_bounds</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――+――――――+――――――――――――――――――――C+―――――――――――――――――――-</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >-1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| {2,1391,2882,4271,5690,7170,8664,9989,11426,12920,14335}</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >7 | {g,f,e,d,c,b,a} &nbsp;| {0.243,0.225667,0.184333,0.147,0.103333,0.0633333,0.0333333} |</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(2 rows)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >概率应该是两个相乘的结果</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select 14336*(((1000.0-2.0)/(1391.0-2.0))/10.0)*0.0333333;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >?column?</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――――――――C</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >34.334806077926565874258692096</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(1 row)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >验证正确。</p>  <p style="TEXT-INDENT: 2em;"  >例六：</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; explain select * from tbl_test1 t1,tbl_test2 t2 where t1.id&lt;1000 and t1.id=t2.id;</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >QUERY PLAN</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >――――――――――――――――――――――――――――――――</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Merge Join &nbsp;(cost=0.00..545.78 rows=1052 width=20)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Merge Cond: (t1.id = t2.id)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >-&gt; &nbsp;Index Scan using tbl_test1_pkey on tbl_test1 t1 &nbsp;(cost=0.00..43.66 rows=1052 width=10)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Index Cond: (id &lt; 1000)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >-&gt; &nbsp;Index Scan using tbl_test2_pkey on tbl_test2 t2 &nbsp;(cost=0.00..912.36 rows=28674 width=10)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(5 rows)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >查看统计信息</p>  <p style="TEXT-INDENT: 2em;"  ></p><pre class="prettyprint"  ><p></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >bj_dsm_0=&gt; select tablename,n_distinct,most_common_vals,most_common_freqs,histogram_bounds from pg_stats where tablename ~ 'tbl_test';</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >tablename | n_distinct | most_common_vals | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;most_common_freqs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; histogram_bounds</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >―――C+――――+――――――+―――――――――――――――――――+――――――――――――――――――――C</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >tbl_test1 | &nbsp; &nbsp; &nbsp; &nbsp; -1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | {2,1362,2855,4237,5700,7116,8494,9989,11405,12815,14336}</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >tbl_test1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7 | {g,f,e,d,c,b,a} &nbsp;| {0.244,0.215,0.183,0.144,0.109667,0.0626667,0.0416667} &nbsp;|</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >tbl_test2 | &nbsp; &nbsp; &nbsp; &nbsp; -1 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | {5,2831,5541,8355,11671,14421,17172,20137,22954,25755,28668}</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >tbl_test2 | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7 | {g,f,e,d,c,b,a} &nbsp;| {0.243667,0.217333,0.18,0.142333,0.105,0.0736667,0.038} |</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >(4 rows)</font></p><p style="TEXT-INDENT: 2em;"  ><font size="2"  >Merge两个PK取min(rows)</font></p><p></p></pre>  <p style="TEXT-INDENT: 2em;"  >验证正确。</p>  <p style="TEXT-INDENT: 2em;"  >先说到这里，后面还有例子继续补充。</p></div>
	</div>
</div>
</body>
</html>