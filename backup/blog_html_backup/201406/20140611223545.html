<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">PostgreSQL installed in FreeBSD</h2>
	<h5 id="">2014-06-11 22:35:45&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/163877040201451181344545/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>上一篇BLOG介绍了freebsd的安装,&nbsp;</div><div><a target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020145114251585/"   >http://blog.163.com/digoal@126/blog/static/16387704020145114251585/</a></div><div>本文将介绍一下freebsd下编译安装postgresql.</div><div>首先要下载postgresql代码, 解压, 安装.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~ # fetch http://ftp.postgresql.org/pub/source/v9.3.4/postgresql-9.3.4.tar.bz2</font></div><div><font size="2"   >root@digoal:~ # tar -jxvf postgresql-9.3.4.tar.bz2</font></div><div><span style="line-height: 28px;"   ><font size="2"   >root@digoal:~ # cd postgresql-9.3.4</font></span></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # ./configure --prefix=/opt/pgsql9.3.4 --with-pgport=1921 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></div><p></p></pre></div><div>使用这个configure选项的话, 会缺少很多包, 所以要根据configure的返回安装对应的包.</div><div>首先会缺少bison, 但是PG不会因为缺少bison不允许安装, 所以只是WARNING, 缺少一些功能, 需要的话可以安装bison</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@my-domain:~ # pkg search bison</font></div><div><font size="2"   >bison-2.7.1,1</font></div><div><font size="2"   >bisoncpp-4.09.01</font></div><div><font size="2"   >py27-bison-0.1.8_3</font></div><div><font size="2"   >ruby19-rbison-0.0.7_3</font></div><div><font size="2"   >root@my-domain:~ # pkg install bison</font></div><p></p></pre></div><div>接下来,&nbsp;</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >checking for perl... no</font></div><div><font size="2"   >configure: WARNING:</font></div><div><font size="2"   >*** Without Perl you will not be able to build PostgreSQL from Git.</font></div><div><font size="2"   >*** You can obtain Perl from any CPAN mirror site.</font></div><div><font size="2"   >*** (If you are using the official distribution of PostgreSQL then you do not</font></div><div><font size="2"   >*** need to worry about this, because the Perl output is pre-generated.)</font></div><div><font size="2"   >configure: error: Perl not found</font></div><p></p></pre></div><div>说明缺少perl的包, 可以使用pkg search查找一下包名. 然后安装</div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~ # pkg search perl</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >如果search没有结果, 可能是pkg的repository没有配置好, 可以update一下.</span></div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >root@digoal:~ # pkg update</font></span></div><div><div><font size="2"   >Updating repository catalogue</font></div><div><font size="2"   >digests.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100% 1085KB &nbsp;67.8KB/s 185.3KB/s &nbsp; 00:16 &nbsp; &nbsp;</font></div><div><font size="2"   >packagesite.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100% 5007KB 250.3KB/s 376.6KB/s &nbsp; 00:20 &nbsp; &nbsp;</font></div><div><font size="2"   >Incremental update completed, 23207 packages processed:</font></div><div><font size="2"   >0 packages updated, 0 removed and 23207 added.</font></div></div><p></p></pre></div><div><div><br></div><div>再次搜索就有了.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >root@digoal:~ # pkg search perl</font></div><div><font size="2"   >Hyperlatex-2.9.a_4</font></div><div><font size="2"   >amanda-perl-wrapper-1.01</font></div><div><font size="2"   >ap22-mod_perl2-2.0.8,3</font></div><div><font size="2"   >claws-mail-perl-3.10.0</font></div><div><font size="2"   >clipperlib-6.0.0</font></div><div><font size="2"   >dnsmax-perl-1.0.1</font></div><div><font size="2"   >libmp3-archive-perl-0.9</font></div><div><font size="2"   >libproxy-perl-0.4.6</font></div><div><font size="2"   >libtext-charwidth-perl-0.04</font></div><div><font size="2"   >libtext-wrapi18n-perl-0.06</font></div><div><font size="2"   >mldonkey-perlreactor-0.2</font></div><div><font size="2"   >nzbperl-0.6.8_1</font></div><div><font size="2"   >p5-DBIx-Log4perl-0.26</font></div><div><font size="2"   >p5-Dancer-Logger-Log4perl-0.8.1</font></div><div><font size="2"   >p5-Log-Any-Adapter-Log4perl-0.06</font></div><div><font size="2"   >p5-Log-Log4perl-1.42</font></div><div><font size="2"   >p5-Log-Log4perl-Appender-RabbitMQ-0.102220</font></div><div><font size="2"   >p5-MooseX-Log-Log4perl-0.46</font></div><div><font size="2"   >p5-Script-isAperlScript-1.0.0</font></div><div><font size="2"   >p5-Test-Log4perl-0.1001</font></div><div><font size="2"   >p5-bioperl-1.6.923</font></div><div><font size="2"   >p5-eperl-2.2.14</font></div><div><font size="2"   >p5-jmx4perl-1.07_1</font></div><div><font size="2"   >p5-perl-ldap-0.5800</font></div><div><font size="2"   >p5-perlbrew-0.59</font></div><div><font size="2"   >p5-perlkde-4.12.5</font></div><div><font size="2"   >p5-perlqt-4.12.5</font></div><div><font size="2"   >p5-rpm-build-perl-0.82</font></div><div><font size="2"   >p5-uni-perl-0.91</font></div><div><font size="2"   >pecl-perl-1.0.1</font></div><div><font size="2"   >perl2html-0.9.2_1</font></div><div><font size="2"   >perl5-5.16.3_10</font></div><div><font size="2"   >perl5.14-5.14.4_7</font></div><div><font size="2"   >perl5.18-5.18.2_3</font></div><div><font size="2"   >perl5.20-5.20.0_2</font></div><div><font size="2"   >perlconsole-0.4_1</font></div><div><font size="2"   >postfix-policyd-spf-perl-2.010</font></div><div><font size="2"   >postgresql84-plperl-8.4.21_1</font></div><div><font size="2"   >postgresql9-plperl-9.4.b1</font></div><div><font size="2"   >postgresql90-plperl-9.0.17</font></div><div><font size="2"   >postgresql91-plperl-9.1.13_1</font></div><div><font size="2"   >postgresql92-plperl-9.2.8_1</font></div><div><font size="2"   >postgresql93-plperl-9.3.4</font></div><div><font size="2"   >sooperlooper-1.7.0_1</font></div><div><font size="2"   >superlu-3.0.20060201_6</font></div><div><font size="2"   >superlu_mt-2.0.20080115_5</font></div><div><font size="2"   >urxvt-perls-2.0_1</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >不建议安装最新的</font></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >root@digoal:~ # pkg install perl5.20-5.20.0_2</font></div><div><font size="2"   >Updating repository catalogue</font></div><div><font size="2"   >The following 1 packages will be installed:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing perl5.20: 5.20.0_2</font></div><div><font size="2"   >The installation will require 48 MB more space</font></div><div><font size="2"   >13 MB to be downloaded</font></div><div><font size="2"   >Proceed with installing packages [y/N]: y</font></div></div><p></p></pre></div></div><div><br></div><div>重新执行configure, 看看还缺少什么包, 继续安装.</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >root@digoal:~/postgresql-9.3.4 # ./configure --prefix=/opt/pgsql9.3.4 --with-pgport=1921 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></span></div><div><span style="line-height: 28px;"   ><font size="2"   ><br></font></span></div><div><div><font size="2"   >checking for python... no</font></div><div><font size="2"   >configure: error: Python not found</font></div></div><p></p></pre></div><div><br></div><div>这次少了python.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg search python</font></div><div><font size="2"   >python-2.7_1,2</font></div><div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg install python-2.7_1,2</font></div><div><font size="2"   >Updating repository catalogue</font></div><div><font size="2"   >The following 4 packages will be installed:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing gettext: 0.18.3.1_1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing python27: 2.7.6_4</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing python2: 2_2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing python: 2.7_1,2</font></div><div><font size="2"   >The installation will require 78 MB more space</font></div><div><font size="2"   >12 MB to be downloaded</font></div><div><font size="2"   >Proceed with installing packages [y/N]: y</font></div></div><div><div><font size="2"   >gettext-0.18.3.1_1.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% 2078KB &nbsp;79.9KB/s 268.0KB/s &nbsp; 00:26 &nbsp; &nbsp;</font></div><div><font size="2"   >python27-2.7.6_4.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% 9997KB 217.3KB/s 177.0KB/s &nbsp; 00:46 &nbsp; &nbsp;</font></div><div><font size="2"   >python2-2_2.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100% 2336 &nbsp; &nbsp; 2.3KB/s &nbsp; 2.3KB/s &nbsp; 00:00 &nbsp; &nbsp;</font></div><div><font size="2"   >python-2.7_1,2.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% 2288 &nbsp; &nbsp; 2.2KB/s &nbsp; 2.2KB/s &nbsp; 00:00 &nbsp; &nbsp;</font></div><div><font size="2"   >Checking integrity... done</font></div><div><font size="2"   >[1/4] Installing gettext-0.18.3.1_1... done</font></div><div><font size="2"   >[2/4] Installing python27-2.7.6_4... done</font></div><div><font size="2"   >[3/4] Installing python2-2_2... done</font></div><div><font size="2"   >[4/4] Installing python-2.7_1,2... done</font></div><div><font size="2"   >====</font></div><div><font size="2"   >Note that some of the standard modules are provided as separate</font></div><div><font size="2"   >ports since they require extra dependencies:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >bsddb &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; databases/py-bsddb</font></div><div><font size="2"   >gdbm &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;databases/py-gdbm</font></div><div><font size="2"   >sqlite3 &nbsp; &nbsp; &nbsp; &nbsp; databases/py-sqlite3</font></div><div><font size="2"   >tkinter &nbsp; &nbsp; &nbsp; &nbsp; x11-toolkits/py-tkinter</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Install them as needed.</font></div><div><font size="2"   >====</font></div></div><p></p></pre></div><div><br></div><div><div style="line-height: 28px;"   >重新执行configure, 看看还缺少什么包, 继续安装.</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >root@digoal:~/postgresql-9.3.4 # ./configure --prefix=/opt/pgsql9.3.4 --with-pgport=1921 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></span></div><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   ><br style="line-height: 28px;"   ></font></span></div><div><div><div style="line-height: 28px;"   ><font size="2"   >checking for xmlSaveToBuffer in -lxml2... no</font></div><div style="line-height: 28px;"   ><font size="2"   >configure: error: library 'xml2' (version &gt;= 2.6.23) is required for XML support</font></div></div></div><p></p></pre></div><div><div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >这次缺少的 xml2</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg search xml2</font></div></div><div><font size="2"   >xml2-0.5_1</font></div><div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg install xml2-0.5_1</font></div><div><font size="2"   >Updating repository catalogue</font></div><div><font size="2"   >The following 2 packages will be installed:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing libxml2: 2.9.1_1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing xml2: 0.5_1</font></div><div><font size="2"   >The installation will require 4 MB more space</font></div><div><font size="2"   >772 KB to be downloaded</font></div><div><font size="2"   >Proceed with installing packages [y/N]: y</font></div><div><font size="2"   >libxml2-2.9.1_1.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100% &nbsp;753KB 150.6KB/s &nbsp;92.7KB/s &nbsp; 00:05 &nbsp; &nbsp;</font></div><div><font size="2"   >xml2-0.5_1.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% &nbsp; 19KB &nbsp;19.2KB/s &nbsp;19.2KB/s &nbsp; 00:01 &nbsp; &nbsp;</font></div><div><font size="2"   >Checking integrity... done</font></div><div><font size="2"   >[1/2] Installing libxml2-2.9.1_1... done</font></div><div><font size="2"   >[2/2] Installing xml2-0.5_1... done</font></div></div><p></p></pre></div></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >接下来缺少xslt</div></div></div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><span style="line-height: 28px;"   ><font size="2"   >root@digoal:~/postgresql-9.3.4 # ./configure --prefix=/opt/pgsql9.3.4 --with-pgport=1921 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></span></div><div><div style="line-height: 28px;"   ><font size="2"   >checking for xsltCleanupGlobals in -lxslt... no</font></div><div style="line-height: 28px;"   ><font size="2"   >configure: error: library 'xslt' is required for XSLT support</font></div><div style="line-height: 28px;"   ><font size="2"   ><br></font></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg search xslt</font></div><div><font size="2"   >libxslt-1.1.28_3</font></div><div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg install libxslt-1.1.28_3</font></div><div><font size="2"   >Updating repository catalogue</font></div><div><font size="2"   >The following 3 packages will be installed:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing libgpg-error: 1.13_1</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing libgcrypt: 1.5.3_2</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing libxslt: 1.1.28_3</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The installation will require 2 MB more space</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >621 KB to be downloaded</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Proceed with installing packages [y/N]: y</font></div><div><font size="2"   >libgpg-error-1.13_1.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100% &nbsp; 73KB &nbsp;73.0KB/s &nbsp;23.0KB/s &nbsp; 00:01 &nbsp; &nbsp;</font></div><div><font size="2"   >libgcrypt-1.5.3_2.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100% &nbsp;335KB 111.6KB/s 224.8KB/s &nbsp; 00:03 &nbsp; &nbsp;</font></div><div><font size="2"   >libxslt-1.1.28_3.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% &nbsp;213KB &nbsp;70.9KB/s &nbsp;52.8KB/s &nbsp; 00:03 &nbsp; &nbsp;</font></div><div><font size="2"   >Checking integrity... done</font></div><div><font size="2"   >[1/3] Installing libgpg-error-1.13_1... done</font></div><div><font size="2"   >[2/3] Installing libgcrypt-1.5.3_2... done</font></div><div><font size="2"   >[3/3] Installing libxslt-1.1.28_3... done</font></div></div></div><p></p></pre></div><div><div><br></div><div>注意libxslt安装完后, 报缺少libxslt/xslt.h头文件</div><div><pre class="prettyprint"   ><p></p><div><span style="line-height: 28px;"   ><font size="2"   >root@digoal:~/postgresql-9.3.4 # ./configure --prefix=/opt/pgsql9.3.4 --with-pgport=1921 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></span></div><div><div><font size="2"   >checking for libxslt/xslt.h... no</font></div><div><font size="2"   >configure: error: header file &lt;libxslt/xslt.h&gt; is required for XSLT support</font></div></div><p></p></pre></div><div style="line-height: 28px;"   >但是这个头文件实际上已经存在了</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >root@digoal:~/postgresql-9.3.4 # find / -name xslt.h</font></div><div style="line-height: 28px;"   ><font size="2"   >/usr/local/include/libxslt/xslt.h</font></div><p></p></pre></div><div style="line-height: 28px;"   ><br></div><div style="line-height: 28px;"   >使用CPPFLAGS设置include文件夹</div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >./configure --help</font></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><font size="2"   >Some influential environment variables:</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; CC &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;C compiler command</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; CFLAGS &nbsp; &nbsp; &nbsp;C compiler flags</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; LDFLAGS &nbsp; &nbsp; linker flags, e.g. -L&lt;lib dir&gt; if you have libraries in a</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nonstandard directory &lt;lib dir&gt;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; LIBS &nbsp; &nbsp; &nbsp; &nbsp;libraries to pass to the linker, e.g. -l&lt;library&gt;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; CPPFLAGS &nbsp; &nbsp;C/C++/Objective C preprocessor flags, e.g. -I&lt;include dir&gt; if</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; you have headers in a nonstandard directory &lt;include dir&gt;</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; CPP &nbsp; &nbsp; &nbsp; &nbsp; C preprocessor</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; LDFLAGS_EX &nbsp;extra linker flags for linking executables only</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; LDFLAGS_SL &nbsp;extra linker flags for linking shared libraries only</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; DOCBOOKSTYLE</font></div><div style="line-height: 28px;"   ><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; location of DocBook stylesheets</font></div></div><p></p></pre></div><div style="line-height: 28px;"   ><div style="line-height: 28px;"   ><br></div></div><div><div><div style="line-height: 28px;"   >重新执行configure, 并设置CPPFLAGS. 检查通过.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # ./configure CPPFLAGS='-I/usr/local/include' --prefix=/opt/pgsql9.3.4 --with-pgport=1921 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></div></div><div><div><div style="line-height: 28px;"   ><font size="2"   >checking libxslt/xslt.h usability... yes</font></div><div style="line-height: 28px;"   ><font size="2"   >checking libxslt/xslt.h presence... yes</font></div></div></div><p></p></pre></div></div><div><div style="line-height: 28px;"   >报缺少ldap.h</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div style="line-height: 28px;"   ><font size="2"   >checking for ldap.h... no</font></div><div style="line-height: 28px;"   ><font size="2"   >configure: error: header file &lt;ldap.h&gt; is required for LDAP</font></div><p></p></pre></div><div style="line-height: 28px;"   >安装openldap</div><div><pre class="prettyprint"   ><p></p><div><div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg search ldap &nbsp;</font></div></div></div><div><font size="2"   >openldap-server-2.4.39_1</font></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg install openldap-server-2.4.39_1</font></div><div><div><font size="2"   >Updating repository catalogue</font></div><div><font size="2"   >The following 4 packages will be installed:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing openldap-client: 2.4.39</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing libltdl: 2.4.2_3</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing db46: 4.6.21.4</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing openldap-server: 2.4.39_1</font></div><div><font size="2"   >The installation will require 39 MB more space</font></div><div><font size="2"   >7 MB to be downloaded</font></div><div><font size="2"   >Proceed with installing packages [y/N]: y</font></div></div><div><div><font size="2"   >openldap-client-2.4.39.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% &nbsp;995KB &nbsp;58.5KB/s 184.6KB/s &nbsp; 00:17 &nbsp; &nbsp;</font></div><div><font size="2"   >libltdl-2.4.2_3.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100% &nbsp; 37KB &nbsp;36.8KB/s &nbsp;36.8KB/s &nbsp; 00:00 &nbsp; &nbsp;</font></div><div><font size="2"   >db46-4.6.21.4.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100% 5218KB 173.9KB/s 437.9KB/s &nbsp; 00:30 &nbsp; &nbsp;</font></div><div><font size="2"   >openldap-server-2.4.39_1.txz &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% &nbsp;884KB 126.4KB/s 224.4KB/s &nbsp; 00:07 &nbsp; &nbsp;</font></div><div><font size="2"   >Checking integrity... done</font></div><div><font size="2"   >[1/4] Installing openldap-client-2.4.39... done</font></div><div><font size="2"   >[2/4] Installing libltdl-2.4.2_3... done</font></div><div><font size="2"   >[3/4] Installing db46-4.6.21.4... done</font></div><div><font size="2"   >[4/4] Installing openldap-server-2.4.39_1...===&gt; Creating users and/or groups.</font></div><div><font size="2"   >Creating group 'ldap' with gid '389'.</font></div><div><font size="2"   >Creating user 'ldap' with uid '389'.</font></div><div><font size="2"   >&nbsp;done</font></div><div><font size="2"   >************************************************************</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The OpenLDAP client package has been successfully installed.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Edit</font></div><div><font size="2"   >&nbsp; /usr/local/etc/openldap/ldap.conf</font></div><div><font size="2"   >to change the system-wide client defaults.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Try `man ldap.conf' and visit the OpenLDAP FAQ-O-Matic at</font></div><div><font size="2"   >&nbsp; http://www.OpenLDAP.org/faq/index.cgi?file=3</font></div><div><font size="2"   >for more information.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >************************************************************</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >************************************************************</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The OpenLDAP server package has been successfully installed.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >In order to run the LDAP server, you need to edit</font></div><div><font size="2"   >&nbsp; /usr/local/etc/openldap/slapd.conf</font></div><div><font size="2"   >to suit your needs and add the following lines to /etc/rc.conf:</font></div><div><font size="2"   >&nbsp; slapd_enable="YES"</font></div><div><font size="2"   >&nbsp; slapd_flags='-h "ldapi://%252fvar%252frun%252fopenldap%252fldapi/ ldap://0.0.0.0/"'</font></div><div><font size="2"   >&nbsp; slapd_sockets="/var/run/openldap/ldapi"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Then start the server with</font></div><div><font size="2"   >&nbsp; /usr/local/etc/rc.d/slapd start</font></div><div><font size="2"   >or reboot.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Try `man slapd' and the online manual at</font></div><div><font size="2"   >&nbsp; http://www.OpenLDAP.org/doc/</font></div><div><font size="2"   >for more information.</font></div><div><font size="2"   >&nbsp;&nbsp;</font></div><div><font size="2"   >slapd runs under a non-privileged user id (by default `ldap'),</font></div><div><font size="2"   >see /usr/local/etc/rc.d/slapd for more information.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >************************************************************</font></div></div><p></p></pre></div></div></div><div><br></div><div>接下来是未找到tcl和tclsh, 注意版本.</div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >checking for tclsh... no</font></div><div><font size="2"   >checking for tcl... no</font></div><div><font size="2"   >checking for tclsh8.5... no</font></div><div><font size="2"   >checking for tclsh85... no</font></div><div><font size="2"   >checking for tclsh8.4... no</font></div><div><font size="2"   >checking for tclsh84... no</font></div><div><font size="2"   >checking for tclsh8.3... no</font></div><div><font size="2"   >checking for tclsh83... no</font></div><div><font size="2"   >configure: error: Tcl shell not found</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg search tcl</font></div><div><div><font size="2"   >tcl84-8.4.20_2,1</font></div><div><font size="2"   >tcl85-8.5.15_2</font></div><div><font size="2"   >tcl86-8.6.1</font></div></div><div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg install tcl85-8.5.15_2</font></div><div><font size="2"   >Updating repository catalogue</font></div><div><font size="2"   >The following 1 packages will be installed:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; Installing tcl85: 8.5.15_2</font></div><div><font size="2"   >The installation will require 6 MB more space</font></div><div><font size="2"   >920 KB to be downloaded</font></div><div><font size="2"   >Proceed with installing packages [y/N]: y</font></div></div><p></p></pre></div><div><br></div><div>好了, 终于完全通过检测了<br><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # ./configure CPPFLAGS='-I/usr/local/include' --prefix=/opt/pgsql9.3.4 --with-pgport=1921 --with-perl --with-tcl --with-python --with-openssl --with-pam --with-ldap --with-libxml --with-libxslt --enable-thread-safety</font></div><div><font size="2"   >.......</font></div><div><div><font size="2"   >configure: using compiler=FreeBSD clang version 3.3 (tags/RELEASE_33/final 183502) 20130610</font></div><div><font size="2"   >configure: using CFLAGS=-O2 -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv</font></div><div><font size="2"   >configure: using CPPFLAGS=-I/usr/local/include -I/usr/local/include/libxml2 -I/usr/include&nbsp;</font></div><div><font size="2"   >configure: using LDFLAGS= -L/usr/local/lib -L/usr/lib &nbsp;-Wl,--as-needed</font></div><div><font size="2"   >configure: creating ./config.status</font></div><div><font size="2"   >config.status: creating GNUmakefile</font></div><div><font size="2"   >config.status: creating src/Makefile.global</font></div><div><font size="2"   >config.status: creating src/include/pg_config.h</font></div><div><font size="2"   >config.status: creating src/include/pg_config_ext.h</font></div><div><font size="2"   >config.status: creating src/interfaces/ecpg/include/ecpg_config.h</font></div><div><font size="2"   >config.status: linking src/backend/port/tas/dummy.s to src/backend/port/tas.s</font></div><div><font size="2"   >config.status: linking src/backend/port/dynloader/freebsd.c to src/backend/port/dynloader.c</font></div><div><font size="2"   >config.status: linking src/backend/port/sysv_sema.c to src/backend/port/pg_sema.c</font></div><div><font size="2"   >config.status: linking src/backend/port/sysv_shmem.c to src/backend/port/pg_shmem.c</font></div><div><font size="2"   >config.status: linking src/backend/port/unix_latch.c to src/backend/port/pg_latch.c</font></div><div><font size="2"   >config.status: linking src/backend/port/dynloader/freebsd.h to src/include/dynloader.h</font></div><div><font size="2"   >config.status: linking src/include/port/freebsd.h to src/include/pg_config_os.h</font></div><div><font size="2"   >config.status: linking src/makefiles/Makefile.freebsd to src/Makefile.port</font></div></div><p></p></pre></div><div><br></div><div>使用gmake, 如果缺少的话, 使用pkg安装.</div><div><div style="line-height: 28px;"   ><pre class="prettyprint"   ><p></p><div><div><div><div style="line-height: 28px;"   ><font size="2"   >root@digoal:~/postgresql-9.3.4 # gmake world &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gmake: Command not found.</font></div><div style="line-height: 28px;"   ><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg search gmake</font></div><div><font size="2"   >gmake-3.82_1</font></div></div></div></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # pkg install gmake-3.82_1</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # gmake world</font></div><div><font size="2"   >...............</font></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # gmake install-world</font></div><p></p></pre></div></div></div></div><div>创建pgsql的软链接</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # ln -s /opt/pgsql9.3.4 /opt/pgsql</font></div><div></div><p></p></pre></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >配置资源限制, 参考</span></div><div><a target="_blank" rel="nofollow" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/security-resourcelimits.html"   >http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/security-resourcelimits.html</a></div><div>man login.conf</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >vi /etc/login.conf</font></div><div><div><font size="2"   >default:\&nbsp;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :passwd_format=sha512:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :copyright=/etc/COPYRIGHT:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :welcome=/etc/motd:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :setenv=MAIL=/var/mail/$,BLOCKSIZE=K:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :path=/sbin /bin /usr/sbin /usr/bin /usr/games /usr/local/sbin /usr/local/bin ~/bin:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :nologin=/var/run/nologin:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :cputime=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :datasize=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :stacksize=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :memorylocked=64K:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :memoryuse=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :filesize=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :coredumpsize=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :openfiles=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :maxproc=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :sbsize=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :vmemoryuse=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :swapuse=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :pseudoterminals=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :priority=0:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :ignoretime@:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :umask=022:</font></div></div><div><div><font size="2"   >postgres:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :openfiles=unlimited:\</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; :maxproc=unlimited:</font></div></div><p></p></pre></div><div>更新库</div><pre class="prettyprint"   ><p></p><div><font size="2"   >cap_mkdb /etc/login.conf</font></div><div></div><p></p></pre><div><span style="line-height: 28px;"   >查看当前的ulimit</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~ # su - postgres</font></div><div><font size="2"   >postgres@digoal:~ % ulimit -a</font></div><div><font size="2"   >cpu time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (seconds, -t) &nbsp;unlimited</font></div><div><font size="2"   >file size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (512-blocks, -f) &nbsp;unlimited</font></div><div><font size="2"   >data seg size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (kbytes, -d) &nbsp;33554432</font></div><div><font size="2"   >stack size &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(kbytes, -s) &nbsp;524288</font></div><div><font size="2"   >core file size &nbsp; &nbsp; &nbsp;(512-blocks, -c) &nbsp;unlimited</font></div><div><font size="2"   >max memory size &nbsp; &nbsp; &nbsp; &nbsp; (kbytes, -m) &nbsp;unlimited</font></div><div><font size="2"   >locked memory &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (kbytes, -l) &nbsp;64</font></div><div><font size="2"   >max user processes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(-u) &nbsp;6670</font></div><div><font size="2"   >open files &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(-n) &nbsp;58266</font></div><div><font size="2"   >virtual mem size &nbsp; &nbsp; &nbsp; &nbsp;(kbytes, -v) &nbsp;unlimited</font></div><div><font size="2"   >swap limit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(kbytes, -w) &nbsp;unlimited</font></div><div><font size="2"   >sbsize &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (bytes, -b) &nbsp;unlimited</font></div><div><font size="2"   >pseudo-terminals &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(-p) &nbsp;unlimited</font></div><p></p></pre></div><div><span style="line-height: 28px;"   ><br></span></div><div><span style="line-height: 28px;"   >配置内核参数,&nbsp;</span><span style="line-height: 28px;"   >参考</span></div><div><a target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.4/static/kernel-resources.html"   >http://www.postgresql.org/docs/9.4/static/kernel-resources.html</a></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # vi /etc/sysctl.conf</font></div><div><div><font size="2"   >kern.ipc.shmall=131072</font></div><div><font size="2"   >kern.ipc.shmmax=536870912</font></div><div><font size="2"   >kern.ipc.shm_use_phys=1 &nbsp; 锁定shared memory到内存</font></div></div></pre></div><div><div>生效</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # sysctl -w -f /etc/sysctl.conf</font></div><div><font size="2"   >kern.ipc.shmall: 131072 -&gt; 131072</font></div><div><font size="2"   >kern.ipc.shmmax: 536870912 -&gt; 536870912</font></div><div><font size="2"   >kern.ipc.shm_use_phys: 1 -&gt; 1</font></div><p></p></pre></div></div><div><br></div><div>修改几个启动时加载的内核参数, 这几个参数不能在sysctl.conf中动态配置.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # vi /boot/loader.conf&nbsp;</font></div><div><font size="2"   >zfs_load="YES"</font></div><div><font size="2"   >kern.ipc.semmni=256</font></div><div><font size="2"   >kern.ipc.semmns=512</font></div><div><font size="2"   >kern.ipc.semmnu=256</font></div><p></p></pre></div><div>重启freebsd</div><div>确认这几个配置已经生效.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~ # sysctl -a|grep semmni</font></div><div><font size="2"   >kern.ipc.semmni: 256</font></div><div><font size="2"   >&lt;118&gt;sysctl: oid 'kern.ipc.semmni' is a read only tunable at line 12</font></div><div><font size="2"   >&lt;118&gt;sysctl: oid 'kern.ipc.semmni' is a read only tunable at line 12</font></div><p></p></pre></div><div><br></div><div>配置防火墙,&nbsp;<span style="line-height: 28px;"   >参见</span></div><div><a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/firewalls.html"   >http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/firewalls.html</a></div><div><br></div><div>添加普通用户, 用于运行postgresql</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # adduser&nbsp;</font></div><div><font size="2"   >Username: postgres</font></div><div><font size="2"   >Full name: postgresql</font></div><div><font size="2"   >Uid (Leave empty for default):&nbsp;</font></div><div><font size="2"   >Login group [postgres]:&nbsp;</font></div><div><font size="2"   >Login group is postgres. Invite postgres into other groups? []:&nbsp;</font></div><div><font size="2"   >Login class [default]:&nbsp;</font></div><div><font size="2"   >Shell (sh csh tcsh nologin) [sh]: csh &nbsp;选择csh</font></div><div><font size="2"   >Home directory [/home/postgres]:&nbsp;</font></div><div><font size="2"   >Home directory permissions (Leave empty for default):&nbsp;</font></div><div><font size="2"   >Use password-based authentication? [yes]:&nbsp;</font></div><div><font size="2"   >Use an empty password? (yes/no) [no]:&nbsp;</font></div><div><font size="2"   >Use a random password? (yes/no) [no]:&nbsp;</font></div><div><font size="2"   >Enter password:&nbsp;</font></div><div><font size="2"   >Enter password again:&nbsp;</font></div><div><font size="2"   >Lock out the account after creation? [no]:&nbsp;</font></div><div><font size="2"   >Username &nbsp; : postgres</font></div><div><font size="2"   >Password &nbsp; : *****</font></div><div><font size="2"   >Full Name &nbsp;: postgresql</font></div><div><font size="2"   >Uid &nbsp; &nbsp; &nbsp; &nbsp;: 1001</font></div><div><font size="2"   >Class &nbsp; &nbsp; &nbsp;:&nbsp;</font></div><div><font size="2"   >Groups &nbsp; &nbsp; : postgres&nbsp;</font></div><div><font size="2"   >Home &nbsp; &nbsp; &nbsp; : /home/postgres</font></div><div><font size="2"   >Home Mode &nbsp;:&nbsp;</font></div><div><font size="2"   >Shell &nbsp; &nbsp; &nbsp;: /bin/csh</font></div><div><font size="2"   >Locked &nbsp; &nbsp; : no</font></div><div><font size="2"   >OK? (yes/no): yes</font></div><div><font size="2"   >adduser: INFO: Successfully added (postgres) to the user database.</font></div><div><font size="2"   >Add another user? (yes/no): no</font></div><div><font size="2"   >Goodbye!</font></div><p></p></pre></div><div>配置环境变量.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # su - postgres</font></div><div><font size="2"   >postgres@digoal:~ % vi .cshrc&nbsp;</font></div><div><div><font size="2"   ># $FreeBSD: release/10.0.0/share/skel/dot.cshrc 243893 2012-12-05 13:56:39Z eadler $</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># .cshrc - csh resource script, read at beginning of execution by each shell</font></div><div><font size="2"   >#</font></div><div><font size="2"   ># see also csh(1), environ(7).</font></div><div><font size="2"   ># more examples available at /usr/share/examples/csh/</font></div><div><font size="2"   >#</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >alias h &nbsp; &nbsp; &nbsp; &nbsp; history 25</font></div><div><font size="2"   >alias j &nbsp; &nbsp; &nbsp; &nbsp; jobs -l</font></div><div><font size="2"   >alias la &nbsp; &nbsp; &nbsp; &nbsp;ls -aF</font></div><div><font size="2"   >alias lf &nbsp; &nbsp; &nbsp; &nbsp;ls -FA</font></div><div><font size="2"   >alias ll &nbsp; &nbsp; &nbsp; &nbsp;ls -lAF</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># A righteous umask</font></div><div><font size="2"   >umask 22</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><span style="line-height: 21px;"   >set path = (/opt/pgsql/bin /sbin /bin /usr/sbin /usr/bin /usr/games /usr/local/sbin /usr/local/bin $HOME/bin)<br>setenv PGHOME /opt/pgsql <br>setenv LD_LIBRARY_PATH /opt/pgsql/lib<br>setenv PGDATA /home/postgres/pg_root<br>setenv PGHOST $PGDATA<br>setenv PGPORT 1921<br>setenv PGUSER postgres<br>setenv PGDATABASE postgres</span></font></div><div><font size="2"   ><span style="line-height: 21px;"   >setenv MANPATH $PGHOME/share/man</span></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >setenv &nbsp;EDITOR &nbsp;vi</font></div><div><font size="2"   >setenv &nbsp;PAGER &nbsp; more</font></div><div><font size="2"   >setenv &nbsp;BLOCKSIZE &nbsp; &nbsp; &nbsp; K</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >if ($?prompt) then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # An interactive shell -- set some stuff up</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set prompt = "%N@%m:%~ %# "</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set promptchars = "%#"</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set filec</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set history = 1000</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set savehist = (1000 merge)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set autolist = ambiguous</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; # Use history to aid expansion</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set autoexpand</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set autorehash</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; set mail = (/var/mail/$USER)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; if ( $?tcsh ) then</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bindkey "^W" backward-delete-word</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bindkey -k up history-search-backward</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bindkey -k down history-search-forward</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; endif</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >endif</font></div></div><p></p></pre></div><div>重新登录csh, 确认环境变量已经生效.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@digoal:~ % exit</font></div><div><font size="2"   >logout</font></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4 # su - postgres</font></div><div><font size="2"   >postgres@digoal:~ % psql -V</font></div><div><font size="2"   >psql (PostgreSQL) 9.3.4</font></div><div><font size="2"   >postgres@digoal:~ % which psql</font></div><div><font size="2"   >/opt/pgsql/bin/psql</font></div><p></p></pre></div><div>初始化数据库集群</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@digoal:~ % initdb -D $PGDATA -U postgres -E UTF8 --locale=C -W</font></div><div><font size="2"   >The files belonging to this database system will be owned by user "postgres".</font></div><div><font size="2"   >This user must also own the server process.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >The database cluster will be initialized with locale "C".</font></div><div><font size="2"   >The default text search configuration will be set to "english".</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Data page checksums are disabled.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >creating directory /home/postgres/pg_root ... ok</font></div><div><font size="2"   >creating subdirectories ... ok</font></div><div><font size="2"   >selecting default max_connections ... 100</font></div><div><font size="2"   >selecting default shared_buffers ... 128MB</font></div><div><font size="2"   >creating configuration files ... ok</font></div><div><font size="2"   >creating template1 database in /home/postgres/pg_root/base/1 ... ok</font></div><div><font size="2"   >initializing pg_authid ... ok</font></div><div><font size="2"   >Enter new superuser password:&nbsp;</font></div><div><font size="2"   >Enter it again:&nbsp;</font></div><div><font size="2"   >setting password ... ok</font></div><div><font size="2"   >initializing dependencies ... ok</font></div><div><font size="2"   >creating system views ... ok</font></div><div><font size="2"   >loading system objects' descriptions ... ok</font></div><div><font size="2"   >creating collations ... ok</font></div><div><font size="2"   >creating conversions ... ok</font></div><div><font size="2"   >creating dictionaries ... ok</font></div><div><font size="2"   >setting privileges on built-in objects ... ok</font></div><div><font size="2"   >creating information schema ... ok</font></div><div><font size="2"   >loading PL/pgSQL server-side language ... ok</font></div><div><font size="2"   >vacuuming database template1 ... ok</font></div><div><font size="2"   >copying template1 to template0 ... ok</font></div><div><font size="2"   >copying template1 to postgres ... ok</font></div><div><font size="2"   >syncing data to disk ... ok</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >WARNING: enabling "trust" authentication for local connections</font></div><div><font size="2"   >You can change this by editing pg_hba.conf or using the option -A, or</font></div><div><font size="2"   >--auth-local and --auth-host, the next time you run initdb.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Success. You can now start the database server using:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; postgres -D /home/postgres/pg_root</font></div><div><font size="2"   >or</font></div><div><font size="2"   >&nbsp; &nbsp; pg_ctl -D /home/postgres/pg_root -l logfile start</font></div><p></p></pre></div><div>配置数据库参考</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >cd $PGDATA</font></div><div><font size="2"   >vi postgresql.conf</font></div><div><div><font size="2"   >listen_addresses = '0.0.0.0' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# what IP address(es) to listen on;</font></div><div><font size="2"   >port = 1921 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >max_connections = 100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >superuser_reserved_connections = 13 &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >unix_socket_directories = '.' &nbsp; # comma-separated list of directories</font></div><div><font size="2"   >unix_socket_permissions = 0700 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# begin with 0 to use octal notation</font></div><div><font size="2"   >tcp_keepalives_idle = 60 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPIDLE, in seconds;</font></div><div><font size="2"   >tcp_keepalives_interval = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# TCP_KEEPINTVL, in seconds;</font></div><div><font size="2"   >tcp_keepalives_count = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # TCP_KEEPCNT;</font></div><div><font size="2"   >shared_buffers = 128MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# min 128kB</font></div><div><font size="2"   >maintenance_work_mem = 128MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# min 1MB</font></div><div><font size="2"   >shared_preload_libraries = 'pg_stat_statements' &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)</font></div><div><font size="2"   >vacuum_cost_delay = 10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# 0-100 milliseconds</font></div><div><font size="2"   >vacuum_cost_limit = 10000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 credits</font></div><div><font size="2"   >bgwriter_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # 10-10000ms between rounds</font></div><div><font size="2"   >wal_level = hot_standby &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # minimal, archive, or hot_standby</font></div><div><font size="2"   >synchronous_commit = off &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# synchronization level;</font></div><div><font size="2"   >wal_buffers = 16384kB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # min 32kB, -1 sets based on shared_buffers</font></div><div><font size="2"   >wal_writer_delay = 10ms &nbsp; &nbsp; &nbsp; &nbsp; # 1-10000 milliseconds</font></div><div><font size="2"   >checkpoint_segments = 8 &nbsp; &nbsp; &nbsp; &nbsp; # in logfile segments, min 1, 16MB each</font></div><div><font size="2"   >archive_mode = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # allows archiving to be done</font></div><div><font size="2"   >archive_command = '/bin/date' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # command to use to archive a logfile segment</font></div><div><font size="2"   >max_wal_senders = 8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # max number of walsender processes</font></div><div><font size="2"   >wal_keep_segments = 32 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# in logfile segments, 16MB each; 0 disables</font></div><div><font size="2"   >hot_standby = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# "on" allows queries during recovery</font></div><div><font size="2"   >max_standby_archive_delay = 300s &nbsp; &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >max_standby_streaming_delay = 300s &nbsp; &nbsp; &nbsp;# max delay before canceling queries</font></div><div><font size="2"   >wal_receiver_status_interval = 1s &nbsp; &nbsp; &nbsp; # send replies at least this often</font></div><div><font size="2"   >hot_standby_feedback = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # send info from standby to prevent</font></div><div><font size="2"   >effective_cache_size = 2048MB</font></div><div><font size="2"   >log_destination = 'csvlog' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Valid values are combinations of</font></div><div><font size="2"   >logging_collector = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Enable capturing of stderr and csvlog</font></div><div><font size="2"   >log_directory = 'pg_log' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# directory where log files are written,</font></div><div><font size="2"   >log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # log file name pattern,</font></div><div><font size="2"   >log_file_mode = 0600 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# creation mode for log files,</font></div><div><font size="2"   >log_truncate_on_rotation = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # If on, an existing log file with the</font></div><div><font size="2"   >log_rotation_age = 1d &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Automatic rotation of logfiles will</font></div><div><font size="2"   >log_rotation_size = 10MB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# Automatic rotation of logfiles will</font></div><div><font size="2"   >log_checkpoints = on</font></div><div><font size="2"   >log_connections = on</font></div><div><font size="2"   >log_disconnections = on</font></div><div><font size="2"   >log_error_verbosity = verbose &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # terse, default, or verbose messages</font></div><div><font size="2"   >log_lock_waits = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # log lock waits &gt;= deadlock_timeout</font></div><div><font size="2"   >log_statement = 'ddl' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # none, ddl, mod, all</font></div><div><font size="2"   >log_timezone = 'PRC'</font></div><div><font size="2"   >autovacuum = on &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Enable autovacuum subprocess? &nbsp;'on'</font></div><div><font size="2"   >log_autovacuum_min_duration = 0 # -1 disables, 0 logs all actions and</font></div><div><font size="2"   >datestyle = 'iso, mdy'</font></div><div><font size="2"   >timezone = 'PRC'</font></div><div><font size="2"   >lc_messages = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for system error message</font></div><div><font size="2"   >lc_monetary = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for monetary formatting</font></div><div><font size="2"   >lc_numeric = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# locale for number formatting</font></div><div><font size="2"   >lc_time = 'C' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # locale for time formatting</font></div><div><font size="2"   >default_text_search_config = 'pg_catalog.english'</font></div><div><font size="2"   >pg_stat_statements.max=1000</font></div><div><font size="2"   >pg_stat_statements.track=all</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >vi pg_hba.conf</font></div><div><font size="2"   >host all all 0.0.0.0/0 md5</font></div><p></p></pre></div><div><br></div><div>启动数据库</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >pg_ctl start</font></div><div></div><p></p></pre></div><div>测试</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >postgres@digoal:~/pg_root % psql</font></div><div><font size="2"   >psql (9.3.4)</font></div><div><font size="2"   >Type "help" for help.</font></div><div><font size="2"   >No relations found.</font></div><div><font size="2"   >postgres=# create extension pg_stat_statements;</font></div><div><font size="2"   >CREATE EXTENSION</font></div><p></p></pre></div><div><br></div><div><pre class="prettyprint"   ><p></p><div><div><font size="2"   >postgres@digoal:~ % pg_test_fsync&nbsp;</font></div><div><font size="2"   >5 seconds per test</font></div><div><font size="2"   >O_DIRECT supported on this platform for open_datasync and open_sync.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using one 8kB write:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 797.551 ops/sec &nbsp; &nbsp;1254 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 790.158 ops/sec &nbsp; &nbsp;1266 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare file sync methods using two 8kB writes:</font></div><div><font size="2"   >(in wal_sync_method preference order, except fdatasync</font></div><div><font size="2"   >is Linux's default)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_datasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fdatasync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 687.398 ops/sec &nbsp; &nbsp;1455 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; fsync_writethrough &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;n/a</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; open_sync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 380.333 ops/sec &nbsp; &nbsp;2629 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Compare open_sync with different write sizes:</font></div><div><font size="2"   >(This is designed to compare the cost of writing 16kB</font></div><div><font size="2"   >in different write open_sync sizes.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 * 16kB open_sync write &nbsp; &nbsp; &nbsp; &nbsp; 667.113 ops/sec &nbsp; &nbsp;1499 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 * &nbsp;8kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp;351.775 ops/sec &nbsp; &nbsp;2843 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 * &nbsp;4kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp;188.157 ops/sec &nbsp; &nbsp;5315 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8 * &nbsp;2kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp;140.643 ops/sec &nbsp; &nbsp;7110 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; 16 * &nbsp;1kB open_sync writes &nbsp; &nbsp; &nbsp; &nbsp; 70.435 ops/sec &nbsp; 14197 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Test if fsync on non-write file descriptor is honored:</font></div><div><font size="2"   >(If the times are similar, fsync() can sync data written</font></div><div><font size="2"   >on a different descriptor.)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, fsync, close &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1008.429 ops/sec &nbsp; &nbsp; 992 usecs/op</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write, close, fsync &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 898.560 ops/sec &nbsp; &nbsp;1113 usecs/op</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Non-Sync'ed 8kB writes:</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 23133.137 ops/sec &nbsp; &nbsp; &nbsp;43 usecs/op</font></div></div><div><font size="2"   ><br></font></div><div><div><font size="2"   >postgres@digoal:~ % pg_test_timing&nbsp;</font></div><div><font size="2"   >Testing timing overhead for 3 seconds.</font></div><div><font size="2"   >Per loop time including overhead: 133.81 nsec</font></div><div><font size="2"   >Histogram of timing durations:</font></div><div><font size="2"   >&lt; usec &nbsp; % of total &nbsp; &nbsp; &nbsp;count</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; 88.20078 &nbsp; 19774833</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;2 &nbsp; &nbsp; 11.76991 &nbsp; &nbsp;2638844</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;4 &nbsp; &nbsp; &nbsp;0.00075 &nbsp; &nbsp; &nbsp; &nbsp;168</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;8 &nbsp; &nbsp; &nbsp;0.00012 &nbsp; &nbsp; &nbsp; &nbsp; 28</font></div><div><font size="2"   >&nbsp; &nbsp; 16 &nbsp; &nbsp; &nbsp;0.00105 &nbsp; &nbsp; &nbsp; &nbsp;235</font></div><div><font size="2"   >&nbsp; &nbsp; 32 &nbsp; &nbsp; &nbsp;0.01878 &nbsp; &nbsp; &nbsp; 4211</font></div><div><font size="2"   >&nbsp; &nbsp; 64 &nbsp; &nbsp; &nbsp;0.00507 &nbsp; &nbsp; &nbsp; 1137</font></div><div><font size="2"   >&nbsp; &nbsp;128 &nbsp; &nbsp; &nbsp;0.00204 &nbsp; &nbsp; &nbsp; &nbsp;458</font></div><div><font size="2"   >&nbsp; &nbsp;256 &nbsp; &nbsp; &nbsp;0.00075 &nbsp; &nbsp; &nbsp; &nbsp;168</font></div><div><font size="2"   >&nbsp; &nbsp;512 &nbsp; &nbsp; &nbsp;0.00039 &nbsp; &nbsp; &nbsp; &nbsp; 88</font></div><div><font size="2"   >&nbsp; 1024 &nbsp; &nbsp; &nbsp;0.00017 &nbsp; &nbsp; &nbsp; &nbsp; 37</font></div><div><font size="2"   >&nbsp; 2048 &nbsp; &nbsp; &nbsp;0.00012 &nbsp; &nbsp; &nbsp; &nbsp; 26</font></div><div><font size="2"   >&nbsp; 4096 &nbsp; &nbsp; &nbsp;0.00004 &nbsp; &nbsp; &nbsp; &nbsp; 10</font></div><div><font size="2"   >&nbsp; 8192 &nbsp; &nbsp; &nbsp;0.00002 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4</font></div></div><p></p></pre></div><div><br></div><div>安装pgfincore, 报错, 暂未解决.</div><div>可能freebsd 10的libc版本太老.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >http://git.postgresql.org/gitweb/?p=pgfincore.git;a=snapshot;h=0c891865d0e3777faafadb2fe3d84748b3a77d87;sf=tgz</font></div><div><font size="2"   >root@digoal:~ # pkg install lrzsz-0.12.20_4</font></div><div><font size="2"   >root@digoal:~ # lrz</font></div><div><font size="2"   ># tar -zxvf pgfincore-0c89186.tar.gz</font></div><div><font size="2"   >#&nbsp;mv pgfincore-0c89186 postgresql-9.3.4/contrib/</font></div><div><div><font size="2"   >root@digoal:~ # mv pgfincore-0c89186 postgresql-9.3.4/contrib/</font></div><div><font size="2"   >root@digoal:~ # cd postgresql-9.3.4/contrib/pgfincore-0c89186/</font></div></div><div><div><font size="2"   >root@digoal:~/postgresql-9.3.4/contrib/pgfincore-0c89186 # set path = (/opt/pgsql/bin /sbin /bin /usr/sbin /usr/bin /usr/games /usr/local/sbin /usr/local/bin $HOME/bin)</font></div><div><font size="2"   >root@digoal:~/postgresql-9.3.4/contrib/pgfincore-0c89186 # which pg_config</font></div><div><font size="2"   >/opt/pgsql/bin/pg_config</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >gmake uninstall</font></div><div><font size="2"   >gmake</font></div><div><div><font size="2"   >In file included from pgfincore.c:18:</font></div><div><font size="2"   >./fincore.h:10:30: error: unknown type name 'loff_t'; did you mean 'off_t'?</font></div><div><font size="2"   >int fincore(unsigned int fd, loff_t start, loff_t len, unsigned char * vec);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^~~~~~</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off_t</font></div><div><font size="2"   >/usr/include/sys/stat.h:86:18: note: 'off_t' declared here</font></div><div><font size="2"   >typedef __off_t &nbsp; &nbsp; &nbsp; &nbsp; off_t;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   >In file included from pgfincore.c:18:</font></div><div><font size="2"   >./fincore.h:10:44: error: unknown type name 'loff_t'; did you mean 'off_t'?</font></div><div><font size="2"   >int fincore(unsigned int fd, loff_t start, loff_t len, unsigned char * vec);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^~~~~~</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off_t</font></div><div><font size="2"   >/usr/include/sys/stat.h:86:18: note: 'off_t' declared here</font></div><div><font size="2"   >typedef __off_t &nbsp; &nbsp; &nbsp; &nbsp; off_t;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   >In file included from pgfincore.c:18:</font></div><div><font size="2"   >./fincore.h:12:30: error: unknown type name 'loff_t'; did you mean 'off_t'?</font></div><div><font size="2"   >int fincore(unsigned int fd, loff_t start, loff_t len, unsigned char * vec)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^~~~~~</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off_t</font></div><div><font size="2"   >/usr/include/sys/stat.h:86:18: note: 'off_t' declared here</font></div><div><font size="2"   >typedef __off_t &nbsp; &nbsp; &nbsp; &nbsp; off_t;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   >In file included from pgfincore.c:18:</font></div><div><font size="2"   >./fincore.h:12:44: error: unknown type name 'loff_t'; did you mean 'off_t'?</font></div><div><font size="2"   >int fincore(unsigned int fd, loff_t start, loff_t len, unsigned char * vec)</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^~~~~~</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;off_t</font></div><div><font size="2"   >/usr/include/sys/stat.h:86:18: note: 'off_t' declared here</font></div><div><font size="2"   >typedef __off_t &nbsp; &nbsp; &nbsp; &nbsp; off_t;</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   >In file included from pgfincore.c:18:</font></div><div><font size="2"   >./fincore.h:14:10: warning: implicit declaration of function 'syscall' is invalid in C99 [-Wimplicit-function-declaration]</font></div><div><font size="2"   >&nbsp; return syscall(__NR_fincore, fd, start, len, vec);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >pgfincore.c:245:36: error: use of undeclared identifier '_SC_AVPHYS_PAGES'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; values[1] = Int64GetDatum(sysconf(_SC_AVPHYS_PAGES));</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   >/opt/pgsql9.3.4/include/server/postgres.h:555:47: note: expanded from macro 'Int64GetDatum'</font></div><div><font size="2"   >#define Int64GetDatum(X) ((Datum) SET_8_BYTES(X))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   >/opt/pgsql9.3.4/include/server/postgres.h:318:38: note: expanded from macro 'SET_8_BYTES'</font></div><div><font size="2"   >#define SET_8_BYTES(value) &nbsp; &nbsp; &nbsp;((Datum) (value))</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   >pgfincore.c:353:29: error: use of undeclared identifier '_SC_AVPHYS_PAGES'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; pgfdv-&gt;pagesFree = sysconf(_SC_AVPHYS_PAGES);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >pgfincore.c:634:33: error: use of undeclared identifier '_SC_AVPHYS_PAGES'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; pgfloader-&gt;pagesFree = sysconf(_SC_AVPHYS_PAGES);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^</font></div><div><font size="2"   >pgfincore.c:951:30: error: use of undeclared identifier '_SC_AVPHYS_PAGES'</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; pgfncr-&gt;pagesFree = sysconf(_SC_AVPHYS_PAGES);</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^</font></div><div><font size="2"   >1 warning and 8 errors generated.</font></div><div><font size="2"   >gmake: *** [pgfincore.o] Error 1</font></div></div><p></p></pre></div><div>查过man &nbsp;sysconf后, 发现这里的identifier确实没有_SC_AVPHYS_PAGES.</div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >_SC_AVPHYS_PAGES</font></div><div><font size="2"   >只有</font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp;_SC_PAGESIZE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The size of a system page in bytes.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp;_SC_PAGE_SIZE</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Equivalent to _SC_PAGESIZE.</font></div></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp;_SC_PHYS_PAGES</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The number of pages of physical memory. &nbsp;Note that it is possible</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;that the product of this value and the value of _SC_PAGESIZE will</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;overflow a long in some configurations on a 32bit machine.</font></div></div><div><font size="2"   ><br></font></div><div><font size="2"   >在CentOS 6.x中当然有这个定义</font></div><div><font size="2"   >man sysconf</font></div><div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; - _SC_AVPHYS_PAGES</font></div><div><font size="2"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The number of currently available pages of physical memory.</font></div></div><div><font size="2"   >在opensolaris中也有这个定义</font></div><div><font size="2"   >man sysconf</font></div><p></p></pre></div><div><br></div><div>或者玩一下opensolaris (or illumos now), 不过oracle关闭了opensolaris, 现已由illumos社区继承.</div><div><a target="_blank" rel="nofollow" href="http://blog.illumos.org/about-illumos-2/"   >http://blog.illumos.org/about-illumos-2/</a></div><div><a target="_blank" rel="nofollow" href="http://wiki.illumos.org/display/illumos/Distributions"   >http://wiki.illumos.org/display/illumos/Distributions</a></div><div>This is the home of the illumos project, the open source fork of Sun's OpenSolaris. Launched in 2010, the project enjoys financial and technical support from several key companies which rely on the illumos kernel as the technological foundation for their own products, as well as the backing of a growing developer community.</div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/firewalls.html"   >http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/firewalls.html</a></div><div>2.&nbsp;<a style="line-height: 28px;" target="_blank" href="http://blog.163.com/digoal@126/blog/static/16387704020145114251585/"   >http://blog.163.com/digoal@126/blog/static/16387704020145114251585/</a></div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.postgresql.org/docs/9.4/static/kernel-resources.html"   >http://www.postgresql.org/docs/9.4/static/kernel-resources.html</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/security-resourcelimits.html"   >http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/security-resourcelimits.html</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://wiki.illumos.org/display/illumos/Distributions"   >http://wiki.illumos.org/display/illumos/Distributions</a></div><div>6. man login.conf</div><div>7.&nbsp;<span style="line-height: 28px;"   >man &nbsp;sysconf</span></div><div><span style="line-height: 28px;"   >8. freebsd的一些基本操作, 收集自互联网.</span></div><div><pre class="prettyprint"   ><p></p><div><font size="2"   >Step 1 FreeBSD下安装软件包</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >・pkg_add方式安装软件包。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >・Ports方式安装软件包。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >・源代码方式安装软件包。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >跟随下面步骤进行远程软件包的安装.</font></div><div><font size="2"   >FreeBSD下可以使用多种方法安装软件包，即可以使用pkg_add方式安装，也可以使用Ports方式安装，还可以下程序源码进行编译安装。不同的安装方式有不向的特点，有的省时间、快速；有点定制性高可以根据自己需要进行选择。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pkg_add方式安装</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pkg_add方式安装方法1、用户预先下载编译好的需要进行安装的软件包，一般是*.tbz 和*.tgz格式的软件包。直接使用pkg_add+软件包名称，安装即可。可以使用-v参数显示安装过程。源程序可以从各大FTP站点(比如ftp://ftp.FreeBSD.org/pub/FreeBSD/ports/packages/)或各发行光盘中找到。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pkg_add+软件包名称安装。此处以安装lsof-4.79D.tbz为例</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >下载并显示lsof-4.79D.tbz软件包</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >进行安装pkg_add -v lsof-4.79D.tbz (参数-v显示安装过程信息)，安装完成可以输入rehash刷新。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pkg_add方式安装方法2、用户不需要下载软件包，直接在安装时输入pkg_add -r和软件包的名称，系统将自动查找并下载、安装软件包(参数-r的作用是，使系统自动决定软件包的版本，格式并进行下载软件安装)。用户设定PACKAGESITE</font></div><div><font size="2"   >这个环境变量，选择距离最近的FTP服务器，可以加速下载安装过程。在上一篇的用户shell中PACKAGESITE</font></div><div><font size="2"   >这个环境变量，此处不再设定。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >pkg_add是在freebsd里面用来通过package安装软件一个命令，而-r 则是说本地没有package包，安装时自动从网上下载。默认的站点一般如:</font></div><div><font size="2"   >ftp://ftp.freebsd.org/pub/FreeBSD/ports/i386/packages-6.1-release/All/</font></div><div><font size="2"   >这样的格式，访问国外的服务器一般比国内的要慢很多，特别是现在正值海底光纤就震断之际，国外网站更是难以访问。所以非常有必要修改这个默认ftp站点，所以就要设置PACKAGESITE这个环境变量</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >在csh shell里这样改:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >#setenv PACKAGESITE ftp://ftp.freebsd.org.cn/pub/FreeBSD/ports/i386/packages-6.1-release/All/</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >注意在不同的shell里设置环境变量的方法是不同的，在不同的shell运行这个，不会提示错误，但设置后也没有效果的。</font></div><div><font size="2"   >在sh shell里这样改:</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ># export PACKAGESITE=ftp://ftp.freebsd.org.cn /pub/FreeBSD/ports/i386/packages-6.1-release/All/</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >好了现在通过pkg_add -r 来安装软件下载快得多了！</font></div><div><font size="2"   >pkg_add -r+软件包名称安装(系统自动解决依赖关系)。此处以安装wget为例</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >不需要指定版本及格式，直接输入安装命令pkg_add -r wget即可。系统会自动连接服务器进行下载，并且自动解决依赖关系。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >使用Ports方式安装软件包</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Ports中进入软件包名称安装目录，执行make install clean进行安装(系统自动解决依赖关系) Ports安装命令总结</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >make install ：安b所选定的 Port</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >make deinstall ：移除已安b的 Port</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >make reinstall ：移除之后再安b一次</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >make clean ：安b完毕后移除 make Y料A下的档案</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >make distclean ：移除安b后的原始档案，以节省磁碟空间</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >make rmconfig ：移除之前安b过程中选项的O定</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >使用源代码进行安装程序</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >以Apache22为例(假设安装路径为/usr/local/apache22)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp;下载Apache22的talball可以使用wget在FreeBSD下载，也可以在Win下载完成再传到FreeBSD机器上。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >解包并指定安装路径，进行配置，安装</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >--prefix : O定 Apache httpd 安b路径</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >--enable-so : 告V Apache 启动 so 模M, 让 Apache 能够载入 shared modules(例如 PHP)</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >&nbsp;启动Apache22进行测试</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >浏览器打开http://youipaddress</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >好了，Apache22安装成功了。</font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   ><br></font></div><div><font size="2"   >Step 2 FreeBSD下的下载程序.</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >FreeBSD中安装下载程序axel和wget:</font></div><div><font size="2"   >安装axel程序</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >可以使用任意方法安装，如pkg_add或者Ports方式安装。这里使用pkg_add -r axel命令安装</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >axel程序的使用，axel+要下载的文件的url</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >安装wget程序</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >使用Ports方式安装，查找到wget所在目录，进入目录，执行make install clean</font></div><div><font size="2"   ><br></font></div><div><font size="2"   >使用方式和axel基本一样。wget+下载的程序名称的url</font></div><p></p></pre></div><div><br></div></div>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="PostgreSQL installed in FreeBSD - 德哥@Digoal - PostgreSQL"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">wl515639488@126 - 2014-06-24 9:45:10</h5>
				<div>为毛不用&nbsp;<div>cd&nbsp;/usr/ports/databases/postgresql93-server</div><div>make install clean.....</div><div>系统自己搞定依赖</div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 wl515639488@126 - 2014-06-24 9:45:10</h5>
				<div style="width:600px;">不fashion</div>
			</div>
	</div>
</div>
</body>
</html>