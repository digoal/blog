<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">RHEL 7 Technology Preview - lvm cache like zfs l2arc, bcache, flashcache</h2>
	<h5 id="">2014-07-09 10:46:35&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014699041427/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div>zfs l2arc不回写, 不存储脏数据. LVM cache会不会回写(会, 因为默认是writeback的, 显然是可以回写的, 所以LVM和flashcache类似, 性能应该很好)? LVM cache能否达到flashcache的性能?</div><div>同时lvm还支持多个ssd设备mirror.</div><div><br></div><div>LVM Cache</div><div><br></div><div>Red Hat Enterprise Linux 7 introduces LVM cache as a Technology Preview. This feature allows users to create logical volumes with a small fast device performing as a cache to larger slower devices. Please refer to the lvm(8) manual page for information on creating cache logical volumes.</div><div>Note that the following commands are not currently allowed on cache logical volumes:</div><div>pvmove: will skip over any cache logical volume;</div><div>lvresize, lvreduce, lvextend: cache logical volumes cannot be resized currently;</div><div>vgsplit: splitting a volume group is not allowed when cache logical volumes exist in it.</div><div><br></div><div><br></div><div><div>Fast Block Devices Caching Slower Block Devices</div><div><br></div><div>LVM provides the ability to have fast block devices act as a cache for slower block devices. This feature is introduced as a Technology Preview in Red Hat Enterprise Linux 7 and allows a PCIe SSD device to act as a cache for direct-attached storage (DAS) or storage area network (SAN) storage, which improves file system performance.</div><div>For more information, refer to the LVM Cache entry in Chapter 3, Storage and the lvm(8) manual page.</div></div><div><br></div><div>man lvm</div><div><div>LVM(8) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; System Manager's Manual &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LVM(8)</div><div><br></div><div>NAME</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvm - LVM2 tools</div><div><br></div><div>SYNOPSIS</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvm [command | file]</div><div><br></div><div>DESCRIPTION</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvm provides the command-line tools for LVM2. &nbsp;A separate manual page describes each command in detail.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;If &nbsp;lvm is invoked with no arguments it presents a readline prompt (assuming it was compiled with readline support). &nbsp;LVM</div><div>&nbsp; &nbsp; &nbsp; &nbsp;commands may be entered interactively at this prompt with readline facilities including &nbsp;history &nbsp;and &nbsp;command &nbsp;name &nbsp;and</div><div>&nbsp; &nbsp; &nbsp; &nbsp;option completion. &nbsp;Refer to readline(3) for details.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;If &nbsp;lvm &nbsp;is &nbsp;invoked with argv[0] set to the name of a specific LVM command (for example by using a hard or soft link) it</div><div>&nbsp; &nbsp; &nbsp; &nbsp;acts as that command.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;On invocation, lvm requires that only the standard file descriptors stdin, stdout and stderr are &nbsp;available. &nbsp; If &nbsp;others</div><div>&nbsp; &nbsp; &nbsp; &nbsp;are found, they get closed and messages are issued warning about the leak. &nbsp;This warning can be suppressed by setting the</div><div>&nbsp; &nbsp; &nbsp; &nbsp;environment variable LVM_SUPPRESS_FD_WARNINGS.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Where commands take VG or LV names as arguments, the full path name is optional. &nbsp;An LV called "lvol0" &nbsp;in &nbsp;a &nbsp;VG &nbsp;called</div><div>&nbsp; &nbsp; &nbsp; &nbsp;"vg0" can be specified as "vg0/lvol0". &nbsp;Where a list of VGs is required but is left empty, a list of all VGs will be sub\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;stituted. &nbsp;Where a list of LVs is required but a VG is given, a list of all the LVs in that VG will be &nbsp;substituted. &nbsp; So</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvdisplay vg0 will display all the LVs in "vg0". &nbsp;Tags can also be used - see --addtag below.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;One advantage of using the built-in shell is that configuration information gets cached internally between commands.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;A &nbsp;file &nbsp;containing a simple script with one command per line can also be given on the command line. &nbsp;The script can also</div><div>&nbsp; &nbsp; &nbsp; &nbsp;be executed directly if the first line is #! followed by the absolute path of lvm.</div><div><br></div><div>BUILT-IN COMMANDS</div><div>&nbsp; &nbsp; &nbsp; &nbsp;The following commands are built into lvm without links normally being created in the filesystem for them.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;dumpconfig ― Display the configuration information after</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loading lvm.conf(5) and any other configuration files.</div></div><div><br></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp;devtypes ― Display the recognised built-in block device types.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;formats ― Display recognised metadata formats.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;help ― Display the help text.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvdata ― Not implemented in LVM2.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;segtypes ― Display recognised Logical Volume segment types.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;tags ― Display any tags defined on this host.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;version ― Display version information.</div><div><br></div><div>COMMANDS</div><div>&nbsp; &nbsp; &nbsp; &nbsp;The following commands implement the core LVM functionality.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvchange ― Change attributes of a Physical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvck ― Check Physical Volume metadata.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvcreate ― Initialize a disk or partition for use by LVM.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvdisplay ― Display attributes of a Physical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvmove ― Move Physical Extents.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvremove ― Remove a Physical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvresize ― Resize a disk or partition in use by LVM2.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvs ― Report information about Physical Volumes.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvscan ― Scan all disks for Physical Volumes.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgcfgbackup ― Backup Volume Group descriptor area.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgcfgrestore ― Restore Volume Group descriptor area.</div></div><div><br></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgchange ― Change attributes of a Volume Group.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgck ― Check Volume Group metadata.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgconvert ― Convert Volume Group metadata format.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgcreate ― Create a Volume Group.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgdisplay ― Display attributes of Volume Groups.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgexport ― Make volume Groups unknown to the system.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgextend ― Add Physical Volumes to a Volume Group.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgimport ― Make exported Volume Groups known to the system.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgimportclone ― Import and rename duplicated Volume Group (e.g. a hardware snapshot).</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgmerge ― Merge two Volume Groups.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgmknodes ― Recreate Volume Group directory and Logical Volume special files</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgreduce ― Reduce a Volume Group by removing one or more</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Physical Volumes.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgremove ― Remove a Volume Group.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgrename ― Rename a Volume Group.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgs ― Report information about Volume Groups.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgscan ― Scan all disks for Volume Groups and rebuild caches.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgsplit ― Split a Volume Group into two, moving any logical</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; volumes from one Volume Group to another by moving entire Physical Volumes.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvchange ― Change attributes of a Logical Volume.</div></div><div><br></div><div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvconvert ― Convert a Logical Volume from linear to mirror or snapshot.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvcreate ― Create a Logical Volume in an existing Volume Group.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvdisplay ― Display attributes of a Logical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvextend ― Extend the size of a Logical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvmchange ― Change attributes of the Logical Volume Manager.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvmdiskscan ― Scan for all devices visible to LVM2.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvmdump ― Create lvm2 information dumps for diagnostic purposes.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvreduce ― Reduce the size of a Logical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvremove ― Remove a Logical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvrename ― Rename a Logical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvresize ― Resize a Logical Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvs ― Report information about Logical Volumes.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvscan ― Scan (all disks) for Logical Volumes.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;The following commands are not implemented in LVM2 but might be in the future: lvmsadc, lvmsar, pvdata.</div><div><br></div><div>OPTIONS</div><div>&nbsp; &nbsp; &nbsp; &nbsp;The following options are available for many of the commands. &nbsp;They &nbsp;are &nbsp;implemented &nbsp;generically &nbsp;and &nbsp;documented &nbsp;here</div><div>&nbsp; &nbsp; &nbsp; &nbsp;rather than repeated on individual manual pages.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;-h, -?, --help</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display the help text.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--version</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Display version information.</div></div><div><br></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp;-v, --verbose</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set &nbsp;verbose &nbsp;level. Repeat from 1 to 3 times to increase the detail of messages sent to stdout and stderr. &nbsp;Over\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rides config file setting.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;-d, --debug</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Set debug level. Repeat from 1 to 6 times to increase the detail of messages sent to the log &nbsp;file &nbsp;and/or &nbsp;syslog</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (if configured). &nbsp;Overrides config file setting.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;-q, --quiet</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Suppress output and log messages. &nbsp;Overrides -d and -v.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--yes &nbsp;Don't prompt for confirmation interactively but instead always assume the answer is 'yes'. &nbsp;Take great care if you</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; use this!</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;-t, --test</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Run in test mode. Commands will not update metadata. &nbsp;This is implemented by disabling all &nbsp;metadata &nbsp;writing &nbsp;but</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nevertheless &nbsp;returning &nbsp;success &nbsp;to the calling function. &nbsp;This may lead to unusual error messages in multi-stage</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; operations if a tool relies on reading back metadata it believes has changed but hasn't.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--driverloaded {y|n}</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Whether or not the device-mapper kernel driver is loaded. &nbsp;If you set this to n, no attempt will be made &nbsp;to &nbsp;con\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tact the driver.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;-A, --autobackup {y|n}</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Whether or not to metadata should be backed up automatically after a change. &nbsp;You are strongly advised not to dis\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; able this! &nbsp;See vgcfgbackup(8).</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;-P, --partial</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; When set, the tools will do their best to provide access to Volume Groups that are only partially &nbsp;available &nbsp;(one</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; or more Physical Volumes belonging to the Volume Group are missing from the system). &nbsp;Where part of a logical vol\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ume is missing, /dev/ioerror will be substituted, and you could use dmsetup(8) to set this up to return I/O errors</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; when &nbsp;accessed, &nbsp;or &nbsp;create it as a large block device of nulls. &nbsp;Metadata may not be changed with this option. To</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; insert a replacement Physical Volume of the same or large size use pvcreate -u to set the uuid to match the origi\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nal followed by vgcfgrestore(8).</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;-M, --metadatatype Type</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Specifies &nbsp;which type of on-disk metadata to use, such as lvm1 or lvm2, which can be abbreviated to 1 or 2 respec\</div></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tively. &nbsp;The default (lvm2) can be changed by setting format in the global section of the config file.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--ignorelockingfailure</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This lets you proceed with read-only metadata operations such as lvchange -ay and vgchange -ay even if the locking</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; module &nbsp;fails. &nbsp; One &nbsp;use &nbsp;for this is in a system init script if the lock directory is mounted read-only when the</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; script runs.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--ignoreskippedcluster</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Use to avoid exiting with an non-zero status code if the command is run without clustered locking and &nbsp;some &nbsp;clus\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tered Volume Groups have to be skipped over.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--addtag Tag</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Add &nbsp;the &nbsp;tag Tag to a PV, VG or LV. &nbsp;Supply this argument multiple times to add more than one tag at once. &nbsp;A tag</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is a word that can be used to group LVM2 objects of the same type together. &nbsp;Tags can be given on the command line</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in &nbsp;place &nbsp;of PV, VG or LV arguments. &nbsp;Tags should be prefixed with @ to avoid ambiguity. &nbsp;Each tag is expanded by</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; replacing it with all objects possessing that tag which are of the type expected by its position &nbsp;on &nbsp;the &nbsp;command</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; line. &nbsp;PVs can only possess tags while they are part of a Volume Group: PV tags are discarded if the PV is removed</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from the VG. &nbsp;As an example, you could tag some LVs as database and others as userdata and then activate the data\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; base ones with lvchange -ay @database. &nbsp;Objects can possess multiple tags simultaneously. &nbsp;Only the new LVM2 meta\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data format supports tagging: objects using the LVM1 metadata format cannot be tagged because the &nbsp;on-disk &nbsp;format</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; does &nbsp;not support it. &nbsp;Characters allowed in tags are: A-Z a-z 0-9 _ + . - and as of version 2.02.78 the following</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; characters are also accepted: / = ! : # &amp;</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--deltag Tag</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Delete the tag Tag from a PV, VG or LV, if it's present. &nbsp;Supply this argument multiple times to remove more &nbsp;than</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; one tag at once.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--alloc {anywhere|contiguous|cling|inherit|normal}</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Selects &nbsp;the allocation policy when a command needs to allocate Physical Extents from the Volume Group. &nbsp;Each Vol\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ume Group and Logical Volume has an allocation policy defined. &nbsp;The default for a Volume &nbsp;Group &nbsp;is &nbsp;normal &nbsp;which</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; applies &nbsp;common-sense &nbsp;rules &nbsp;such as not placing parallel stripes on the same Physical Volume. &nbsp;The default for a</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Logical Volume is inherit which applies the same policy as for the Volume Group. &nbsp;These policies &nbsp;can &nbsp;be &nbsp;changed</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; using &nbsp;lvchange(8) and vgchange(8) or overridden on the command line of any command that performs allocation. &nbsp;The</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; contiguous policy requires that new Physical Extents be placed adjacent to existing Physical Extents. &nbsp; The &nbsp;cling</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; policy &nbsp;places new Physical Extents on the same Physical Volume as existing Physical Extents in the same stripe of</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the Logical Volume. &nbsp;If there are sufficient free Physical Extents to satisfy an &nbsp;allocation &nbsp;request &nbsp;but &nbsp;normal</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; doesn't &nbsp;use &nbsp;them, &nbsp;anywhere &nbsp;will - even if that reduces performance by placing two stripes on the same Physical</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Volume.</div></div><div><br></div><div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--profile ProfileName</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Selects the configuration profile to use when processing an LVM command. &nbsp;In addition to &nbsp;that, &nbsp;when &nbsp;creating &nbsp;a</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Volume Group or a Logical Volume, it causes the ProfileName to be stored in metadata for each Volume Group or Log\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ical Volume. If the profile is stored in metadata, it is automatically applied next time the Volume Group &nbsp;or &nbsp;the</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Logical &nbsp;Volume is processed and the use of --profile is not necessary when running LVM commands further. See also</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lvm.conf(5) for more information about profile config and the way it fits with other LVM configuration methods.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;--config ConfigurationString</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Uses the ConfigurationString as direct string representation of the configuration to override the existing config\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; uration. &nbsp;The &nbsp;ConfigurationString &nbsp;is &nbsp;of &nbsp;exactly &nbsp;the &nbsp;same &nbsp;format &nbsp;as used in any LVM configuration file. See</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lvm.conf(5) for more information about direct config override on command line and the way it fits with &nbsp;other &nbsp;LVM</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; configuration methods.</div><div><br></div><div>ENVIRONMENT VARIABLES</div><div>&nbsp; &nbsp; &nbsp; &nbsp;HOME &nbsp; Directory containing .lvm_history if the internal readline shell is invoked.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;LVM_SYSTEM_DIR</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Directory containing lvm.conf(5) and other LVM system files. &nbsp;Defaults to "/etc/lvm".</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;LVM_SUPPRESS_FD_WARNINGS</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Suppress warnings about openned file descriptors, when lvm command is executed.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;LVM_VG_NAME</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The &nbsp;Volume Group name that is assumed for any reference to a Logical Volume that doesn't specify a path. &nbsp;Not set</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; by default.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;LVM_LVMETAD_PIDFILE</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Path for the lvmetad pid file.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;LVM_LVMETAD_SOCKET</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Path for the lvmetad socket file.</div><div><br></div><div>VALID NAMES</div><div>&nbsp; &nbsp; &nbsp; &nbsp;The following characters are valid for VG and LV names: a-z A-Z 0-9 + _ . -</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;VG and LV names cannot begin with a hyphen. &nbsp;There are also various reserved names that are used internally by &nbsp;lvm &nbsp;that</div><div>&nbsp; &nbsp; &nbsp; &nbsp;can &nbsp;not be used as LV or VG names. &nbsp;A VG cannot be called anything that exists in /dev/ at the time of creation, nor can</div></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp;it be called '.' or '..'. &nbsp;A LV cannot be called '.' '..' 'snapshot' or 'pvmove'. The LV name may also &nbsp;not &nbsp;contain &nbsp;the</div><div>&nbsp; &nbsp; &nbsp; &nbsp;strings '_mlog', '_mimage', '_rimage', '_tdata', '_tmeta'.</div><div><br></div><div>ALLOCATION</div><div>&nbsp; &nbsp; &nbsp; &nbsp;When an operation needs to allocate Physical Extents for one or more Logical Volumes, the tools proceed as follows:</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;First of all, they generate the complete set of unallocated Physical Extents in the Volume Group. &nbsp;If any ranges of Phys\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;ical Extents are supplied at the end of the command line, only unallocated Physical Extents within those &nbsp;ranges &nbsp;on &nbsp;the</div><div>&nbsp; &nbsp; &nbsp; &nbsp;specified Physical Volumes are considered.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Then they try each allocation policy in turn, starting with the strictest policy (contiguous) and ending with the alloca\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;tion policy specified using --alloc or set as the default for the particular Logical Volume or &nbsp;Volume &nbsp;Group &nbsp;concerned.</div><div>&nbsp; &nbsp; &nbsp; &nbsp;For &nbsp;each &nbsp;policy, &nbsp;working &nbsp;from &nbsp;the &nbsp;lowest-numbered Logical Extent of the empty Logical Volume space that needs to be</div><div>&nbsp; &nbsp; &nbsp; &nbsp;filled, they allocate as much space as possible according to the restrictions imposed by the policy. &nbsp;If &nbsp;more &nbsp;space &nbsp;is</div><div>&nbsp; &nbsp; &nbsp; &nbsp;needed, they move on to the next policy.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;The restrictions are as follows:</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Contiguous &nbsp;requires &nbsp;that &nbsp;the physical location of any Logical Extent that is not the first Logical Extent of a Logical</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Volume is adjacent to the physical location of the Logical Extent immediately preceding it.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Cling requires that the Physical Volume used for any Logical Extent to be added to an existing Logical Volume is &nbsp;already</div><div>&nbsp; &nbsp; &nbsp; &nbsp;in &nbsp;use &nbsp;by &nbsp;at &nbsp;least &nbsp;one &nbsp;Logical &nbsp;Extent &nbsp;earlier &nbsp;in &nbsp;that &nbsp;Logical &nbsp;Volume. &nbsp;If the configuration parameter alloca\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;tion/cling_tag_list is defined, then two Physical Volumes are considered to match if any of the listed tags is present on</div><div>&nbsp; &nbsp; &nbsp; &nbsp;both &nbsp;Physical Volumes. &nbsp;This allows groups of Physical Volumes with similar properties (such as their physical location)</div><div>&nbsp; &nbsp; &nbsp; &nbsp;to be tagged and treated as equivalent for allocation purposes.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;When a Logical Volume is striped or mirrored, the above restrictions are applied independently to each stripe &nbsp;or &nbsp;mirror</div><div>&nbsp; &nbsp; &nbsp; &nbsp;image (leg) that needs space.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Normal &nbsp;will not choose a Physical Extent that shares the same Physical Volume as a Logical Extent already allocated to a</div><div>&nbsp; &nbsp; &nbsp; &nbsp;parallel Logical Volume (i.e. a different stripe or mirror image/leg) at the same offset &nbsp;within &nbsp;that &nbsp;parallel &nbsp;Logical</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Volume.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;When allocating a mirror log at the same time as Logical Volumes to hold the mirror data, Normal will first try to select</div><div>&nbsp; &nbsp; &nbsp; &nbsp;different Physical Volumes for the log and the data. &nbsp;If that's not possible and the allocation/mirror_logs_require_sepa\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;rate_pvs &nbsp;configuration &nbsp;parameter &nbsp;is &nbsp;set to 0, it will then allow the log to share Physical Volume(s) with part of the</div><div>&nbsp; &nbsp; &nbsp; &nbsp;data.</div></div><div><br></div><div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;When allocating thin pool metadata, similar considerations to those of a mirror log in the last paragraph apply based &nbsp;on</div><div>&nbsp; &nbsp; &nbsp; &nbsp;the value of the allocation/thin_pool_metadata_require_separate_pvs configuration parameter.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;If &nbsp;you &nbsp;rely &nbsp;upon any layout behaviour beyond that documented here, be aware that it might change in future versions of</div><div>&nbsp; &nbsp; &nbsp; &nbsp;the code.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;For example, if you supply on the command line two empty Physical Volumes that have an identical number of free &nbsp;Physical</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Extents &nbsp;available &nbsp;for allocation, the current code considers using each of them in the order they are listed, but there</div><div>&nbsp; &nbsp; &nbsp; &nbsp;is no guarantee that future releases will maintain that property. &nbsp;If it is important to obtain a specific layout &nbsp;for &nbsp;a</div><div>&nbsp; &nbsp; &nbsp; &nbsp;particular Logical Volume, then you should build it up through a sequence of lvcreate(8) and lvconvert(8) steps such that</div><div>&nbsp; &nbsp; &nbsp; &nbsp;the restrictions described above applied to each step leave the tools no discretion over the layout.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;To view the way the allocation process currently works in any specific case, read the debug logging output, &nbsp;for &nbsp;example</div><div>&nbsp; &nbsp; &nbsp; &nbsp;by adding -vvvv to a command.</div><div><br></div><div>LOGICAL VOLUME TYPES</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Some logical volume types are simple to create and can be done with a single lvcreate(8) command. &nbsp;The linear and striped</div><div>&nbsp; &nbsp; &nbsp; &nbsp;logical volume types are an example of this. &nbsp;Other logical volume types may require more than &nbsp;one &nbsp;command &nbsp;to &nbsp;create.</div><div>&nbsp; &nbsp; &nbsp; &nbsp;The cache and thin provisioning types are examples of this.</div><div><br></div><div>&nbsp; &nbsp;Cache</div><div>&nbsp; &nbsp; &nbsp; &nbsp;The &nbsp;cache &nbsp;logical volume type uses a small and fast LV to improve the performance of a large and slow LV. &nbsp;It does this</div><div>&nbsp; &nbsp; &nbsp; &nbsp;by storing the frequently used blocks on the faster LV. &nbsp;LVM refers to the small fast LV as a cache pool LV. &nbsp; The &nbsp;large</div><div>&nbsp; &nbsp; &nbsp; &nbsp;slow &nbsp;LV &nbsp;is &nbsp;called &nbsp;the origin LV. &nbsp;Due to requirements from dm-cache (the kernel driver), LVM further splits the cache</div><div>&nbsp; &nbsp; &nbsp; &nbsp;pool LV into two devices - the cache data LV and cache metadata LV. &nbsp;The cache data LV is where copies of data blocks are</div><div>&nbsp; &nbsp; &nbsp; &nbsp;kept &nbsp;from &nbsp;the origin LV to increase speed. &nbsp;The cache metadata LV holds the accounting information that specifies where</div><div>&nbsp; &nbsp; &nbsp; &nbsp;data blocks are stored (e.g. &nbsp;on the origin LV or on the cache data LV). &nbsp;Users should be familiar with these LVs if they</div><div>&nbsp; &nbsp; &nbsp; &nbsp;wish to create the best and most robust cached logical volumes.</div><div><br></div><div>&nbsp; &nbsp;Cache Terms</div><div>&nbsp; &nbsp; &nbsp; &nbsp;origin LV &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OriginLV &nbsp; &nbsp; &nbsp;large slow LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;cache data LV &nbsp; &nbsp; &nbsp; CacheDataLV &nbsp; small fast LV for cache pool data</div><div>&nbsp; &nbsp; &nbsp; &nbsp;cache metadata LV &nbsp; CacheMetaLV &nbsp; small fast LV for cache pool metadata</div><div>&nbsp; &nbsp; &nbsp; &nbsp;cache pool LV &nbsp; &nbsp; &nbsp; CachePoolLV &nbsp; CacheDataLV + CacheMetaLV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;cache LV &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CacheLV &nbsp; &nbsp; &nbsp; OriginLV + CachePoolLV</div><div><br></div><div>&nbsp; &nbsp;Cache Steps</div></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp;The steps to create a logical volume of cache type are as follows:</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;0. &nbsp; &nbsp; Create an LV or identify an existing LV to be the origin LV.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;1. &nbsp; &nbsp; Create &nbsp;the &nbsp;cache &nbsp;data LV. &nbsp;The size of this LV is the size of the cache and will be reported as the size of the</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cache pool LV.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;2. &nbsp; &nbsp; Create the cache metadata LV. &nbsp;The size of this LV should be 1000 times smaller than the cache data LV with a min\</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imum size of 8MiB.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;3. &nbsp; &nbsp; Create &nbsp;the &nbsp;cache pool LV by combining the cache data LV (from step 1) and cache metadata LV (from step 2). &nbsp;When</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; performing this step, behavioral characteristics of the cache pool LV can be set. &nbsp;The name of the cache &nbsp;pool &nbsp;LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; takes &nbsp;the &nbsp;name of the cache data LV and the cache data LV and cache metadata LV are renamed to CachePoolLV_cdata</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and CachePoolLV_cmeta.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;4. &nbsp; &nbsp; Create a cache LV by linking the cache pool LV to the origin LV. &nbsp;The user accessible cache LV takes the &nbsp;name &nbsp;of</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the &nbsp;origin LV, while the origin LV becomes a hidden LV with the name OriginLV_corig. &nbsp;Users can perform this step</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; while the origin LV is in use.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;The steps above represent the best way to create a cache LV. &nbsp;They provide the most options and have the ability to &nbsp;cre\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;ate the most robust logical volumes. &nbsp;The examples below illustrate how these steps might be used in practice.</div><div><br></div><div>&nbsp; &nbsp;Cache Commands</div><div>&nbsp; &nbsp; &nbsp; &nbsp;0. create OriginLV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvcreate -L LargeSize -n OriginLV VG SlowPVs</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;1. create CacheDataLV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvcreate -L CacheSize -n CacheDataLV VG FastPVs</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;2. create CacheMetaLV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvcreate -L MetaSize -n CacheMetaLV VG FastPVs</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;3. create CachePoolLV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvconvert --type cache-pool --poolmetadata VG/CacheMetaLV VG/CacheDataLV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;CachePoolLV takes the name of CacheDataLV.</div><div>&nbsp; &nbsp; &nbsp; &nbsp;CacheDataLV is renamed CachePoolLV_cdata and becomes hidden.</div><div>&nbsp; &nbsp; &nbsp; &nbsp;CacheMetaLV is renamed CachePoolLV_cmeta and becomes hidden.</div></div><div><br></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp;4. create CacheLV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvconvert --type cache --cachepool VG/CachePoolLV VG/OriginLV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;CacheLV takes the name of OriginLV.</div><div>&nbsp; &nbsp; &nbsp; &nbsp;OriginLV is renamed OriginLV_corig and becomes hidden.</div><div><br></div><div>&nbsp; &nbsp;Cache Examples</div><div>&nbsp; &nbsp; &nbsp; &nbsp;Example 1: Creating a simple cache LV.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;0. Create the origin LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate -L 10G -n lvx vg /dev/slow_dev</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;1. Create a cache data LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate -L 1G -n lvx_cache vg /dev/fast_dev</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;2. Create a cache metadata LV (~1/1000th size of CacheDataLV or 8MiB)</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate -L 8M -n lvx_cache_meta vg /dev/fast_dev</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;3. Create a cache pool LV, combining cache data LV and cache metadata LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvconvert --type cache-pool --poolmetadata vg/lvx_cache_meta \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vg/lvx_cache</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;4. Create a cached LV by combining the cache pool LV and origin LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvconvert --type cache --cachepool vg/lvx_cache vg/lvx</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Example 2: Creating a cache LV with a fault tolerant cache pool LV.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Users &nbsp;who &nbsp;are concerned about the possibility of failures in their fast devices that could lead to data loss might con\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;sider making their cache pool sub-LVs redundant. &nbsp;Example 2 illustrates how to do that. &nbsp;Note &nbsp;that &nbsp;only &nbsp;steps &nbsp;1 &nbsp;&amp; &nbsp;2</div><div>&nbsp; &nbsp; &nbsp; &nbsp;change.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;0. Create an origin LV we wish to cache</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate -L 10G -n lvx vg /dev/slow_devs</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;1. Create a 2-way RAID1 cache data LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate --type raid1 -m 1 -L 1G -n lvx_cache vg \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /dev/fast1 /dev/fast2</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;2. Create a 2-way RAID1 cache metadata LV</div></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate --type raid1 -m 1 -L 8M -n lvx_cache_meta vg \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /dev/fast1 /dev/fast2</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;3. Create a cache pool LV combining cache data LV and cache metadata LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvconvert --type cache-pool --poolmetadata vg/lvx_cache_meta \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vg/lvx_cache</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;4. Create a cached LV by combining the cache pool LV and origin LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvconvert --type cache --cachepool vg/lvx_cache vg/lvx</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Example 3: Creating a simple cache LV with writethough caching.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;Some &nbsp;users wish to ensure that any data written will be stored both in the cache pool LV and on the origin LV. &nbsp;The loss</div><div>&nbsp; &nbsp; &nbsp; &nbsp;of a device associated with the cache pool LV in this case would not mean the loss of any data. &nbsp;When combining the cache</div><div>&nbsp; &nbsp; &nbsp; &nbsp;data &nbsp;LV &nbsp;and &nbsp;the &nbsp;cache metadata LV to form the cache pool LV, properties of the cache can be specified - in this case,</div><div>&nbsp; &nbsp; &nbsp; &nbsp;writethrough vs. writeback. &nbsp;Note that only step 3 is affected in this case.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;0. Create an origin LV we wish to cache (yours may already exist)</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate -L 10G -n lvx vg /dev/slow</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;1. Create a cache data LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate -L 1G -n lvx_cache vg /dev/fast</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;2. Create a cache metadata LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvcreate -L 8M -n lvx_cache_meta vg /dev/fast</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;3. Create a cache pool LV specifying cache mode "writethrough"</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvconvert --type cache-pool --poolmetadata vg/lvx_cache_meta \</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --cachemode writethrough vg/lvx_cache</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;4. Create a cache LV by combining the cache pool LV and origin LV</div><div>&nbsp; &nbsp; &nbsp; &nbsp;# lvconvert --type cache --cachepool vg/lvx_cache vg/lvx</div><div><br></div><div>&nbsp; &nbsp;Removing Cache Logical Volumes</div><div>&nbsp; &nbsp; &nbsp; &nbsp;If you wish to remove all logical volumes associated with a cache &nbsp;LV, &nbsp;you &nbsp;must &nbsp;remove &nbsp;both &nbsp;top-level, &nbsp;user-visible</div><div>&nbsp; &nbsp; &nbsp; &nbsp;devices. &nbsp; The cache metadata LV and cache data LV cannot be removed directly. &nbsp;If only the cache pool LV is specfied for</div><div>&nbsp; &nbsp; &nbsp; &nbsp;removal, any cached blocks not yet on the origin LV will be flush, the cache pool LV will be removed, &nbsp;and &nbsp;the &nbsp;now &nbsp;un-</div><div>&nbsp; &nbsp; &nbsp; &nbsp;cached &nbsp;origin &nbsp;LV will remain. &nbsp;If the user specifies a cache LV for removal, then the origin LV is removed and only the</div></div><div><div>&nbsp; &nbsp; &nbsp; &nbsp;cache pool LV will remain. &nbsp;The cache pool LV can then be used to create another cache LV with a different origin &nbsp;LV &nbsp;if</div><div>&nbsp; &nbsp; &nbsp; &nbsp;desired.</div><div><br></div><div>&nbsp; &nbsp; &nbsp; &nbsp;When users intend to remove all logical volumes associated with a cache LV, it is generally better to start with the ori\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;gin LV and then remove the cache pool LV. &nbsp;If the operations are performed in the reverse order, the user &nbsp;will &nbsp;have &nbsp;to</div><div>&nbsp; &nbsp; &nbsp; &nbsp;wait for the contents of the cache pool LV to be flushed before the origin LV is removed. &nbsp;This could take some time.</div><div><br></div><div>DIAGNOSTICS</div><div>&nbsp; &nbsp; &nbsp; &nbsp;All tools return a status code of zero on success or non-zero on failure.</div><div><br></div><div>FILES</div><div>&nbsp; &nbsp; &nbsp; &nbsp;/etc/lvm/lvm.conf</div><div>&nbsp; &nbsp; &nbsp; &nbsp;$HOME/.lvm_history</div><div><br></div><div>SEE ALSO</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvm.conf(5), &nbsp;clvmd(8), &nbsp;lvchange(8), &nbsp;lvcreate(8), lvdisplay(8), lvextend(8), lvmchange(8), lvmdiskscan(8), lvreduce(8),</div><div>&nbsp; &nbsp; &nbsp; &nbsp;lvremove(8), lvrename(8), lvresize(8), lvs(8), lvscan(8), pvchange(8), &nbsp;pvck(8), &nbsp;pvcreate(8), &nbsp;pvdisplay(8), &nbsp;pvmove(8),</div><div>&nbsp; &nbsp; &nbsp; &nbsp;pvremove(8), &nbsp;pvs(8), &nbsp;pvscan(8), &nbsp;vgcfgbackup(8), &nbsp;vgchange(8), &nbsp;vgck(8), vgconvert(8), vgcreate(8), vgdisplay(8), vgex\</div><div>&nbsp; &nbsp; &nbsp; &nbsp;tend(8), &nbsp;vgimport(8), &nbsp;vgimportclone(8), &nbsp;vgmerge(8), &nbsp;vgmknodes(8), &nbsp;vgreduce(8), &nbsp;vgremove(8), &nbsp;vgrename(8), &nbsp; vgs(8),</div><div>&nbsp; &nbsp; &nbsp; &nbsp;vgscan(8), vgsplit(8), readline(3)</div><div><br></div><div>Sistina Software UK &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LVM TOOLS 2.02.105(2)-RHEL7 (2014-03-26) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LVM(8)</div></div><div><br></div><div>[参考]</div><div>1.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.0_Release_Notes/index.html"   >https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/7.0_Release_Notes/index.html</a></div><div>2. man lvm</div><div>3.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://www.centos.org/download/"   >http://www.centos.org/download/</a></div><div>4.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="http://mirrors.aliyun.com/centos/7.0.1406/isos/x86_64/CentOS-7.0-1406-x86_64-DVD.iso"   >http://mirrors.aliyun.com/centos/7.0.1406/isos/x86_64/CentOS-7.0-1406-x86_64-DVD.iso</a></div><div>5.&nbsp;<a style="line-height: 28px;" target="_blank" rel="nofollow" href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/index.html"   >https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Storage_Administration_Guide/index.html</a></div><wbr>
<a rel="nofollow" href="http://info.flagcounter.com/h9V1"   ><img title="RHEL 7 Technology Preview - lvm cache like zfs l2arc, bcache, flashcache - 德哥@Digoal - PostgreSQL research"   src="http://s03.flagcounter.com/count/h9V1/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_0/flags_0/"   alt="Flag Counter"   border="0"   ></a></div>
	</div>
	<h3>评论</h3>
	<div class="" id="" style="padding:0 20px;">
			<div id="">
				<h5 id="">ydconnet - 2015-01-19 17:14:50</h5>
				<div>德哥，行家啊。我也正在搞这个，看看性能能提高多少，和intel smart response有没有可比性。<div><br></div><div>对了。有没有研究过linux下的ACPI唤醒。我怎么从来没有找到过一篇文章明确说 Linux xxx支持网络, USB, PS/2 wakeup？&nbsp;</div></div>
			</div>
			<div style="padding-left:40px;">
				<h5 id="">德哥@Digoal 回复 ydconnet - 2015-01-19 17:14:50</h5>
				<div style="width:600px;">还要看他的老化算法, ZFS的ARC是不错的, 从IBM的ARC演化过来的.<div>ACPI没研究过.</div></div>
			</div>
	</div>
</div>
</body>
</html>