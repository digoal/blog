<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">AIX平台下EMC阵列安装与配置</h2>
	<h5 id="">2011-01-11 19:08:32&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/16387704020110117832136/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><div id="blog_article"  > <div> <div> <div> <div> <p><strong>今天又在折腾两台P570,AIX的AGENT实在没找到，厦门的技术支持电话又打不通，好不容易找到一个可以下的地方居然只有2K的速度。</strong></p><p><strong><br></strong></p><p><strong>[转]</strong></p><p><strong>http://www.aixchina.net/home/space.php?uid=5551&amp;do=blog&amp;id=21623<br></strong></p><p><strong>一 AIX ODM包安装<br></strong><font color="#660000"  >1.安装ODM注意事项<br></font>A．关于FCP \MPIO \FCP PowerMPIO<br>以下三个filesets不能共存，只能选其一<br>EMC CLARiiON FCP Support Software： IBM Fibre Channel driver support.<br>EMC CLARiiON FCP MPIO Support Software： IBM default PCM MPIO support.<br>EMC CLARiiON FCP PowerMPIO Support Software： PowerPath custom PCM MPIO support.</p> <p>Note: <br>When installing either Symmetrix or CLARiiON FCP fileset  support,only one default device type can be installed for either storage  array.Coexistence support for FCP, FCP MPIO, FCP PowerMPIO for the same  array type isn't supported. The installp pre-installation scripts check  for this and will not allow you to perform. such actions.</p> <p>B．关于CLARiiON High Availability Support<br>HACMP RAC环境中需要安装CLARiiON High Availability Support。安装该为文件集之前，需要先安装HACMP，因为EMC CLARiiON HA Concurrent Support依赖以下filesets才能安装<br>cluster.es.server.rte<br>cluster.base.server.rte</p> <p>Release Notes for CLARiiON High Availability Support<br>The EMC CLARiiON HA support software fileset is installed on AIX based machines using the `installp` command.</p> <p>This fileset provides a utility called `clarcurrent` to add and  delete CLARiiON device types into the clconraid.dat&nbsp; configuration  file.&nbsp; <br>The clconraid.dat file is a member of&nbsp; the HACMP concurrent fileset cluster.base.server.diag or cluster.es.server.diag.</p> <p>C．关于emcpowerreset<br>安装ODM库后，就会在/usr/lpp/EMC/CLARiiON/bin/目录下生成该文件。<br>The utility is used for resetting a device reservation with HACMP for PowerPath 3.0.3,3.0.4, 4.X and higher.</p> <p>This utility is version 2. Previous version isn't supported with PowerPath version 4.X and higher.<br>To determine the different emcpowerreset,versions run the following command.<br>#cksum emcpowerreset<br>Version 1 = 1108394902 7867&nbsp;&nbsp;&nbsp; emcpowerreset<br>Version 2 = 1955156125 10311&nbsp;&nbsp; emcpowerreset&nbsp; </p> <p>In a non-cooperative node failover, the takeover node cannot always clear the SCSI device reservation held by the primary node.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>The  problem occurs when the takeover node cannot always clear the SCSI  device reservation held by the primary node. If the words "invalid  argument" appear in the hacmp.out or vsd.log file in response to an  SCIOLSTART, you may have encountered this issue.<br>For example, the hacmp.out log file will contain the following:</p> <p>cl_disk_available[187] cl_fscsilunreset fscsi0 hdiskpower1 false<br>cl_fscsilunreset[124]: openx(/dev/hdiskpower1, O_RDWR, 0, SC_NO_RESERVE): Device busy<br>cl_fscsilunreset[400]: ioctl SCIOLSTART id=0X11000 lun=0X1000000000000 : Invalid argument</p> <p>详见ODM包内的README文档。</p> <p><br><font color="#660000"  >2.下载ODM包软件<br></font><a target="_blank" rel="nofollow" href="ftp://ftp.emc.com/pub/elab/aix/ODM_DEFINITIONS"  >ftp://ftp.emc.com/pub/elab/aix/ODM_DEFINITIONS</a></p> <p><font color="#660000"  >3.解压ODM<br></font>上传至AIX主机后，用uncompress和tar解压<br># uncompress EMC.AIX.5.3.0.3.tar.Z</p> <p># tar -xvf EMC.AIX.5.3.0.3.tar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>x README.5303, 36133 bytes, 71 tape blocks<br>x EMC.AIX.5.3.0.3, 51814400 bytes, 101200 tape blocks</p> <p><font color="#660000"  >4.安装ODM<br></font>#smitty installp<br>根据需要选择以下蓝色部分文件集<br>EMC Symmetrix AIX Support Software;&nbsp; Standard utility support.<br>EMC Symmetrix FCP Support Software; IBM Fibre Channel driver support.<br>EMC Symmetrix FCP MPIO Support Software; IBM default PCM MPIO support.<br>EMC Symmetrix FCP PowerMPIO Support Software; PowerPath custom PCM MPIO support.<br>EMC Symmetrix iSCSI Support Software; IBM iSCSI driver support.<br>EMC Symmetrix HA Concurrent Support; Requires HACMP CLVM.<br>EMC CLARiiON AIX Support Software; Standard utility support.<br>EMC CLARiiON FCP Support Software; IBM Fibre Channel driver support.<br>EMC CLARiiON FCP MPIO Support Software; IBM default PCM MPIO support.<br>EMC CLARiiON FCP PowerMPIO Support Software; PowerPath custom PCM MPIO support.<br>EMC CLARiiON iSCSI Support Software; IBM iSCSI driver support.<br>EMC CLARiiON HA Concurrent Support; Requires HACMP CLVM.<br>EMC INVISTA AIX Support Software; Standard utility support.<br>EMC INVISTA FCP Support Software; IBM Fibre Channel driver support.<br>EMC CELERRA AIX Support Software; Standard utility support.<br>EMC CELERRA FCP Support Software; IBM iSCSI driver support.</p> <p><br>一般我们选择以下进行安装<br>EMC CLARiiON AIX Support Software<br>EMC CLARiiON FCP Support Software<br>EMC CLARiiON HA Concurrent Support</p> <p>注意：EMC CLARiiON HA Concurrent Support需要先安装HACMP，因为EMC CLARiiON HA Concurrent Support依赖以下filesets才能安装<br>cluster.es.server.rte<br>cluster.base.server.rte</p> <p><font color="#660000"  >5.配置Disk Method</font><br>#smitty hacmp.<br>-&gt;Select Cluster Configuration.<br>-&gt;Select Cluster Custom Modification.<br>-&gt;Select Define Custom Disk Methods.<br>-&gt;Select Add Custom Disk Methods.</p> <p><br>Disk Type (PdDvLn field from CuDv) = disk/pseudo/power<br>Method to identify ghost disks = SCSI3<br>Method to determine if a reserve is held = SCSI_TUR<br>Method to break a reserve = /usr/lpp/EMC/CLARiiON/bin/emcpowerreset<br>Break reserves in parallel = true<br>Method to make the disk available = MKDEV</p> <p>在HACMP各节点配置DISK METHOD，并同步<br>Configure the same custom disk  processing method on each node in the cluster and synchronize the  cluster resources. The cluster verification process ensures that the  method that you configured exists and is executable on all nodes. The  synchronization process ensures that the ODM entries are the same on all  nodes, but will not synchronize the methods named in the ODM entries.<br>6.重启主机<br>#shutdown CFr</p> <p>注意：安装EMC_ODM之后，主机需要重启才能生效。</p> <p><strong>二、Navisphere host agent安装<br></strong><font color="#660000"  >1.关于Navisphere host agent<br></font>当Host Agent 服务启动时，Host Agent 将在连接的存储系统中注册服务器的HBA（主机总线适配器）。此操作会将每个HBA 的启动器记录发送到存储系统。<br>Host Agent 还可以：将驱动器映射信息发送给相连的CLARiiON? 存储系统；监视存储系统事件，并能在任何指定事件发生时通过电子邮件、传呼或调制解调器通知相关人员；从 存储系统获取LUN WWN（全球通用名称）和容量信息。</p> <p><font color="#660000"  >2.安装Navisphere host agent<br></font>安装NAVIAGENT<br># installp -agXd . NAVIAGENT</p> <p><font color="#660000"  >3.起停Navisphere Agent<br></font>停止agent<br># /etc/rc.agent stop<br>Navisphere Agent is not running</p> <p>启动agent<br># /etc/rc.agent start<br>Starting Navisphere Agent<br>#<br><font color="#660000"  >4.检查Navisphere Agent运行状态<br></font># ps -ef |grep navi<br>root 119028&nbsp; 1&nbsp;&nbsp; 0 21:41:42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -&nbsp; 0:00 /usr/bin/naviagent -f /etc/Navisphere/agent.config <br>root 106774 126982&nbsp;&nbsp; 0 21:41:47&nbsp; pts/0&nbsp; 0:00 grep navi <br>#<br>注意：<br>检查进程是否已经启动，如果没有进程起来，那么表示该版本agent不符合（即使安装和rc.agent命令运行成功），需要更换版本。</p> <p><strong>三 安装和配置PowerPath for AIX</strong><br>注意事项<br>安装PowerPath时，切勿尝试用powermt config配置磁盘，否则很可能引起系统崩溃。<br>Do  not attempt to run powermt config while using installp or SMIT to add,  remove, or update PowerPath software. Doing so can result in a system  crash.</p> <p><font color="#660000"  >1.上传PowerPath for AIX<br></font>下载最新版本的PowerPath for AIX，并上传至AIX主机</p> <p><font color="#660000"  >2.解压PowerPath for AIX</font><br># gunzip EMCPower.AIX.5.3.0.GA.tar.gz</p> <p># tar -xvf EMC.AIX.5.3.0.3.tar<br>x README.5303, 36133 bytes, 71 tape blocks<br>x EMC.AIX.5.3.0.3, 51814400 bytes, 101200 tape blocks</p> <p><font color="#660000"  >3.安装powerpath<br></font>#installp CagXd . EMCpower<br>+-----------------------------------------------------------------------------+<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Pre-installation Verification...<br>+-----------------------------------------------------------------------------+<br>Verifying selections...done<br>Verifying requisites...done<br>Results...</p> <p>SUCCESSES<br>---------<br>&nbsp; Filesets listed in this section passed pre-installation verification<br>&nbsp; and will be installed.</p> <p>&nbsp; Selected Filesets<br>&nbsp; -----------------<br>&nbsp; EMCpower.base 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # PowerPath Base Driver and Ut...<br>&nbsp; EMCpower.consistency_grp 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # PowerPath Consistency Group ...<br>&nbsp; EMCpower.encryption 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # PowerPath Encryption with RSA<br>&nbsp; EMCpower.migration_enabler 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # PowerPath Migration Enabler ...<br>&nbsp; EMCpower.mpx 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # PowerPath Multi_Pathing Exte...</p> <p>&nbsp; &lt;&lt; End of Success Section &gt;&gt;<br>Installation Summary<br>--------------------<br>Name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Level&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Part&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Event&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Result<br>-------------------------------------------------------------------------------<br>EMCpower.base&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; USR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; APPLY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUCCESS&nbsp;&nbsp;&nbsp; <br>EMCpower.mpx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; USR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; APPLY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUCCESS&nbsp;&nbsp;&nbsp; <br>EMCpower.migration_enabler&nbsp; 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; USR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; APPLY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUCCESS&nbsp;&nbsp;&nbsp; <br>EMCpower.encryption&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; USR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; APPLY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUCCESS&nbsp;&nbsp;&nbsp; <br>EMCpower.consistency_grp&nbsp;&nbsp;&nbsp; 5.3.0.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; USR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; APPLY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; SUCCESS&nbsp;&nbsp;&nbsp; <br><font color="#660000"  >4.注册PowerPath</font><br># emcpreg -install</p> <p>===========&nbsp;&nbsp; EMC PowerPath Registration ===========<br>Do you have a new registration key or keys to enter?[n] y<br>Enter the registration keys(s) for your product(s),<br>one per line, pressing Enter after each key.<br>After typing all keys, press Enter again.</p> <p>Key (Enter if done): BYPK-6B4U-MFCE-QAW4-MP97-M9Y6<br>1 key(s) successfully added.<br>Key successfully installed.</p> <p>Key (Enter if done): <br>1 key(s) successfully registered.</p> <p>输入许可证回车即可。<br>Note: If you are upgrading from an earlier version of PowerPath, you do not need to reregister. PowerPath will use your old key.</p> <p><font color="#660000"  >5.启用HBA卡快速接管功能<br></font>Enable the adapter driver fast_fail feature for each adapter to be managed by PowerPath:<br>chdev -l fscsix -a fc_err_recov=fast_fail -P<br>where x is the specific HBA (fscsi0, fscsi1, and so forth).</p> <p><font color="#660000"  >6.启用PowerPath负载均衡</font><br>#powermt set policy＝co dev＝all</p> <p><font color="#660000"  >7.初始化hdiskpower设备</font><br>#powermt config</p> <p>#<br><font color="#660000"  >8.检查EMC链路状态</font><br>#powermt display dev=all</p> <p>如果输出中所有的path都是“alive”则正常；否则，需要检查线缆及ZONE划分是否正确；用powermt display dev=hdiskpower0会看到这个hdiskpower0对应的hdiskX</p></div> </div> </div>     </div> </div></div>
	</div>
</div>
</body>
</html>