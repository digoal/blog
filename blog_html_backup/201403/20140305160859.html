<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=gbk">
<title>PostgreSQL research</title>
<style type="text/css">
.blogcnt{line-height:160%;font-size:14px;text-align:left;word-wrap:break-word;}
.blogcnt *{line-height:160%;}
.blogcnt p{margin:0 0 10px;}
.blogcnt ul,.nbw-blog ol{margin:5px 0 5px 40px;padding:0}
.blogcnt em{font-style:italic;}
.blogcnt blockquote{font-size:1em;margin:auto 0 auto 35px;}
.blogcnt img{border:0;max-width:100%;}
</style>
</head>
<body style="color:#444444;">
<h1 id="blog-Title"><a href="index.html">PostgreSQL research</a></h1>
<div id="" style="padding:0 20px;">
	<h2 id="">[转] EMC CLARiiON 的 Alignment offset</h2>
	<h5 id="">2014-03-05 16:08:59&nbsp;&nbsp;&nbsp;<a href="http://blog.163.com/digoal@126/blog/static/1638770402014254859669/" target="_blank">查看原文&gt;&gt;</a></h5>
	<div class="" id="" style="padding:0 20px;">
		<div class="blogcnt" style="width:800px;"><a target="_blank" rel="nofollow" href="http://dbanotes.net/tech-memo/emc_clariion_alignment_offset.html"   >http://dbanotes.net/tech-memo/emc_clariion_alignment_offset.html</a><br><wbr><div><br></div><div><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >今天参加了 EMC 组织的存储技术培训。因为频繁被电话打扰，导致听课效果并不是那么好。很多内容似曾相识，只是都断断续续的，几乎每次培训都是这样的，总有”断点”。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >上午是 CLARiiON 的简单介绍，在模拟操作的时候我发现了以前漏掉的一个盲点：Binding LUN 的时候，那个&nbsp;<strong style=" border: 0px; vertical-align: baseline;margin: 0px; padding: 0px;"   >Alignment Offset&nbsp;</strong>的选项到底是干啥的? 讲师简单说了一下，感觉不太对路子。刚才闲下来，查找了一下这个信息，大致搞明白了这个 ”Alignment offset“。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >用 ”Alignment offset EMC“ 作关键字搜索到的<a style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; outline: none; color: rgb(159, 159, 159);" rel="nofollow" href="http://dbanotes.net/tech-memo/www.dell.com/downloads/global/power/ps4q04-20040149-Mehis.pdf"   >第一篇文档</a>是 Dell 工程师写的。这里面用了一个词 “signature block” , 莫名的一个词，我相信是 Dell 工程师自己发明的(用 Metadata 不就得了)。另外两个关键词是 “Windows” 和 “31.5KB” ，为啥是 31.5KB ，不知道。接下来在 EMC 的 Powerlink 网站上找到了比较详细的说明。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >首先确定一下，<strong style=" border: 0px; vertical-align: baseline;margin: 0px; padding: 0px;"   >这个问题更多是影响 Windows 系统</strong>。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >老的 BIOS 代码，使用 ”柱面、磁头、扇区数“这一套机制而不是 LBA （Logical block addressing ）的模式来寻址。Linux 的 fdisk 工具还是 Windows 磁盘管理器，在每个格式化的设备上都放置一份 MBR 。这个 MBR 占用 63 个隐含扇区 (63*512=31.5KB, Bingo!)。这个问题在 Windows 上存在，在 VMware 上也存在，offset 同样是 63。 在有些 Linux 上，因为 Boot Loader 的不同，也会有类似的问题。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >无视 Alignment offset 会导致的问题:</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   ><span style=" border: 0px; vertical-align: baseline;margin: 0px; padding: 0px;"   ><img title="[转] EMC CLARiiON 的 Alignment offset - 德哥@Digoal - PostgreSQL"   alt="alignment_offset.png"   src="http://www.dbanotes.net/Images/alignment_offset.png"   width="543"   height="219"   class="mt-image-center"   style=" display: block; box-shadow: rgba(0, 0, 0, 0.2) 0px 1px 4px; vertical-align: baseline; border-bottom-right-radius: 3px; text-align: center; border-top-right-radius: 3px;margin: 0px auto 20px; border-top-left-radius: 3px; padding: 0px; border-bottom-left-radius: 3px;"   ></span></p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >如图所示，一个 IO 会分裂到两个 Disk(Device/LUN) 上去，后果很严重。和我以前描述过的&nbsp;<a style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; outline: none; color: rgb(159, 159, 159);" rel="nofollow" href="http://www.dbanotes.net/database/aix_raw_lvm_4k_offset.html"   >4k Offset</a>问题本质上是一样的。只是这个是<strong style=" border: 0px; vertical-align: baseline;margin: 0px; padding: 0px;"   >针对文件系统</strong>的。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >那么，如何校正这个 ”对齐偏移量” 呢?</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >存储厂商的推荐是如果用 Snap View / SAN Copy 等存储级别的操作的话，不要折腾，用系统默认的就成，否则，用主机端的解决方案。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >主机端的解决方案分为 Windows 32位、Windows 64 位、Linux、VMware 几种。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >1） 对于 32 位的 Windows ，使用 Windows 系统资源包的 diskpar.exe 来设定 offset ( 据说 Windows 2003 SP1 上的 diskpart.exe 已经具备了 diskpar.exe 的功能。<a style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; outline: none; color: rgb(159, 159, 159);" rel="nofollow" href="http://geekswithblogs.net/ntpro/archive/2005/08/11/49948.aspx"   >refer</a>)</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >2）对于 64 位的 Windows ，GPT(GUID Partition Table)类型的分区默认有 32M 保留区，MBR 类型的分区自动校准。不存在这个问题。这就是 64位 的 Windows 众多优点之一啊。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >3) 对于 Linux ，fdisk /dev/{devicename} 然后进入 expert 模式, 然后输入 b …</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >4) 对于 VMware，分为两种情况。虚拟机层（用虚拟机下操作系统的方案) 以及 ESX 服务器层 (fdisk).</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >上面几个步骤描述不详细，更详细的介绍你需要寻找一份白皮书： EMC CLARiion Best Practices for Fibre Channel Storage ，这个白皮书有针对 Flare 不同版本的，Flare 2.6 对这个问题有了比较好的改进。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >是的，有的时候白皮书就在那里，只是没有人注意，没有看而已。</p><p style=" color: rgb(68, 68, 68); font-size: 14px; border: 0px; vertical-align: baseline; margin-bottom: 1.714285714rem;margin-top: 0px; font-family: Helvetica, Arial, sans-serif; line-height: 24px;"   >C<abbr title="End of file"   style=" border-bottom-color: rgb(102, 102, 102); vertical-align: baseline; border-bottom-style: dotted; cursor: help; border-width: 0px 0px 1px;margin: 0px; padding: 0px;"   >EOF</abbr>C</p></div></div>
	</div>
</div>
</body>
</html>