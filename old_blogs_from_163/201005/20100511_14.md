## PostgreSQL Running on RHEL for PPC   
                               
### 作者                               
digoal                              
                                
### 日期                              
2010-05-11                                                                                                                     
                               
### 标签                                             
PostgreSQL , RHEL , PPC , IBM Power                     
                                  
----                                 
                                  
## 背景                             
首先,要说一下操作系统是rhel5.4PPC版本.该数据库到现在上线已经跑了90天了。  
  
可能有人会觉得比较疯狂,居然用小型机来跑开源数据库，而且还是用的第三方操作系统.  
  
如果在设计整体架构的时候没有考虑到数据库的可扩展，那么随着业务的发展，这种集中式存储的数据库模式必然导致性能瓶颈逐渐凸显。  
  
在这种情况下来重整架构的可能性也非常低，那怎么办？  
  
通常的话可以有几种手段：  
  
1\. 优化数据库SQL,存储IO分布,数据压缩,清理碎片,优化INDEX，分区等（通常在初期的话可以这么做）  
  
2\. 根据瓶颈的精确定位升级相关硬件如CPU,MEM,存储,等（第一步已经无法再提升数据库性能了的话就该考虑升级硬件了）  
  
3\. 数据库读写分离，将单个数据库切割为多个数据库并通过中间件来实现应用透明。  
  
废话差不多了。  
  
讲讲小型机的某几个优点：  
  
1\. 稳定   
  
2\. 大内存   
  
3\. CPU也还行  
  
其实在迁移到小型机之前，做过将单个数据库切割为多个数据库并通过中间件来实现应用透明。  
  
检查了没多久还是抗不住，主要是IO等待较严重。没多久还是考虑迁移到小型机。  
  
迁移的几点理由：  
  
1\. 当然是业务的重要性考虑,需要更稳定的服务和良好的用户体验  
  
2\. 由于postgresql在频繁的DML之后会使数据存储的PAGE中DEAD TUPLE越来越多，导致BUFFER的大量浪费。需要更多的内存来降低磁盘的IO  
  
3\. postgresql是提供源代码的，所以迁移的难度也大大降低.  
  
迁移后调整了数据库的CHECKPOINT和超时，加大effective_cache_size=80G等，读的IO降低到0，只剩下写的IO。  
  
同时升级了存储，将log,pg_xlog,basedir,idx,table分布到不同的底层LUN。  
  
到目前为止，运行非常OK。  
    
[Count](http://info.flagcounter.com/h9V1)                                
                                
